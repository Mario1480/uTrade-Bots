(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{2883:(e,t,n)=>{"use strict";n.d(t,{$P:()=>g,Al:()=>m,GC:()=>S,Vg:()=>u,hD:()=>c,mu:()=>p});var i,s,l,a,r=n(7011);null!=(null!=(i=r.env.API_URL)?i:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let o=null!=(a=null!=(l=null!=(s=r.env.NEXT_PUBLIC_API_URL)?s:r.env.API_URL)?l:r.env.API_BASE_URL)?a:"http://localhost:4000";class c extends Error{constructor(e,t,n){super(e),this.status=t,this.payload=n}}async function d(e,t,n){let i={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(i["x-csrf-token"]=e)}let s=await fetch("".concat(o).concat(t),{method:e,headers:i,body:n?JSON.stringify(n):void 0,credentials:"include",cache:"no-store"});if(!s.ok){let n=null;try{n=await s.json()}catch(e){}throw new c((null==n?void 0:n.error)||(null==n?void 0:n.message)||"".concat(e," ").concat(t," failed (").concat(s.status,")"),s.status,n)}return s.json()}function u(e){return d("GET",e)}function g(e,t){return d("POST",e,t)}function p(e,t){return d("PUT",e,t)}function m(e){return d("DELETE",e)}function S(e){return d("DELETE",e)}},5220:(e,t,n)=>{Promise.resolve().then(n.bind(n,7578))},7578:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var i=n(4568),s=n(9664),l=n.n(s),a=n(7620),r=n(2883);let o=[{key:"conservative",label:"Conservative",description:"Weniger Flip-Flops, weniger AI-Calls.",values:{triggerDebounceSec:180,aiCooldownSec:900,eventThrottleSec:300,hysteresisRatio:.7,unstableFlipLimit:4,unstableFlipWindowSeconds:1800}},{key:"balanced",label:"Balanced",description:"Guter Standard f\xfcr die meisten M\xe4rkte.",values:{triggerDebounceSec:120,aiCooldownSec:600,eventThrottleSec:180,hysteresisRatio:.65,unstableFlipLimit:4,unstableFlipWindowSeconds:1800}},{key:"aggressive",label:"Aggressive",description:"Schneller, aber mit mehr Noise-Risiko.",values:{triggerDebounceSec:60,aiCooldownSec:300,eventThrottleSec:120,hysteresisRatio:.55,unstableFlipLimit:5,unstableFlipWindowSeconds:1800}}];function c(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function d(){var e;let[t,n]=(0,a.useState)(!0),[s,d]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),[S,h]=(0,a.useState)(null),[v,b]=(0,a.useState)(null),[y,f]=(0,a.useState)("90"),[x,j]=(0,a.useState)("300"),[w,C]=(0,a.useState)("180"),[N,T]=(0,a.useState)("0.6"),[k,E]=(0,a.useState)("4"),[F,L]=(0,a.useState)("1800");async function z(){n(!0),m(null);try{let e=await (0,r.Vg)("/auth/me");if(!(null==e?void 0:e.isSuperadmin)){g(!1),m("Superadmin access required.");return}g(!0);let t=await (0,r.Vg)("/admin/settings/prediction-refresh");b(t),f(String(t.triggerDebounceSec)),j(String(t.aiCooldownSec)),C(String(t.eventThrottleSec)),T(String(t.hysteresisRatio)),E(String(t.unstableFlipLimit)),L(String(t.unstableFlipWindowSeconds))}catch(e){m(c(e))}finally{n(!1)}}async function A(){d(!0),m(null),h(null);try{let e={triggerDebounceSec:Number(y),aiCooldownSec:Number(x),eventThrottleSec:Number(w),hysteresisRatio:Number(N),unstableFlipLimit:Number(k),unstableFlipWindowSeconds:Number(F)},t=await (0,r.mu)("/admin/settings/prediction-refresh",e);b(t),f(String(t.triggerDebounceSec)),j(String(t.aiCooldownSec)),C(String(t.eventThrottleSec)),T(String(t.hysteresisRatio)),E(String(t.unstableFlipLimit)),L(String(t.unstableFlipWindowSeconds)),h("Prediction refresh settings saved.")}catch(e){m(c(e))}finally{d(!1)}}return(0,a.useEffect)(()=>{z()},[]),(0,i.jsxs)("div",{className:"settingsWrap",children:[(0,i.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,i.jsx)(l(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,i.jsx)(l(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,i.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 Prediction Refresh"}),t?(0,i.jsx)("div",{children:"Loading..."}):null,p?(0,i.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:p}):null,S?(0,i.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:S}):null,u?(0,i.jsxs)("section",{className:"card settingsSection",children:[(0,i.jsx)("div",{className:"settingsSectionHeader",children:(0,i.jsx)("h3",{style:{margin:0},children:"Scheduler Stability Controls"})}),(0,i.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:["Source: ",null!=(e=null==v?void 0:v.source)?e:"env"," \xb7 Last updated:"," ",(null==v?void 0:v.updatedAt)?new Date(v.updatedAt).toLocaleString():"never"]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:6},children:"Quick presets"}),(0,i.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:o.map(e=>(0,i.jsx)("button",{className:"btn",type:"button",title:e.description,onClick:()=>{var t,n;return t=e.values,n=e.label,void(f(String(t.triggerDebounceSec)),j(String(t.aiCooldownSec)),C(String(t.eventThrottleSec)),T(String(t.hysteresisRatio)),E(String(t.unstableFlipLimit)),L(String(t.unstableFlipWindowSeconds)),h("".concat(n," preset loaded (not saved yet).")))},children:e.label},e.key))}),(0,i.jsx)("div",{style:{marginTop:6,fontSize:12,color:"var(--muted)"},children:'Tipp: Preset laden, dann "Save settings".'})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))"},children:[(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Trigger debounce (sec)"}),(0,i.jsx)("input",{className:"input",type:"number",min:0,max:3600,value:y,onChange:e=>f(e.target.value)}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--muted)"},children:"Trigger muss stabil bleiben, bevor ein Refresh ausgel\xf6st wird."})]}),(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"AI cooldown (sec)"}),(0,i.jsx)("input",{className:"input",type:"number",min:30,max:3600,value:x,onChange:e=>j(e.target.value)}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--muted)"},children:"Mindestabstand zwischen OpenAI-Erkl\xe4rungen pro Symbol/TF."})]}),(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Event throttle (sec)"}),(0,i.jsx)("input",{className:"input",type:"number",min:0,max:3600,value:w,onChange:e=>C(e.target.value)}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--muted)"},children:"Wiederholte gleiche Events in kurzer Zeit werden unterdr\xfcckt."})]}),(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Hysteresis ratio (0.2 - 0.95)"}),(0,i.jsx)("input",{className:"input",type:"number",min:.2,max:.95,step:.01,value:N,onChange:e=>T(e.target.value)}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--muted)"},children:"H\xf6her = stabiler (weniger Flip), niedriger = reaktiver."})]}),(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Unstable flip limit"}),(0,i.jsx)("input",{className:"input",type:"number",min:2,max:20,value:k,onChange:e=>E(e.target.value)}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--muted)"},children:"Ab wie vielen Signal-Flips der Markt als instabil markiert wird."})]}),(0,i.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,i.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Unstable flip window (sec)"}),(0,i.jsx)("input",{className:"input",type:"number",min:60,max:86400,value:F,onChange:e=>L(e.target.value)}),(0,i.jsx)("span",{style:{fontSize:11,color:"var(--muted)"},children:"Zeitfenster, in dem die Flip-Anzahl gez\xe4hlt wird."})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,marginTop:12,flexWrap:"wrap"},children:[(0,i.jsx)("button",{className:"btn",type:"button",onClick:function(){(null==v?void 0:v.defaults)&&(f(String(v.defaults.triggerDebounceSec)),j(String(v.defaults.aiCooldownSec)),C(String(v.defaults.eventThrottleSec)),T(String(v.defaults.hysteresisRatio)),E(String(v.defaults.unstableFlipLimit)),L(String(v.defaults.unstableFlipWindowSeconds)),h("Default values loaded into form (not saved yet)."))},children:"Load defaults"}),(0,i.jsx)("button",{className:"btn btnPrimary",type:"button",onClick:()=>void A(),disabled:s,children:s?"Saving...":"Save settings"})]})]}):null]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=5220)),_N_E=e.O()}]);