(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{2883:(e,t,s)=>{"use strict";s.d(t,{$P:()=>m,Al:()=>h,GC:()=>g,Vg:()=>u,hD:()=>o,mu:()=>p});var n,a,l,i,r=s(7011);null!=(null!=(n=r.env.API_URL)?n:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let c=null!=(i=null!=(l=null!=(a=r.env.NEXT_PUBLIC_API_URL)?a:r.env.API_URL)?l:r.env.API_BASE_URL)?i:"http://localhost:4000";class o extends Error{constructor(e,t,s){super(e),this.status=t,this.payload=s}}async function d(e,t,s){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let a=await fetch("".concat(c).concat(t),{method:e,headers:n,body:s?JSON.stringify(s):void 0,credentials:"include",cache:"no-store"});if(!a.ok){let s=null;try{s=await a.json()}catch(e){}throw new o((null==s?void 0:s.error)||(null==s?void 0:s.message)||"".concat(e," ").concat(t," failed (").concat(a.status,")"),a.status,s)}return a.json()}function u(e){return d("GET",e)}function m(e,t){return d("POST",e,t)}function p(e,t){return d("PUT",e,t)}function h(e){return d("DELETE",e)}function g(e){return d("DELETE",e)}},6951:(e,t,s)=>{Promise.resolve().then(s.bind(s,8835))},8835:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var n=s(4568),a=s(9664),l=s.n(a),i=s(7620),r=s(2883);function c(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function o(){let[e,t]=(0,i.useState)(!0),[s,a]=(0,i.useState)(!1),[o,d]=(0,i.useState)(null),[u,m]=(0,i.useState)(null),[p,h]=(0,i.useState)([]),[g,f]=(0,i.useState)(null),[y,v]=(0,i.useState)(""),[x,j]=(0,i.useState)(""),[S,w]=(0,i.useState)(""),[b,N]=(0,i.useState)({});async function C(){t(!0),d(null);try{var e;let t=await (0,r.Vg)("/auth/me");if(f("string"==typeof(null==t?void 0:t.id)?t.id:null),!(null==t?void 0:t.isSuperadmin)){a(!1),d("Superadmin access required."),h([]);return}a(!0);let s=await (0,r.Vg)("/admin/users");h(null!=(e=s.items)?e:[])}catch(e){d(c(e))}finally{t(!1)}}(0,i.useEffect)(()=>{C()},[]);let E=(0,i.useMemo)(()=>{let e=y.trim().toLowerCase();return e?p.filter(t=>t.email.toLowerCase().includes(e)):p},[p,y]);async function P(e){e.preventDefault(),d(null),m(null);try{let e=await (0,r.$P)("/admin/users",{email:x,password:S.trim()||void 0});j(""),w(""),m(e.temporaryPassword?"User created. Temporary password: ".concat(e.temporaryPassword):"User created."),await C()}catch(e){d(c(e))}}async function _(e){var t;let s=(null!=(t=b[e])?t:"").trim();if(s){d(null),m(null);try{await (0,r.mu)("/admin/users/".concat(e,"/password"),{password:s}),N(t=>({...t,[e]:""})),m("Password updated and sessions revoked.")}catch(e){d(c(e))}}}async function T(e){if(confirm("Delete user ".concat(e.email,"? This cannot be undone."))){d(null),m(null);try{await (0,r.Al)("/admin/users/".concat(e.id)),m("Deleted ".concat(e.email,".")),await C()}catch(e){d(c(e))}}}return(0,n.jsxs)("div",{className:"settingsWrap",children:[(0,n.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)(l(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,n.jsx)(l(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,n.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 Users"}),e?(0,n.jsx)("div",{children:"Loading..."}):null,o?(0,n.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:o}):null,u?(0,n.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:u}):null,s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("h3",{style:{margin:0},children:"Create User"})}),(0,n.jsxs)("form",{onSubmit:P,style:{display:"grid",gap:8},children:[(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Email"}),(0,n.jsx)("input",{className:"input",value:x,onChange:e=>j(e.target.value),required:!0})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Temporary password (optional)"}),(0,n.jsx)("input",{className:"input",value:S,onChange:e=>w(e.target.value)})]}),(0,n.jsx)("button",{className:"btn btnPrimary",type:"submit",children:"Create user"})]})]}),(0,n.jsxs)("section",{className:"card settingsSection",children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("h3",{style:{margin:0},children:"User List"})}),(0,n.jsxs)("label",{style:{display:"grid",gap:6,marginBottom:12},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Search user"}),(0,n.jsx)("input",{className:"input",placeholder:"Filter by email...",value:y,onChange:e=>v(e.target.value)})]}),(0,n.jsxs)("div",{style:{display:"grid",gap:8},children:[E.map(e=>{var t;return(0,n.jsx)("div",{className:"card settingsSection",children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:8,flexWrap:"wrap"},children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{fontWeight:700},children:[e.email," ",e.isSuperadmin?"\xb7 superadmin":""]}),(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["Bots: ",e.bots," \xb7 Accounts: ",e.exchangeAccounts," \xb7 Sessions: ",e.sessions]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,n.jsx)("input",{className:"input",placeholder:"New password",value:null!=(t=b[e.id])?t:"",onChange:t=>N(s=>({...s,[e.id]:t.target.value}))}),(0,n.jsx)("button",{className:"btn",onClick:()=>void _(e.id),children:"Set password"}),(0,n.jsx)("button",{className:"btn btnStop",disabled:e.isSuperadmin||e.id===g,onClick:()=>void T(e),children:"Delete"})]})]})},e.id)}),0===E.length?(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"No users match the filter."}):null]})]})]}):null]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=6951)),_N_E=e.O()}]);