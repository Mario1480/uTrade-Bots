(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{14:(e,t,a)=>{Promise.resolve().then(a.bind(a,9816))},2883:(e,t,a)=>{"use strict";a.d(t,{$P:()=>m,Al:()=>p,GC:()=>g,Vg:()=>u,hD:()=>d,mu:()=>h});var n,s,i,l,r=a(7011);null!=(null!=(n=r.env.API_URL)?n:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let c=null!=(l=null!=(i=null!=(s=r.env.NEXT_PUBLIC_API_URL)?s:r.env.API_URL)?i:r.env.API_BASE_URL)?l:"http://localhost:4000";class d extends Error{constructor(e,t,a){super(e),this.status=t,this.payload=a}}async function o(e,t,a){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let s=await fetch("".concat(c).concat(t),{method:e,headers:n,body:a?JSON.stringify(a):void 0,credentials:"include",cache:"no-store"});if(!s.ok){let a=null;try{a=await s.json()}catch(e){}throw new d((null==a?void 0:a.error)||(null==a?void 0:a.message)||"".concat(e," ").concat(t," failed (").concat(s.status,")"),s.status,a)}return s.json()}function u(e){return o("GET",e)}function m(e,t){return o("POST",e,t)}function h(e,t){return o("PUT",e,t)}function p(e){return o("DELETE",e)}function g(e){return o("DELETE",e)}},9816:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var n=a(4568),s=a(9664),i=a.n(s),l=a(7620),r=a(2883);let c={enabledPacks:{indicatorsV1:!0,indicatorsV2:!0,tradersReality:!0,liquiditySweeps:!0},indicatorsV2:{stochrsi:{rsiLen:14,stochLen:14,smoothK:3,smoothD:3},volume:{lookback:100,emaFast:10,emaSlow:30},fvg:{lookback:300,fillRule:"overlap"}},tradersReality:{adrLen:14,awrLen:4,amrLen:6,rdLen:15,rwLen:13,openingRangeMin:30,sessionsUseDST:!0},liquiditySweeps:{len:5,mode:"both",extend:!0,maxBars:300,maxRecentEvents:20,maxActiveZones:20},aiGating:{minConfidenceForExplain:55,minChangeScore:.2}};function d(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function o(){var e,t;let[a,s]=(0,l.useState)(!0),[o,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(null),[y,x]=(0,l.useState)(null),[b,v]=(0,l.useState)([]),[j,f]=(0,l.useState)(null),[N,S]=(0,l.useState)(null),[k,C]=(0,l.useState)("global"),[R,T]=(0,l.useState)("bitget"),[w,V]=(0,l.useState)(""),[L,P]=(0,l.useState)("BTCUSDT"),[_,E]=(0,l.useState)("15m"),[I,U]=(0,l.useState)(c),A=(0,l.useMemo)(()=>"account"===k?w.trim().length>0:"symbol"===k?L.trim().length>0:"symbol_tf"!==k||L.trim().length>0&&_.trim().length>0,[w,k,L,_]),D=(0,l.useCallback)(async()=>{s(!0),g(null);try{var e,t;let a=await (0,r.Vg)("/auth/me");if(!(null==a?void 0:a.isSuperadmin)){h(!1),g("Superadmin access required.");return}h(!0);let n=await (0,r.Vg)("/api/admin/indicator-settings");v(null!=(e=n.items)?e:[]);let s=await (0,r.Vg)("/api/admin/indicator-settings/resolved");f(s),U(null!=(t=s.config)?t:c)}catch(e){g(d(e))}finally{s(!1)}},[]);async function B(){g(null);try{let e=new URLSearchParams;R.trim()&&e.set("exchange",R.trim()),w.trim()&&e.set("accountId",w.trim()),L.trim()&&e.set("symbol",L.trim()),_.trim()&&e.set("timeframe",_.trim());let t=e.toString(),a=await (0,r.Vg)("/api/admin/indicator-settings/resolved".concat(t?"?".concat(t):""));f(a)}catch(e){g(d(e))}}function z(){var e;S(null),C("global"),T("bitget"),V(""),P("BTCUSDT"),E("15m"),U(null!=(e=null==j?void 0:j.defaults)?e:c)}function O(e){var t,a,n,s,i,l;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S(r?null:e.id),C(e.scopeType),T(null!=(t=e.exchange)?t:"bitget"),V(null!=(a=e.accountId)?a:""),P(null!=(n=e.symbol)?n:"BTCUSDT"),E(null!=(s=e.timeframe)?s:"15m"),U(null!=(l=e.configEffective)?l:null!=(i=null==j?void 0:j.defaults)?i:c)}async function q(){if(A){u(!0),g(null),x(null);try{let e={scopeType:k,exchange:"global"===k?void 0:R.trim()||void 0,accountId:"account"===k?w.trim():void 0,symbol:"symbol"===k||"symbol_tf"===k?L.trim():void 0,timeframe:"symbol_tf"===k?_:void 0,config:I};N?(await (0,r.mu)("/api/admin/indicator-settings/".concat(N),e),x("Indicator setting updated.")):(await (0,r.$P)("/api/admin/indicator-settings",e),x("Indicator setting created.")),await D(),await B()}catch(e){g(d(e))}finally{u(!1)}}}async function G(e){if(confirm("Delete this indicator setting?")){g(null),x(null);try{await (0,r.Al)("/api/admin/indicator-settings/".concat(e)),N===e&&z(),x("Indicator setting deleted."),await D(),await B()}catch(e){g(d(e))}}}return(0,l.useEffect)(()=>{D()},[D]),(0,n.jsxs)("div",{className:"settingsWrap",children:[(0,n.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)(i(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,n.jsx)(i(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,n.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 Indicator Settings"}),(0,n.jsx)("div",{style:{fontSize:13,color:"var(--muted)",marginBottom:12},children:"Configure global defaults and scoped overrides for prediction feature packs."}),a?(0,n.jsx)("div",{children:"Loading..."}):null,p?(0,n.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:p}):null,y?(0,n.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:y}):null,m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("h3",{style:{margin:0},children:N?"Edit override":"Create override"})}),(0,n.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))"},children:[(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Scope"}),(0,n.jsxs)("select",{className:"input",value:k,onChange:e=>C(e.target.value),children:[(0,n.jsx)("option",{value:"global",children:"global"}),(0,n.jsx)("option",{value:"account",children:"account"}),(0,n.jsx)("option",{value:"symbol",children:"symbol"}),(0,n.jsx)("option",{value:"symbol_tf",children:"symbol_tf"})]})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Exchange"}),(0,n.jsx)("input",{className:"input",value:R,onChange:e=>T(e.target.value)})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Account ID"}),(0,n.jsx)("input",{className:"input",value:w,onChange:e=>V(e.target.value),disabled:"account"!==k})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Symbol"}),(0,n.jsx)("input",{className:"input",value:L,onChange:e=>P(e.target.value.toUpperCase()),disabled:"symbol"!==k&&"symbol_tf"!==k})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Timeframe"}),(0,n.jsxs)("select",{className:"input",value:_,onChange:e=>E(e.target.value),disabled:"symbol_tf"!==k,children:[(0,n.jsx)("option",{value:"5m",children:"5m"}),(0,n.jsx)("option",{value:"15m",children:"15m"}),(0,n.jsx)("option",{value:"1h",children:"1h"}),(0,n.jsx)("option",{value:"4h",children:"4h"}),(0,n.jsx)("option",{value:"1d",children:"1d"})]})]})]}),(0,n.jsxs)("div",{style:{marginTop:12,display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit,minmax(160px,1fr))"},children:[(0,n.jsxs)("label",{className:"inlineCheck",children:[(0,n.jsx)("input",{type:"checkbox",checked:I.enabledPacks.indicatorsV1,onChange:e=>U(t=>({...t,enabledPacks:{...t.enabledPacks,indicatorsV1:e.target.checked}}))})," Indicators V1"]}),(0,n.jsxs)("label",{className:"inlineCheck",children:[(0,n.jsx)("input",{type:"checkbox",checked:I.enabledPacks.indicatorsV2,onChange:e=>U(t=>({...t,enabledPacks:{...t.enabledPacks,indicatorsV2:e.target.checked}}))})," Indicators V2"]}),(0,n.jsxs)("label",{className:"inlineCheck",children:[(0,n.jsx)("input",{type:"checkbox",checked:I.enabledPacks.tradersReality,onChange:e=>U(t=>({...t,enabledPacks:{...t.enabledPacks,tradersReality:e.target.checked}}))})," TradersReality"]}),(0,n.jsxs)("label",{className:"inlineCheck",children:[(0,n.jsx)("input",{type:"checkbox",checked:I.enabledPacks.liquiditySweeps,onChange:e=>U(t=>({...t,enabledPacks:{...t.enabledPacks,liquiditySweeps:e.target.checked}}))})," Liquidity Sweeps"]})]}),(0,n.jsxs)("div",{style:{marginTop:12,display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit,minmax(160px,1fr))"},children:[(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"Stoch RSI len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.indicatorsV2.stochrsi.rsiLen,onChange:e=>U(t=>({...t,indicatorsV2:{...t.indicatorsV2,stochrsi:{...t.indicatorsV2.stochrsi,rsiLen:Number(e.target.value)}}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"Stoch len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.indicatorsV2.stochrsi.stochLen,onChange:e=>U(t=>({...t,indicatorsV2:{...t.indicatorsV2,stochrsi:{...t.indicatorsV2.stochrsi,stochLen:Number(e.target.value)}}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"Volume lookback"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.indicatorsV2.volume.lookback,onChange:e=>U(t=>({...t,indicatorsV2:{...t.indicatorsV2,volume:{...t.indicatorsV2.volume,lookback:Number(e.target.value)}}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"FVG lookback"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.indicatorsV2.fvg.lookback,onChange:e=>U(t=>({...t,indicatorsV2:{...t.indicatorsV2,fvg:{...t.indicatorsV2.fvg,lookback:Number(e.target.value)}}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"FVG fill rule"}),(0,n.jsxs)("select",{className:"input",value:I.indicatorsV2.fvg.fillRule,onChange:e=>U(t=>({...t,indicatorsV2:{...t.indicatorsV2,fvg:{...t.indicatorsV2.fvg,fillRule:e.target.value}}})),children:[(0,n.jsx)("option",{value:"overlap",children:"overlap"}),(0,n.jsx)("option",{value:"mid_touch",children:"mid_touch"})]})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"TR opening range (min)"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.tradersReality.openingRangeMin,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,openingRangeMin:Number(e.target.value)}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"ADR len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.tradersReality.adrLen,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,adrLen:Number(e.target.value)}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"AWR len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.tradersReality.awrLen,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,awrLen:Number(e.target.value)}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"AMR len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.tradersReality.amrLen,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,amrLen:Number(e.target.value)}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"RD len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.tradersReality.rdLen,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,rdLen:Number(e.target.value)}}))})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,n.jsx)("span",{className:"mutedTiny",children:"RW len"}),(0,n.jsx)("input",{className:"input",type:"number",value:I.tradersReality.rwLen,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,rwLen:Number(e.target.value)}}))})]}),(0,n.jsxs)("label",{className:"inlineCheck",children:[(0,n.jsx)("input",{type:"checkbox",checked:I.tradersReality.sessionsUseDST,onChange:e=>U(t=>({...t,tradersReality:{...t.tradersReality,sessionsUseDST:e.target.checked}}))})," Sessions use DST"]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:12},children:[(0,n.jsx)("button",{className:"btn btnPrimary",type:"button",disabled:o||!A,onClick:q,children:o?"Saving...":N?"Update override":"Create override"}),(0,n.jsx)("button",{className:"btn",type:"button",onClick:()=>void B(),children:"Preview resolved"}),(0,n.jsx)("button",{className:"btn",type:"button",onClick:z,children:"Reset form"})]})]}),(0,n.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("h3",{style:{margin:0},children:"Overrides"})}),0===b.length?(0,n.jsx)("div",{style:{color:"var(--muted)"},children:"No overrides yet."}):(0,n.jsx)("div",{style:{overflowX:"auto"},children:(0,n.jsxs)("table",{className:"table",style:{width:"100%"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Scope"}),(0,n.jsx)("th",{children:"Updated"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:b.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:function(e){let t=[e.scopeType];return e.exchange&&t.push("ex:".concat(e.exchange)),e.accountId&&t.push("acc:".concat(e.accountId.slice(0,10),"…")),e.symbol&&t.push("sym:".concat(e.symbol)),e.timeframe&&t.push("tf:".concat(e.timeframe)),t.join(" \xb7 ")}(e)}),(0,n.jsx)("td",{children:new Date(e.updatedAt).toLocaleString()}),(0,n.jsxs)("td",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,n.jsx)("button",{className:"btn",type:"button",onClick:()=>O(e),children:"Edit"}),(0,n.jsx)("button",{className:"btn",type:"button",onClick:()=>O(e,!0),children:"Clone"}),(0,n.jsx)("button",{className:"btn",type:"button",onClick:()=>void G(e.id),children:"Delete"})]})]},e.id))})]})})]}),(0,n.jsxs)("section",{className:"card settingsSection",children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("h3",{style:{margin:0},children:"Effective config preview"})}),(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Hash: ",null!=(e=null==j?void 0:j.hash)?e:"-"]}),(0,n.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(null!=(t=null==j?void 0:j.config)?t:c,null,2)})]})]}):null]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=14)),_N_E=e.O()}]);