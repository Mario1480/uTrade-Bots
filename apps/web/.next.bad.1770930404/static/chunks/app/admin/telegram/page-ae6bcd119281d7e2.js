(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[728],{250:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var l=n(4568),s=n(9664),a=n.n(s),i=n(7620),r=n(2883);function c(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function o(){let[e,t]=(0,i.useState)(!0),[n,s]=(0,i.useState)(!1),[o,u]=(0,i.useState)(null),[d,m]=(0,i.useState)(null),[g,h]=(0,i.useState)(""),[f,p]=(0,i.useState)(""),[v,y]=(0,i.useState)(!1),[x,S]=(0,i.useState)(null);async function j(){t(!0),u(null);try{var e,n;let t=await (0,r.Vg)("/auth/me");if(!(null==t?void 0:t.isSuperadmin)){s(!1),u("Superadmin access required.");return}s(!0);let l=await (0,r.Vg)("/admin/settings/telegram");y(!!l.configured),S(null!=(e=l.telegramBotTokenMasked)?e:null),p(null!=(n=l.telegramChatId)?n:""),h("")}catch(e){u(c(e))}finally{t(!1)}}async function T(){u(null),m(null);try{var e;let t={telegramBotToken:g.trim()||null,telegramChatId:f.trim()||null},n=await (0,r.mu)("/admin/settings/telegram",t);y(!!n.configured),S(null!=(e=n.telegramBotTokenMasked)?e:null),h(""),m("Telegram settings saved.")}catch(e){u(c(e))}}async function E(){u(null),m(null);try{await (0,r.$P)("/admin/settings/telegram/test"),m("Telegram test sent.")}catch(e){u(c(e))}}return(0,i.useEffect)(()=>{j()},[]),(0,l.jsxs)("div",{className:"settingsWrap",children:[(0,l.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,l.jsx)(a(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,l.jsx)(a(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,l.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 Global Telegram"}),e?(0,l.jsx)("div",{children:"Loading..."}):null,o?(0,l.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:o}):null,d?(0,l.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:d}):null,n?(0,l.jsxs)("section",{className:"card settingsSection",children:[(0,l.jsx)("div",{className:"settingsSectionHeader",children:(0,l.jsx)("h3",{style:{margin:0},children:"Telegram Settings"})}),(0,l.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Configured: ",v?"yes":"no",x?" \xb7 current token ".concat(x):""]}),(0,l.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,l.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,l.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Bot token"}),(0,l.jsx)("input",{className:"input",placeholder:null!=x?x:"123456:ABC...",value:g,onChange:e=>h(e.target.value)})]}),(0,l.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,l.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Chat ID"}),(0,l.jsx)("input",{className:"input",value:f,onChange:e=>p(e.target.value)})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,l.jsx)("button",{className:"btn btnPrimary",onClick:()=>void T(),children:"Save Telegram"}),(0,l.jsx)("button",{className:"btn",onClick:()=>void E(),children:"Send test"})]})]})]}):null]})}},2883:(e,t,n)=>{"use strict";n.d(t,{$P:()=>m,Al:()=>h,GC:()=>f,Vg:()=>d,hD:()=>o,mu:()=>g});var l,s,a,i,r=n(7011);null!=(null!=(l=r.env.API_URL)?l:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let c=null!=(i=null!=(a=null!=(s=r.env.NEXT_PUBLIC_API_URL)?s:r.env.API_URL)?a:r.env.API_BASE_URL)?i:"http://localhost:4000";class o extends Error{constructor(e,t,n){super(e),this.status=t,this.payload=n}}async function u(e,t,n){let l={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(l["x-csrf-token"]=e)}let s=await fetch("".concat(c).concat(t),{method:e,headers:l,body:n?JSON.stringify(n):void 0,credentials:"include",cache:"no-store"});if(!s.ok){let n=null;try{n=await s.json()}catch(e){}throw new o((null==n?void 0:n.error)||(null==n?void 0:n.message)||"".concat(e," ").concat(t," failed (").concat(s.status,")"),s.status,n)}return s.json()}function d(e){return u("GET",e)}function m(e,t){return u("POST",e,t)}function g(e,t){return u("PUT",e,t)}function h(e){return u("DELETE",e)}function f(e){return u("DELETE",e)}},6028:(e,t,n)=>{Promise.resolve().then(n.bind(n,250))}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=6028)),_N_E=e.O()}]);