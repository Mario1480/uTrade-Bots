(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{2883:(e,t,n)=>{"use strict";n.d(t,{$P:()=>m,Al:()=>y,GC:()=>h,Vg:()=>u,hD:()=>c,mu:()=>p});var l,s,a,i,o=n(7011);null!=(null!=(l=o.env.API_URL)?l:o.env.API_BASE_URL)||o.env.NEXT_PUBLIC_API_URL;let r=null!=(i=null!=(a=null!=(s=o.env.NEXT_PUBLIC_API_URL)?s:o.env.API_URL)?a:o.env.API_BASE_URL)?i:"http://localhost:4000";class c extends Error{constructor(e,t,n){super(e),this.status=t,this.payload=n}}async function d(e,t,n){let l={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(l["x-csrf-token"]=e)}let s=await fetch("".concat(r).concat(t),{method:e,headers:l,body:n?JSON.stringify(n):void 0,credentials:"include",cache:"no-store"});if(!s.ok){let n=null;try{n=await s.json()}catch(e){}throw new c((null==n?void 0:n.error)||(null==n?void 0:n.message)||"".concat(e," ").concat(t," failed (").concat(s.status,")"),s.status,n)}return s.json()}function u(e){return d("GET",e)}function m(e,t){return d("POST",e,t)}function p(e,t){return d("PUT",e,t)}function y(e){return d("DELETE",e)}function h(e){return d("DELETE",e)}},7216:(e,t,n)=>{Promise.resolve().then(n.bind(n,9358))},9358:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var l=n(4568),s=n(9664),a=n.n(s),i=n(7620),o=n(2883);function r(e){return e instanceof o.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function c(){var e,t,n,s;let[c,d]=(0,i.useState)(!0),[u,m]=(0,i.useState)(!1),[p,y]=(0,i.useState)(null),[h,g]=(0,i.useState)(null),[v,f]=(0,i.useState)(""),[k,A]=(0,i.useState)(null),[S,x]=(0,i.useState)(!1),[b,j]=(0,i.useState)(""),[w,P]=(0,i.useState)(null),[I,K]=(0,i.useState)(!1),[N,O]=(0,i.useState)(null),[_,E]=(0,i.useState)(!1),[B,M]=(0,i.useState)(!1),[C,F]=(0,i.useState)(!1),[L,R]=(0,i.useState)(null),[D,T]=(0,i.useState)(!1),[z,U]=(0,i.useState)(null);async function W(){F(!0);try{let e=await (0,o.Vg)("/admin/settings/api-keys/status");R(e)}catch(e){R({ok:!1,status:"error",source:"none",checkedAt:new Date().toISOString(),message:r(e)})}finally{F(!1)}}async function V(){T(!0);try{let e=await (0,o.Vg)("/admin/settings/api-keys/fmp-status");U(e)}catch(e){U({ok:!1,status:"error",source:"none",checkedAt:new Date().toISOString(),message:r(e)})}finally{T(!1)}}async function G(){d(!0),y(null);try{var e,t,n;let l=await (0,o.Vg)("/auth/me");if(!(null==l?void 0:l.isSuperadmin)){m(!1),y("Superadmin access required.");return}m(!0);let s=await (0,o.Vg)("/admin/settings/api-keys");A(null!=(e=s.openaiApiKeyMasked)?e:null),x(!!s.hasOpenAiApiKey),P(null!=(t=s.fmpApiKeyMasked)?t:null),K(!!s.hasFmpApiKey),O(null!=(n=s.updatedAt)?n:null),E(!!s.envOverride),M(!!s.envOverrideFmp),f(""),j(""),await W(),await V()}catch(e){y(r(e))}finally{d(!1)}}async function H(){let e=v.trim();if(!e)return void y("Please enter an OpenAI API key.");y(null),g(null);try{var t,n,l;let s=await (0,o.mu)("/admin/settings/api-keys",{openaiApiKey:e,clearOpenaiApiKey:!1});f(""),A(null!=(t=s.openaiApiKeyMasked)?t:null),x(!!s.hasOpenAiApiKey),P(null!=(n=s.fmpApiKeyMasked)?n:null),K(!!s.hasFmpApiKey),O(null!=(l=s.updatedAt)?l:null),g("OpenAI API key saved."),await W()}catch(e){y(r(e))}}async function X(){if(window.confirm("Remove the stored OpenAI API key?")){y(null),g(null);try{var e,t,n;let l=await (0,o.mu)("/admin/settings/api-keys",{clearOpenaiApiKey:!0});f(""),A(null!=(e=l.openaiApiKeyMasked)?e:null),x(!!l.hasOpenAiApiKey),P(null!=(t=l.fmpApiKeyMasked)?t:null),K(!!l.hasFmpApiKey),O(null!=(n=l.updatedAt)?n:null),g("OpenAI API key removed."),await W()}catch(e){y(r(e))}}}async function Y(){let e=b.trim();if(!e)return void y("Please enter an FMP API key.");y(null),g(null);try{var t,n,l;let s=await (0,o.mu)("/admin/settings/api-keys",{fmpApiKey:e,clearFmpApiKey:!1});j(""),A(null!=(t=s.openaiApiKeyMasked)?t:null),x(!!s.hasOpenAiApiKey),P(null!=(n=s.fmpApiKeyMasked)?n:null),K(!!s.hasFmpApiKey),O(null!=(l=s.updatedAt)?l:null),g("FMP API key saved."),await V()}catch(e){y(r(e))}}async function q(){if(window.confirm("Remove the stored FMP API key?")){y(null),g(null);try{var e,t,n;let l=await (0,o.mu)("/admin/settings/api-keys",{clearFmpApiKey:!0});j(""),A(null!=(e=l.openaiApiKeyMasked)?e:null),x(!!l.hasOpenAiApiKey),P(null!=(t=l.fmpApiKeyMasked)?t:null),K(!!l.hasFmpApiKey),O(null!=(n=l.updatedAt)?n:null),g("FMP API key removed."),await V()}catch(e){y(r(e))}}}return(0,i.useEffect)(()=>{G()},[]),(0,l.jsxs)("div",{className:"settingsWrap",children:[(0,l.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,l.jsx)(a(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,l.jsx)(a(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,l.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 API Keys"}),c?(0,l.jsx)("div",{children:"Loading..."}):null,p?(0,l.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:p}):null,h?(0,l.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:h}):null,u?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("section",{className:"card settingsSection",children:[(0,l.jsx)("div",{className:"settingsSectionHeader",children:(0,l.jsx)("h3",{style:{margin:0},children:"OpenAI Key (Global)"})}),(0,l.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Stored key: ",S?"yes":"no",k?" \xb7 ".concat(k):""]}),(0,l.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Last updated: ",N?new Date(N).toLocaleString():"never"]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:10},children:[(0,l.jsxs)("span",{className:"badge ".concat((null==L?void 0:L.status)==="ok"?"badgeOk":(null==L?void 0:L.status)==="missing_key"?"badgeWarn":"badgeDanger"),title:null!=(e=null==L?void 0:L.message)?e:"Status not checked yet.",children:["OpenAI status:"," ",C?"checking...":(null==L?void 0:L.status)==="ok"?"OK":(null==L?void 0:L.status)==="missing_key"?"missing key":"error"]}),(0,l.jsxs)("span",{style:{fontSize:12,color:"var(--muted)"},children:["Source: ",null!=(t=null==L?void 0:L.source)?t:_?"env":S?"db":"none","number"==typeof(null==L?void 0:L.latencyMs)?" \xb7 ".concat(L.latencyMs,"ms"):"",(null==L?void 0:L.checkedAt)?" \xb7 checked ".concat(new Date(L.checkedAt).toLocaleString()):""]}),(0,l.jsx)("button",{className:"btn",type:"button",onClick:()=>void W(),disabled:C,children:C?"Checking...":"Refresh status"})]}),(null==L?void 0:L.message)?(0,l.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:L.message}):null,_?(0,l.jsx)("div",{style:{fontSize:12,color:"#f59e0b",marginBottom:10},children:"ENV `AI_API_KEY` is still set. Remove it from `.env.prod` if you want DB-only key handling."}):null,(0,l.jsxs)("label",{style:{display:"grid",gap:6,marginBottom:10},children:[(0,l.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"New OpenAI API key"}),(0,l.jsx)("input",{className:"input",type:"password",placeholder:"sk-proj-...",value:v,onChange:e=>f(e.target.value)})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,l.jsx)("button",{className:"btn btnPrimary",onClick:()=>void H(),children:"Save OpenAI key"}),(0,l.jsx)("button",{className:"btn btnStop",onClick:()=>void X(),disabled:!S,children:"Remove stored key"})]})]}),(0,l.jsxs)("section",{className:"card settingsSection",children:[(0,l.jsx)("div",{className:"settingsSectionHeader",children:(0,l.jsx)("h3",{style:{margin:0},children:"FMP Key (Economic Calendar)"})}),(0,l.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Stored key: ",I?"yes":"no",w?" \xb7 ".concat(w):""]}),(0,l.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Last updated: ",N?new Date(N).toLocaleString():"never"]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:10},children:[(0,l.jsxs)("span",{className:"badge ".concat((null==z?void 0:z.status)==="ok"?"badgeOk":(null==z?void 0:z.status)==="missing_key"?"badgeWarn":"badgeDanger"),title:null!=(n=null==z?void 0:z.message)?n:"Status not checked yet.",children:["FMP status:"," ",D?"checking...":(null==z?void 0:z.status)==="ok"?"OK":(null==z?void 0:z.status)==="missing_key"?"missing key":"error"]}),(0,l.jsxs)("span",{style:{fontSize:12,color:"var(--muted)"},children:["Source: ",null!=(s=null==z?void 0:z.source)?s:B?"env":I?"db":"none","number"==typeof(null==z?void 0:z.latencyMs)?" \xb7 ".concat(z.latencyMs,"ms"):"",(null==z?void 0:z.checkedAt)?" \xb7 checked ".concat(new Date(z.checkedAt).toLocaleString()):""]}),(0,l.jsx)("button",{className:"btn",type:"button",onClick:()=>void V(),disabled:D,children:D?"Checking...":"Refresh status"})]}),(null==z?void 0:z.message)?(0,l.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:z.message}):null,B?(0,l.jsx)("div",{style:{fontSize:12,color:"#f59e0b",marginBottom:10},children:"ENV `FMP_API_KEY` is still set. Remove it from `.env.prod` if you want DB-only key handling."}):null,(0,l.jsxs)("label",{style:{display:"grid",gap:6,marginBottom:10},children:[(0,l.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"New FMP API key"}),(0,l.jsx)("input",{className:"input",type:"password",placeholder:"fmp_...",value:b,onChange:e=>j(e.target.value)})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,l.jsx)("button",{className:"btn btnPrimary",onClick:()=>void Y(),children:"Save FMP key"}),(0,l.jsx)("button",{className:"btn btnStop",onClick:()=>void q(),disabled:!I,children:"Remove stored key"})]})]})]}):null]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=7216)),_N_E=e.O()}]);