(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2883:(e,t,n)=>{"use strict";n.d(t,{$P:()=>g,Al:()=>m,GC:()=>y,Vg:()=>u,hD:()=>o,mu:()=>h});var s,l,a,i,c=n(7011);null!=(null!=(s=c.env.API_URL)?s:c.env.API_BASE_URL)||c.env.NEXT_PUBLIC_API_URL;let r=null!=(i=null!=(a=null!=(l=c.env.NEXT_PUBLIC_API_URL)?l:c.env.API_URL)?a:c.env.API_BASE_URL)?i:"http://localhost:4000";class o extends Error{constructor(e,t,n){super(e),this.status=t,this.payload=n}}async function d(e,t,n){let s={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(s["x-csrf-token"]=e)}let l=await fetch("".concat(r).concat(t),{method:e,headers:s,body:n?JSON.stringify(n):void 0,credentials:"include",cache:"no-store"});if(!l.ok){let n=null;try{n=await l.json()}catch(e){}throw new o((null==n?void 0:n.error)||(null==n?void 0:n.message)||"".concat(e," ").concat(t," failed (").concat(l.status,")"),l.status,n)}return l.json()}function u(e){return d("GET",e)}function g(e,t){return d("POST",e,t)}function h(e,t){return d("PUT",e,t)}function m(e){return d("DELETE",e)}function y(e){return d("DELETE",e)}},3072:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var s=n(4568),l=n(9664),a=n.n(l),i=n(7620),c=n(2883);function r(e){return e instanceof c.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function o(){var e;let[t,n]=(0,i.useState)(null),[l,o]=(0,i.useState)(!1),[d,u]=(0,i.useState)([]),[g,h]=(0,i.useState)([]),[m,y]=(0,i.useState)(!0),[p,v]=(0,i.useState)(!1),[f,x]=(0,i.useState)(null),[j,S]=(0,i.useState)(null),[b,N]=(0,i.useState)(null),[P,T]=(0,i.useState)("bitget"),[C,E]=(0,i.useState)(""),[B,A]=(0,i.useState)(""),[_,w]=(0,i.useState)(""),[U,L]=(0,i.useState)(""),z="bitget"===P;async function I(){y(!0),S(null);try{var e,t;let[s,l,a]=await Promise.all([(0,c.Vg)("/auth/me"),(0,c.Vg)("/exchange-accounts"),(0,c.Vg)("/settings/exchange-options")]);n(s.user),o(!!s.isSuperadmin),u(null!=(e=l.items)?e:[]);let i=(null!=(t=a.options)?t:[]).filter(e=>e.enabled);h(i),i.length>0&&!i.some(e=>e.value===P)&&T(i[0].value)}catch(e){S(r(e))}finally{y(!1)}}async function k(e){e.preventDefault(),v(!0),S(null),N(null);try{await (0,c.$P)("/exchange-accounts",{exchange:P,label:C,apiKey:B,apiSecret:_,passphrase:U||void 0}),E(""),A(""),w(""),L(""),await I()}catch(e){S(r(e))}finally{v(!1)}}async function q(e){S(null),N(null);try{await (0,c.Al)("/exchange-accounts/".concat(e)),await I()}catch(e){S(r(e))}}async function O(e){S(null),N(null),x(e);try{var t,n,s;let l=await (0,c.$P)("/exchange-accounts/".concat(e,"/test-connection")),a=["Sync successful",(null==l||null==(t=l.futuresBudget)?void 0:t.marginCoin)?"(".concat(l.futuresBudget.marginCoin,")"):null,(null==l?void 0:l.pnlTodayUsd)!==null&&(null==l?void 0:l.pnlTodayUsd)!==void 0?"PnL ".concat(l.pnlTodayUsd):null,(null==l||null==(n=l.futuresBudget)?void 0:n.equity)!==null&&(null==l||null==(s=l.futuresBudget)?void 0:s.equity)!==void 0?"equity ".concat(l.futuresBudget.equity):null].filter(Boolean);N(a.join(" ")),await I()}catch(e){S(r(e))}finally{x(null)}}return(0,i.useEffect)(()=>{I()},[]),(0,s.jsxs)("div",{className:"settingsWrap",children:[(0,s.jsx)("h2",{style:{marginTop:0},children:"Settings"}),(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)",marginBottom:12},children:"User self-service and exchange account management."}),j?(0,s.jsx)("div",{className:"card",style:{padding:10,borderColor:"#ef4444",marginBottom:12},children:j}):null,b?(0,s.jsx)("div",{className:"card",style:{padding:10,borderColor:"#22c55e",marginBottom:12},children:b}):null,l?(0,s.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,s.jsx)("div",{className:"settingsSectionHeader",children:(0,s.jsx)("h3",{style:{margin:0},children:"Admin"})}),(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)",marginBottom:10},children:"User management, global Telegram, offered CEX list and SMTP settings."}),(0,s.jsx)(a(),{href:"/admin",className:"btn btnPrimary",children:"Open admin backend"})]}):null,(0,s.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,s.jsx)("h3",{style:{marginTop:0},children:"Account"}),m?(0,s.jsx)("div",{children:"Loading..."}):(0,s.jsx)("div",{children:null!=(e=null==t?void 0:t.email)?e:"-"})]}),(0,s.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,s.jsx)("div",{className:"settingsSectionHeader",children:(0,s.jsx)("h3",{style:{margin:0},children:"Security"})}),(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)",marginBottom:10},children:"Create or change your password and manage your session security settings."}),(0,s.jsx)(a(),{href:"/settings/users",className:"btn",children:"Open account security"})]}),(0,s.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,s.jsx)("h3",{style:{marginTop:0},children:"Notifications"}),(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)",marginBottom:10},children:"Configure Telegram alerts for tradable prediction signals."}),(0,s.jsx)(a(),{href:"/settings/notifications",className:"btn",children:"Open Telegram settings"})]}),(0,s.jsxs)("section",{className:"card settingsSection",style:{marginBottom:12},children:[(0,s.jsx)("h3",{style:{marginTop:0},children:"Add Exchange Account"}),(0,s.jsxs)("form",{onSubmit:k,style:{display:"grid",gap:10},children:[0===g.length?(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"No exchange is enabled by admin yet."}):null,(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,s.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Exchange"}),(0,s.jsx)("select",{className:"input",value:P,onChange:e=>T(e.target.value),required:!0,children:g.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Label"}),(0,s.jsx)("input",{className:"input",value:C,onChange:e=>E(e.target.value),required:!0})]})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"API Key"}),(0,s.jsx)("input",{className:"input",value:B,onChange:e=>A(e.target.value),required:!0})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"API Secret"}),(0,s.jsx)("input",{className:"input",value:_,onChange:e=>w(e.target.value),required:!0})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:z?"Passphrase (required for Bitget)":"Passphrase (optional)"}),(0,s.jsx)("input",{className:"input",value:U,onChange:e=>L(e.target.value),required:z})]}),(0,s.jsx)("button",{className:"btn btnPrimary",type:"submit",disabled:p||0===g.length||!P||!C||!B||!_||z&&!U,children:p?"Saving...":"Add account"})]})]}),(0,s.jsxs)("section",{className:"card settingsSection",children:[(0,s.jsx)("h3",{style:{marginTop:0},children:"Exchange Accounts"}),0===d.length?(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)"},children:"No accounts yet."}):(0,s.jsx)("div",{style:{display:"grid",gap:8},children:d.map(e=>(0,s.jsxs)("div",{className:"card",style:{padding:10,display:"flex",justifyContent:"space-between",gap:12,alignItems:"center"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:[e.exchange," \xb7 ",e.apiKeyMasked]}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["Last sync: ",e.lastUsedAt?new Date(e.lastUsedAt).toLocaleString():"Never"]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,s.jsx)("button",{className:"btn",onClick:()=>void O(e.id),disabled:f===e.id,children:f===e.id?"Syncing...":"Sync now"}),(0,s.jsx)("button",{className:"btn",onClick:()=>void q(e.id),children:"Delete"})]})]},e.id))})]})]})}},7460:(e,t,n)=>{Promise.resolve().then(n.bind(n,3072))}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=7460)),_N_E=e.O()}]);