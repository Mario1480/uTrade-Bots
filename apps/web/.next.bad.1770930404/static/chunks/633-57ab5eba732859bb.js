"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[633],{2883:(e,a,s)=>{s.d(a,{$P:()=>u,Al:()=>x,GC:()=>m,Vg:()=>h,hD:()=>d,mu:()=>v});var t,n,r,l,c=s(7011);null!=(null!=(t=c.env.API_URL)?t:c.env.API_BASE_URL)||c.env.NEXT_PUBLIC_API_URL;let i=null!=(l=null!=(r=null!=(n=c.env.NEXT_PUBLIC_API_URL)?n:c.env.API_URL)?r:c.env.API_BASE_URL)?l:"http://localhost:4000";class d extends Error{constructor(e,a,s){super(e),this.status=a,this.payload=s}}async function o(e,a,s){let t={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let a=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return a?decodeURIComponent(a[2]):null}("mm_csrf");e&&(t["x-csrf-token"]=e)}let n=await fetch("".concat(i).concat(a),{method:e,headers:t,body:s?JSON.stringify(s):void 0,credentials:"include",cache:"no-store"});if(!n.ok){let s=null;try{s=await n.json()}catch(e){}throw new d((null==s?void 0:s.error)||(null==s?void 0:s.message)||"".concat(e," ").concat(a," failed (").concat(n.status,")"),n.status,s)}return n.json()}function h(e){return o("GET",e)}function u(e,a){return o("POST",e,a)}function v(e,a){return o("PUT",e,a)}function x(e){return o("DELETE",e)}function m(e){return o("DELETE",e)}},6014:(e,a,s)=>{s.r(a),s.d(a,{default:()=>g});var t=s(4568),n=s(9664),r=s.n(n),l=s(7620);function c(e){return null==e||Number.isNaN(e)?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}).format(e)}function i(e){if(!e)return"Never";let a=new Date(e).getTime();if(Number.isNaN(a))return"Unknown";let s=Math.floor(Math.max(0,Date.now()-a)/1e3);if(s<60)return"".concat(s,"s ago");let t=Math.floor(s/60);if(t<60)return"".concat(t,"m ago");let n=Math.floor(t/60);if(n<24)return"".concat(n,"h ago");let r=Math.floor(n/24);return"".concat(r,"d ago")}function d(e){return"connected"===e?"Connected":"degraded"===e?"Degraded":"Disconnected"}function o(e){var a,s,n;let{overview:l}=e;return(0,t.jsxs)("article",{className:"card exchangeOverviewCard",children:[(0,t.jsxs)("header",{className:"exchangeOverviewHeader",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"exchangeOverviewTitle",children:[l.exchange.toUpperCase()," — ",l.label]}),(0,t.jsxs)("div",{className:"exchangeOverviewSub",children:["Last sync: ",i(l.lastSyncAt)]})]}),(0,t.jsx)("span",{className:"connected"===(n=l.status)?"badge badgeOk":"degraded"===n?"badge badgeWarn":"badge badgeDanger",title:"Status: ".concat(d(l.status)),children:d(l.status)})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStats",children:[(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"exchangeOverviewStatTitle",children:"Spot Budget"}),(0,t.jsx)("div",{className:"exchangeOverviewStatValue",children:l.spotBudget?"".concat(c(l.spotBudget.available)," / ").concat(c(l.spotBudget.total)):"—"})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"exchangeOverviewStatTitle",children:"Futures Budget"}),(0,t.jsx)("div",{className:"exchangeOverviewStatValue",children:l.futuresBudget?"".concat(c(l.futuresBudget.equity)," / ").concat(c(l.futuresBudget.availableMargin)):"—"})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"exchangeOverviewStatTitle",children:"Today PnL"}),(0,t.jsx)("div",{className:"exchangeOverviewStatValue",children:c(l.pnlTodayUsd)})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"exchangeOverviewStatTitle",children:"Bots / Predictions"}),(0,t.jsxs)("div",{className:"exchangeOverviewBotStatus",children:[(0,t.jsxs)("span",{children:["Run ",l.bots.running]}),(0,t.jsxs)("span",{children:["Stop ",l.bots.stopped]}),(0,t.jsxs)("span",{className:l.bots.error>0?"exchangeOverviewBotError":"",children:["Err ",l.bots.error]}),(0,t.jsxs)("span",{children:["Pred ",l.runningPredictions]})]})]})]}),(null==(a=l.lastSyncError)?void 0:a.message)?(0,t.jsx)("div",{className:"exchangeOverviewAlert",children:(0,t.jsxs)("span",{children:["Last sync failed",l.lastSyncError.at?" (".concat(i(l.lastSyncError.at),")"):"",": ",l.lastSyncError.message]})}):null,l.alerts.hasErrors?(0,t.jsxs)("div",{className:"exchangeOverviewAlert",children:[(0,t.jsx)("span",{children:null!=(s=l.alerts.message)?s:"Bot errors detected."}),(0,t.jsx)(r(),{href:"/bots?exchangeAccountId=".concat(encodeURIComponent(l.exchangeAccountId),"&status=error"),className:"exchangeOverviewAlertLink",children:"View errors"})]}):null,(0,t.jsxs)("footer",{className:"exchangeOverviewActions",children:[(0,t.jsx)(r(),{href:"/trade?exchangeAccountId=".concat(encodeURIComponent(l.exchangeAccountId)),className:"btn btnPrimary",children:"Manual Trading"}),(0,t.jsx)(r(),{href:"/bots?exchangeAccountId=".concat(encodeURIComponent(l.exchangeAccountId)),className:"btn",children:"Bots"}),(0,t.jsx)(r(),{href:"/settings",className:"btn",children:"Settings"})]})]})}function h(e){let{alerts:a}=e;return(0,t.jsxs)("section",{className:"card dashboardAlertsCard",children:[(0,t.jsx)("div",{className:"dashboardAlertsTitle",children:"Global Alerts"}),0===a.length?(0,t.jsx)("div",{className:"dashboardAlertsEmpty",children:"No active alerts."}):(0,t.jsx)("div",{className:"dashboardAlertsList",children:a.map(e=>{var a;let s=(0,t.jsxs)("div",{className:"dashboardAlertItem dashboardAlertItem-".concat(e.severity),children:[(0,t.jsxs)("div",{className:"dashboardAlertTop",children:[(0,t.jsx)("span",{className:"critical"===(a=e.severity)?"badge badgeDanger dashboardAlertBadge":"warning"===a?"badge badgeWarn dashboardAlertBadge":"badge dashboardAlertBadge",children:e.severity.toUpperCase()}),(0,t.jsx)("span",{className:"dashboardAlertTime",title:new Date(e.ts).toLocaleString(),children:function(e){let a=new Date(e).getTime();if(!Number.isFinite(a))return"now";let s=Math.max(0,Math.floor((Date.now()-a)/1e3));if(s<60)return"".concat(s,"s ago");let t=Math.floor(s/60);if(t<60)return"".concat(t,"m ago");let n=Math.floor(t/60);if(n<24)return"".concat(n,"h ago");let r=Math.floor(n/24);return"".concat(r,"d ago")}(e.ts)})]}),(0,t.jsx)("div",{className:"dashboardAlertText",children:e.title}),e.message?(0,t.jsx)("div",{className:"dashboardAlertMessage",children:e.message}):null]});return e.link?(0,t.jsx)(r(),{href:e.link,className:"dashboardAlertLink",children:s},e.id):(0,t.jsx)("div",{children:s},e.id)})})]})}function u(e){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function v(e){let{totals:a}=e;return a?(0,t.jsxs)("div",{className:"statGrid dashboardTotalsBar",children:[(0,t.jsxs)("div",{className:"card statCard",children:[(0,t.jsxs)("div",{className:"statLabel",children:["Total Equity (",a.currency,")"]}),(0,t.jsx)("div",{className:"statValue",children:u(a.totalEquity)})]}),(0,t.jsxs)("div",{className:"card statCard",children:[(0,t.jsxs)("div",{className:"statLabel",children:["Total Available Margin (",a.currency,")"]}),(0,t.jsx)("div",{className:"statValue",children:u(a.totalAvailableMargin)})]}),(0,t.jsxs)("div",{className:"card statCard",children:[(0,t.jsxs)("div",{className:"statLabel",children:["Total Today PnL (",a.currency,")"]}),(0,t.jsx)("div",{className:"statValue",children:u(a.totalTodayPnl)}),(0,t.jsxs)("div",{className:"dashboardTotalsMeta",children:["Included accounts: ",a.includedAccounts]})]})]}):null}var x=s(2883);function m(){return(0,t.jsxs)("article",{className:"card exchangeOverviewCard exchangeOverviewSkeleton","aria-hidden":!0,children:[(0,t.jsx)("div",{className:"skeletonLine skeletonLineLg"}),(0,t.jsx)("div",{className:"skeletonLine skeletonLineMd"}),(0,t.jsxs)("div",{className:"exchangeOverviewStats",style:{marginTop:10},children:[(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"skeletonLine skeletonLineSm"}),(0,t.jsx)("div",{className:"skeletonLine skeletonLineMd"})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"skeletonLine skeletonLineSm"}),(0,t.jsx)("div",{className:"skeletonLine skeletonLineMd"})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"skeletonLine skeletonLineSm"}),(0,t.jsx)("div",{className:"skeletonLine skeletonLineMd"})]}),(0,t.jsxs)("div",{className:"exchangeOverviewStatBlock",children:[(0,t.jsx)("div",{className:"skeletonLine skeletonLineSm"}),(0,t.jsx)("div",{className:"skeletonLine skeletonLineMd"})]})]}),(0,t.jsxs)("div",{className:"exchangeOverviewActions",style:{marginTop:10},children:[(0,t.jsx)("div",{className:"skeletonButton"}),(0,t.jsx)("div",{className:"skeletonButton"})]})]})}function g(){let[e,a]=(0,l.useState)([]),[s,n]=(0,l.useState)(null),[c,i]=(0,l.useState)([]),[d,u]=(0,l.useState)(null),[g,j]=(0,l.useState)(null),[N,f]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=!0;async function s(){var s,t,r;f(!0),j(null);try{let[l,c,d]=await Promise.allSettled([(0,x.Vg)("/dashboard/overview"),(0,x.Vg)("/dashboard/alerts?limit=10"),(0,x.Vg)("/economic-calendar/next?currency=USD&impact=high")]);if(!e)return;if("fulfilled"===l.status){let e=l.value;Array.isArray(e)?(a(e),n(null)):(a(Array.isArray(e.accounts)?e.accounts:[]),n(null!=(s=e.totals)?s:null))}else throw l.reason;"fulfilled"===c.status?i(Array.isArray(null==(t=c.value)?void 0:t.items)?c.value.items:[]):i([]),"fulfilled"===d.status?u(null!=(r=d.value)?r:null):u(null)}catch(a){if(!e)return;j(a instanceof x.hD?"".concat(a.message," (HTTP ").concat(a.status,")"):a&&"object"==typeof a&&"message"in a?String(a.message):String(a))}finally{e&&f(!1)}}s();let t=setInterval(()=>{s()},2e4);return()=>{e=!1,clearInterval(t)}},[]);let b=(0,l.useMemo)(()=>e.reduce((e,a)=>(e.accounts+=1,e.running+=a.bots.running,e.errors+=a.bots.error,e),{accounts:0,running:0,errors:0}),[e]);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"dashboardHeader",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{style:{margin:0},children:"Dashboard"}),(0,t.jsx)("div",{style:{fontSize:13,color:"var(--muted)"},children:"One overview card per exchange account."})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,t.jsx)(r(),{href:"/predictions",className:"btn",children:"Predictions"}),(0,t.jsx)(r(),{href:"/calendar",className:"btn",children:"Calendar"}),(0,t.jsx)(r(),{href:"/trade",className:"btn",children:"Manual Trading"}),(0,t.jsx)(r(),{href:"/bots/new",className:"btn btnPrimary",children:"New Futures Bot"})]})]}),(0,t.jsxs)("div",{className:"statGrid",children:[(0,t.jsxs)("div",{className:"card statCard",children:[(0,t.jsx)("div",{className:"statLabel",children:"Exchange Accounts"}),(0,t.jsx)("div",{className:"statValue",children:N?"…":b.accounts})]}),(0,t.jsxs)("div",{className:"card statCard",children:[(0,t.jsx)("div",{className:"statLabel",children:"Running Bots"}),(0,t.jsx)("div",{className:"statValue",children:N?"…":b.running})]}),(0,t.jsxs)("div",{className:"card statCard",children:[(0,t.jsx)("div",{className:"statLabel",children:"Bots in Error"}),(0,t.jsx)("div",{className:"statValue",children:N?"…":b.errors})]})]}),(0,t.jsx)(v,{totals:s}),(0,t.jsx)(h,{alerts:c}),(0,t.jsxs)("div",{className:"card",style:{padding:12,marginBottom:12},children:[(0,t.jsx)("div",{style:{fontWeight:700,marginBottom:4},children:"Economic Calendar (USD / high)"}),d?d.blackoutActive&&d.activeWindow?(0,t.jsxs)("div",{style:{fontSize:13,color:"#ef4444"},children:["Blackout active until ",new Date(d.activeWindow.to).toLocaleString()," \xb7"," ",d.activeWindow.event.title]}):d.nextEvent?(0,t.jsxs)("div",{style:{fontSize:13,color:"var(--muted)"},children:["Next event: ",d.nextEvent.title," at"," ",new Date(d.nextEvent.ts).toLocaleString()]}):(0,t.jsx)("div",{style:{fontSize:13,color:"var(--muted)"},children:"No upcoming high-impact events."}):(0,t.jsx)("div",{style:{fontSize:13,color:"var(--muted)"},children:"Loading calendar status…"})]}),g?(0,t.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#ef4444",marginBottom:12},children:[(0,t.jsx)("strong",{children:"Load error:"})," ",g]}):null,N?(0,t.jsxs)("div",{className:"exchangeOverviewGrid",children:[(0,t.jsx)(m,{}),(0,t.jsx)(m,{}),(0,t.jsx)(m,{})]}):0===e.length?(0,t.jsxs)("div",{className:"card exchangeOverviewEmpty",children:[(0,t.jsx)("h3",{style:{marginTop:0},children:"No exchange accounts yet"}),(0,t.jsx)("p",{style:{color:"var(--muted)",marginTop:0},children:"Add your first exchange account to start manual trading and bot management."}),(0,t.jsx)(r(),{href:"/settings",className:"btn btnPrimary",children:"Add Exchange Account"})]}):(0,t.jsx)("div",{className:"exchangeOverviewGrid",children:e.map(e=>(0,t.jsx)(o,{overview:e},e.exchangeAccountId))})]})}}}]);