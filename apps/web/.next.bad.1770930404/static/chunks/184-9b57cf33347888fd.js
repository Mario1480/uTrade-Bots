"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[184],{1237:(e,t,i)=>{function n(e){var t=e.width,i=e.height;if(t<0)throw Error("Negative width is not allowed for Size");if(i<0)throw Error("Negative height is not allowed for Size");return{width:t,height:i}}function l(e,t){return e.width===t.width&&e.height===t.height}i.d(t,{Dv:()=>r,zE:()=>l,Ej:()=>n,vb:()=>c});var a=function(){function e(e){var t=this;this._resolutionListener=function(){return t._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=e,this._installResolutionListener()}return e.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(e.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e){var t=this,i={next:e};return this._observers.push(i),{unsubscribe:function(){t._observers=t._observers.filter(function(e){return e!==i})}}},e.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw Error("Resolution listener is already installed");var e=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(e,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},e.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},e.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},e.prototype._onResolutionChanged=function(){var e=this;this._observers.forEach(function(t){return t.next(e._window.devicePixelRatio)}),this._reinstallResolutionListener()},e}(),s=function(){function e(e,t,i){var l;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=e,this._canvasElementClientSize=n({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=t?t:function(e){return e},this._allowResizeObserver=null==(l=null==i?void 0:i.allowResizeObserver)||l,this._chooseAndInitObserver()}return e.prototype.dispose=function(){var e,t;if(null===this._canvasElement)throw Error("Object is disposed");null==(e=this._canvasElementResizeObserver)||e.disconnect(),this._canvasElementResizeObserver=null,null==(t=this._devicePixelRatioObservable)||t.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(e.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bitmapSize",{get:function(){return n({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),e.prototype.resizeCanvasElement=function(e){this._canvasElementClientSize=n(e),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},e.prototype.subscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners.push(e)},e.prototype.unsubscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(t){return t!==e})},Object.defineProperty(e.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),e.prototype.subscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners.push(e)},e.prototype.unsubscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(t){return t!==e})},e.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var e=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(e),this._emitSuggestedBitmapSizeChanged(e,this._suggestedBitmapSize)}},e.prototype._resizeBitmap=function(e){var t=this.bitmapSize;l(t,e)||(this.canvasElement.width=e.width,this.canvasElement.height=e.height,this._emitBitmapSizeChanged(t,e))},e.prototype._emitBitmapSizeChanged=function(e,t){var i=this;this._bitmapSizeChangedListeners.forEach(function(n){return n.call(i,e,t)})},e.prototype._suggestNewBitmapSize=function(e){var t=this._suggestedBitmapSize,i=n(this._transformBitmapSize(e,this._canvasElementClientSize)),a=l(this.bitmapSize,i)?null:i;(null!==t||null!==a)&&(null!==t&&null!==a&&l(t,a)||(this._suggestedBitmapSize=a,this._emitSuggestedBitmapSizeChanged(t,a)))},e.prototype._emitSuggestedBitmapSizeChanged=function(e,t){var i=this;this._suggestedBitmapSizeChangedListeners.forEach(function(n){return n.call(i,e,t)})},e.prototype._chooseAndInitObserver=function(){var e=this;if(!this._allowResizeObserver)return void this._initDevicePixelRatioObservable();new Promise(function(e){var t=new ResizeObserver(function(i){e(i.every(function(e){return"devicePixelContentBoxSize"in e})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1}).then(function(t){return t?e._initResizeObserver():e._initDevicePixelRatioObservable()})},e.prototype._initDevicePixelRatioObservable=function(){var e=this;if(null!==this._canvasElement){var t=o(this._canvasElement);if(null===t)throw Error("No window is associated with the canvas");this._devicePixelRatioObservable=new a(t),this._devicePixelRatioObservable.subscribe(function(){return e._invalidateBitmapSize()}),this._invalidateBitmapSize()}},e.prototype._invalidateBitmapSize=function(){if(null!==this._canvasElement){var e,t,i=o(this._canvasElement);if(null!==i){var l,a,s=null!=(t=null==(e=this._devicePixelRatioObservable)?void 0:e.value)?t:i.devicePixelRatio,r=this._canvasElement.getClientRects(),d=void 0!==r[0]?(l=r[0],a=s,n({width:Math.round(l.left*a+l.width*a)-Math.round(l.left*a),height:Math.round(l.top*a+l.height*a)-Math.round(l.top*a)})):n({width:this._canvasElementClientSize.width*s,height:this._canvasElementClientSize.height*s});this._suggestNewBitmapSize(d)}}},e.prototype._initResizeObserver=function(){var e=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver(function(t){var i=t.find(function(t){return t.target===e._canvasElement});if(i&&i.devicePixelContentBoxSize&&i.devicePixelContentBoxSize[0]){var l=i.devicePixelContentBoxSize[0],a=n({width:l.inlineSize,height:l.blockSize});e._suggestNewBitmapSize(a)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},e}();function r(e,t){if("device-pixel-content-box"===t.type)return new s(e,t.transform,t.options);throw Error("Unsupported binding target")}function o(e){return e.ownerDocument.defaultView}var d=function(){function e(e,t,i){if(0===t.width||0===t.height)throw TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=t,0===i.width||0===i.height)throw TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=e}return e.prototype.useMediaCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),e({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},e.prototype.useBitmapCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),e({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(e.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),e}();function c(e,t){var i=e.canvasElementClientSize;if(0===i.width||0===i.height)return null;var n=e.bitmapSize;if(0===n.width||0===n.height)return null;var l=e.canvasElement.getContext("2d",t);return null===l?null:new d(l,i,n)}},2883:(e,t,i)=>{i.d(t,{$P:()=>p,Al:()=>m,GC:()=>g,Vg:()=>u,hD:()=>d,mu:()=>h});var n,l,a,s,r=i(7011);null!=(null!=(n=r.env.API_URL)?n:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let o=null!=(s=null!=(a=null!=(l=r.env.NEXT_PUBLIC_API_URL)?l:r.env.API_URL)?a:r.env.API_BASE_URL)?s:"http://localhost:4000";class d extends Error{constructor(e,t,i){super(e),this.status=t,this.payload=i}}async function c(e,t,i){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let l=await fetch("".concat(o).concat(t),{method:e,headers:n,body:i?JSON.stringify(i):void 0,credentials:"include",cache:"no-store"});if(!l.ok){let i=null;try{i=await l.json()}catch(e){}throw new d((null==i?void 0:i.error)||(null==i?void 0:i.message)||"".concat(e," ").concat(t," failed (").concat(l.status,")"),l.status,i)}return l.json()}function u(e){return c("GET",e)}function p(e,t){return c("POST",e,t)}function h(e,t){return c("PUT",e,t)}function m(e){return c("DELETE",e)}function g(e){return c("DELETE",e)}},4834:(e,t,i)=>{i.r(t),i.d(t,{default:()=>C});var n,l,a,s=i(4568),r=i(9664),o=i.n(r),d=i(7620),c=i(7541),u=i(2883),p=i(5606),h=i(7471);let m={ema5:!1,ema13:!1,ema50:!0,ema200:!0,ema800:!1,emaCloud50:!1,vwapSession:!1,dailyOpen:!1},g={scalping:{label:"Scalping",toggles:{ema5:!0,ema13:!0,ema50:!1,ema200:!1,ema800:!1,emaCloud50:!1,vwapSession:!0,dailyOpen:!0}},trend:{label:"Trend",toggles:{ema5:!1,ema13:!1,ema50:!0,ema200:!0,ema800:!0,emaCloud50:!0,vwapSession:!1,dailyOpen:!0}},off:{label:"Alle aus",toggles:{ema5:!1,ema13:!1,ema50:!1,ema200:!1,ema800:!1,emaCloud50:!1,vwapSession:!1,dailyOpen:!1}},all:{label:"Alle an",toggles:{ema5:!0,ema13:!0,ema50:!0,ema200:!0,ema800:!0,emaCloud50:!0,vwapSession:!0,dailyOpen:!0}}};function v(e,t){if(t<=0||e.length<t)return[];let i=[],n=0;for(let i=0;i<t;i+=1)n+=e[i].close;let l=n/t;i.push({time:Math.floor(e[t-1].ts/1e3),value:l});let a=2/(t+1);for(let n=t;n<e.length;n+=1)l=e[n].close*a+l*(1-a),i.push({time:Math.floor(e[n].ts/1e3),value:l});return i}function b(e){let{exchangeAccountId:t,symbol:i,timeframe:n,prefill:l}=e,a=(0,d.useRef)(null),r=(0,d.useRef)(null),o=(0,d.useRef)(null),c=(0,d.useRef)([]),p=(0,d.useRef)({ema5:null,ema13:null,ema50:null,ema200:null,ema800:null}),b=(0,d.useRef)(null),f=(0,d.useRef)(null),x=(0,d.useRef)(null),y=(0,d.useRef)(null),_=(0,d.useRef)(null),[S,j]=(0,d.useState)("loading"),[w,N]=(0,d.useState)("Loading candles..."),[C,k]=(0,d.useState)([]),[O,z]=(0,d.useState)(null),[I,M]=(0,d.useState)(!1),[E,P]=(0,d.useState)(!1),[T,R]=(0,d.useState)(m),L=(0,d.useMemo)(()=>{for(let[t,i]of Object.entries(g)){var e;if(e=i.toggles,T.ema5===e.ema5&&T.ema13===e.ema13&&T.ema50===e.ema50&&T.ema200===e.ema200&&T.ema800===e.ema800&&T.emaCloud50===e.emaCloud50&&T.vwapSession===e.vwapSession&&T.dailyOpen===e.dailyOpen)return t}return null},[T]),B=(0,d.useMemo)(()=>"1m"===n||"5m"===n||"15m"===n||"1h"===n||"4h"===n||"1d"===n?n:"15m",[n]);return(0,d.useEffect)(()=>{if(!a.current)return;let e=(0,h.R9)(a.current,{autoSize:!0,height:520,layout:{background:{type:h.mE.Solid,color:"#07101f"},textColor:"#c7d2e2"},grid:{vertLines:{color:"rgba(148,163,184,.08)"},horzLines:{color:"rgba(148,163,184,.08)"}},rightPriceScale:{borderColor:"rgba(148,163,184,.25)"},timeScale:{borderColor:"rgba(148,163,184,.25)",timeVisible:!0,secondsVisible:!1,rightOffset:14},crosshair:{vertLine:{color:"rgba(255,255,255,.22)",width:1},horzLine:{color:"rgba(255,255,255,.22)",width:1}}}),t=e.addSeries(h.HD,{upColor:"#22c55e",downColor:"#ef4444",borderVisible:!1,wickUpColor:"#22c55e",wickDownColor:"#ef4444"});return p.current.ema5=e.addSeries(h.Im,{color:"#f7d047",lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),p.current.ema13=e.addSeries(h.Im,{color:"#f87171",lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),p.current.ema50=e.addSeries(h.Im,{color:"#22d3ee",lineWidth:2,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),p.current.ema200=e.addSeries(h.Im,{color:"#e2e8f0",lineWidth:2,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),p.current.ema800=e.addSeries(h.Im,{color:"#8b5cf6",lineWidth:2,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),b.current=e.addSeries(h.Im,{color:"rgba(34,211,238,.45)",lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),f.current=e.addSeries(h.Im,{color:"rgba(34,211,238,.45)",lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),x.current=e.addSeries(h.Im,{color:"#f97316",lineWidth:2,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),y.current=e.addSeries(h.Im,{color:"rgba(250,204,21,.9)",lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,visible:!1}),_.current=(0,h.hR)(t,[]),r.current=e,o.current=t,()=>{for(let e of c.current)t.removePriceLine(e);c.current=[],_.current=null,o.current=null,r.current=null,p.current={ema5:null,ema13:null,ema50:null,ema200:null,ema800:null},b.current=null,f.current=null,x.current=null,y.current=null,e.remove()}},[]),(0,d.useEffect)(()=>{if(!t||!i||!o.current)return;let e=!0,n=null,l=!1,a=async()=>{var n,a,s,d,c;try{let p=await (0,u.Vg)("/api/market/candles?exchangeAccountId=".concat(encodeURIComponent(t),"&symbol=").concat(encodeURIComponent(i),"&timeframe=").concat(encodeURIComponent(B),"&limit=").concat(1e3));if(!e)return;k(null!=(d=p.items)?d:[]);let h=function(e){let t=[];for(let i of e)i.ts&&Number.isFinite(i.ts)&&t.push({time:Math.floor(i.ts/1e3),open:i.open,high:i.high,low:i.low,close:i.close});return t}(p.items);if(null==(n=o.current)||n.setData(h),null==(a=r.current)||a.timeScale().applyOptions({rightOffset:14}),!l&&r.current){let e=Math.min(200,Math.max(1,h.length)),t=h.length-1+14,i=Math.max(0,t-e+1);r.current.timeScale().setVisibleLogicalRange({from:i,to:t}),l=!0}let m=h.length>0&&null!=(c=null==(s=h[h.length-1])?void 0:s.close)?c:null;z(null!=m?m:null),j("ready"),N(h.length>0?"".concat(Math.min(200,h.length)," visible \xb7 ").concat(h.length," loaded"):"No candles available")}catch(t){if(!e)return;j("error"),N(t instanceof u.hD?"".concat(t.message," (HTTP ").concat(t.status,")"):t&&"object"==typeof t&&"message"in t?String(t.message):String(t))}};return j("loading"),N("Loading candles..."),a(),n=setInterval(()=>{a()},15e3),()=>{e=!1,n&&clearInterval(n)}},[t,i,B]),(0,d.useEffect)(()=>{var e;let t=o.current;if(!t)return;for(let e of c.current)t.removePriceLine(e);if(c.current=[],!l)return;let i=[],n=(null==(e=l.suggestedEntry)?void 0:e.type)==="limit"&&"number"==typeof l.suggestedEntry.price?l.suggestedEntry.price:O;"number"==typeof n&&Number.isFinite(n)&&i.push(t.createPriceLine({price:n,color:"#38bdf8",lineWidth:1,lineStyle:h.Sc.Solid,title:"Entry"})),"number"==typeof l.suggestedTakeProfit&&Number.isFinite(l.suggestedTakeProfit)&&i.push(t.createPriceLine({price:l.suggestedTakeProfit,color:"#22c55e",lineWidth:1,lineStyle:h.Sc.Dashed,title:"TP"})),"number"==typeof l.suggestedStopLoss&&Number.isFinite(l.suggestedStopLoss)&&i.push(t.createPriceLine({price:l.suggestedStopLoss,color:"#ef4444",lineWidth:1,lineStyle:h.Sc.Dashed,title:"SL"})),c.current=i},[l,O]),(0,d.useEffect)(()=>{var e,t,i,n,l,a,s,r,d,c,u,h,m,g,_,S,j,w,N,k,O,z,I,M,E,P;if(!o.current)return;let R=C.filter(e=>null!==e.ts&&Number.isFinite(e.ts)).slice().sort((e,t)=>e.ts-t.ts);if(0===R.length){for(let e of["ema5","ema13","ema50","ema200","ema800"])null==(d=p.current[e])||d.setData([]),null==(c=p.current[e])||c.applyOptions({visible:!1});null==(e=b.current)||e.setData([]),null==(t=f.current)||t.setData([]),null==(i=b.current)||i.applyOptions({visible:!1}),null==(n=f.current)||n.applyOptions({visible:!1}),null==(l=x.current)||l.setData([]),null==(a=x.current)||a.applyOptions({visible:!1}),null==(s=y.current)||s.setData([]),null==(r=y.current)||r.applyOptions({visible:!1});return}for(let e of[{key:"ema5",seriesKey:"ema5",period:5},{key:"ema13",seriesKey:"ema13",period:13},{key:"ema50",seriesKey:"ema50",period:50},{key:"ema200",seriesKey:"ema200",period:200},{key:"ema800",seriesKey:"ema800",period:800}]){let t=p.current[e.seriesKey];if(!t)continue;if(!T[e.key]){t.applyOptions({visible:!1}),t.setData([]);continue}let i=v(R,e.period);t.setData(i),t.applyOptions({visible:i.length>0})}let L=v(R,50);if(T.emaCloud50&&L.length>0){let e=R.map(e=>e.close),t=[],i=[];for(let n=0;n<L.length;n+=1){let l=49+n;if(l<99)continue;let a=l-100+1,s=e.slice(a,l+1),r=s.reduce((e,t)=>e+t,0)/s.length,o=0;for(let e of s){let t=e-r;o+=t*t}let d=Math.sqrt(o/s.length)/4,c=L[n].value,u=c+d,p=c-d;t.push({time:L[n].time,value:u}),i.push({time:L[n].time,value:p})}null==(u=b.current)||u.setData(t),null==(h=f.current)||h.setData(i),null==(m=b.current)||m.applyOptions({visible:t.length>0}),null==(g=f.current)||g.applyOptions({visible:i.length>0})}else null==(_=b.current)||_.setData([]),null==(S=f.current)||S.setData([]),null==(j=b.current)||j.applyOptions({visible:!1}),null==(w=f.current)||w.applyOptions({visible:!1});if(T.vwapSession){let e=function(e){let t=[],i=null,n=0,l=0;for(let a of e){let e=new Date(a.ts),s=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0);(null===i||s!==i)&&(i=s,n=0,l=0);let r=Number(a.volume),o=Number.isFinite(r)&&r>0?r:0;n+=(a.high+a.low+a.close)/3*o,(l+=o)<=0||t.push({time:Math.floor(a.ts/1e3),value:n/l})}return t}(R);null==(N=x.current)||N.setData(e),null==(k=x.current)||k.applyOptions({visible:e.length>0})}else null==(O=x.current)||O.setData([]),null==(z=x.current)||z.applyOptions({visible:!1});if(T.dailyOpen){let e=function(e){let t=function(e){if(0===e.length)return null;let t=new Date(e[e.length-1].ts),i=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0),n=e.find(e=>{let t=new Date(e.ts);return Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0)===i});return n?n.open:null}(e);if(null===t||!Number.isFinite(t)||0===e.length)return[];let i=new Date(e[e.length-1].ts),n=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),0,0,0,0),l=[];for(let i of e){let e=new Date(i.ts);Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)===n&&l.push({time:Math.floor(i.ts/1e3),value:t})}return l}(R);null==(I=y.current)||I.setData(e),null==(M=y.current)||M.applyOptions({visible:e.length>0})}else null==(E=y.current)||E.setData([]),null==(P=y.current)||P.applyOptions({visible:!1})},[C,T]),(0,d.useEffect)(()=>{if(!t||!i||!_.current)return;let e=!0,n=null,l=async()=>{try{var n;let l=await (0,u.Vg)("/api/predictions?limit=200&mode=history");if(!e||!_.current)return;let a=(null!=(n=l.items)?n:[]).filter(e=>{var n;return(null==(n=e.symbol)?void 0:n.toUpperCase())===i.toUpperCase()&&e.timeframe===B&&"neutral"!==e.signal&&("up"===e.signal&&I||"down"===e.signal&&E)&&(!e.accountId||e.accountId===t)}),s=[];for(let e of a){let t=new Date(e.tsCreated).getTime();if(!Number.isFinite(t))continue;let i=Math.floor(t/1e3);if("up"===e.signal){s.push({time:i,position:"belowBar",shape:"arrowUp",color:"#22c55e",text:"UP ".concat(Number.isFinite(e.confidence)?"".concat(e.confidence.toFixed(0),"%"):"")});continue}if("down"===e.signal){s.push({time:i,position:"aboveBar",shape:"arrowDown",color:"#ef4444",text:"DOWN ".concat(Number.isFinite(e.confidence)?"".concat(e.confidence.toFixed(0),"%"):"")});continue}s.push({time:i,position:"inBar",shape:"circle",color:"#94a3b8",text:"NEUTRAL"})}_.current.setMarkers(s)}catch(t){if(!e||!_.current)return;_.current.setMarkers([])}};return l(),n=setInterval(()=>{l()},3e4),()=>{var t;e=!1,n&&clearInterval(n),null==(t=_.current)||t.setMarkers([])}},[t,i,B,I,E]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{ref:a,style:{width:"100%",height:520}}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:12,color:"var(--muted)",display:"flex",justifyContent:"space-between",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("span",{children:"Chart engine: lightweight-charts"}),(0,s.jsx)("span",{children:"error"===S?"Chart error: ".concat(w):w})]}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",gap:14,flexWrap:"wrap",fontSize:12},children:[(0,s.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(0,s.jsx)("input",{type:"checkbox",checked:I,onChange:e=>M(e.target.checked)}),"Show Up Signals"]}),(0,s.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(0,s.jsx)("input",{type:"checkbox",checked:E,onChange:e=>P(e.target.checked)}),"Show Down Signals"]})]}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:10,fontSize:12},children:[(0,s.jsx)("span",{style:{opacity:.8},children:"Indicators:"}),[{key:"ema5",label:"EMA 5"},{key:"ema13",label:"EMA 13"},{key:"ema50",label:"EMA 50"},{key:"ema200",label:"EMA 200"},{key:"ema800",label:"EMA 800"},{key:"emaCloud50",label:"EMA 50 Cloud"},{key:"vwapSession",label:"Session VWAP"},{key:"dailyOpen",label:"Daily Open"}].map(e=>(0,s.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(0,s.jsx)("input",{type:"checkbox",checked:T[e.key],onChange:t=>R(i=>({...i,[e.key]:t.target.checked}))}),e.label]},e.key))]}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[(0,s.jsx)("span",{style:{fontSize:12,opacity:.8},children:"Presets:"}),Object.keys(g).map(e=>{let t=g[e],i=L===e;return(0,s.jsx)("button",{type:"button",className:"btn",onClick:()=>R(t.toggles),style:{padding:"4px 10px",fontSize:12,minHeight:0,borderColor:i?"rgba(56,189,248,.95)":void 0,color:i?"#38bdf8":void 0},children:t.label},e)})]})]})}var f=i(7011);let x=null!=(a=null!=(l=null!=(n=f.env.NEXT_PUBLIC_API_URL)?n:f.env.API_URL)?l:f.env.API_BASE_URL)?a:"http://localhost:4000",y=["1m","5m","15m","1h","4h","1d"],_=[{value:"quantity",title:"Quantity",description:"Quantity of the futures position, measured in base asset.",unit:"BASE"},{value:"cost",title:"Cost",description:"Margin amount used for the trade.",unit:"USDT"},{value:"value",title:"Value",description:"Notional value of the position.",unit:"USDT"}];function S(e){if(e instanceof TypeError){var t;let i=String(null!=(t=e.message)?t:"");if(i.includes("NetworkError")||i.includes("Failed to fetch"))return"API connection failed (".concat(x,"). Check if apps/api is running on port 4000.")}return e instanceof u.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||Number.isNaN(e)?"-":Number(e).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}function w(e,t){return null!=e&&Number.isFinite(e)?Number(e).toFixed(t):"n/a"}function N(){var e,t,i,n,l,a,r,h,m,g,v,f,N,C,k,O,z,I,M,E,P,T,R,L,B,U,A,D,F,V,W,H,q,Y,Q,G,$,K,X,J,Z,ee,et,ei,en,el,ea,es,er,eo,ed;let ec=(0,c.useRouter)(),eu=(0,c.useSearchParams)(),ep=(0,d.useMemo)(()=>x.startsWith("https://")?"wss://".concat(x.slice(8)):x.startsWith("http://")?"ws://".concat(x.slice(7)):x,[]),[eh,em]=(0,d.useState)([]),[eg,ev]=(0,d.useState)([]),[eb,ef]=(0,d.useState)(""),[ex,ey]=(0,d.useState)("BTCUSDT"),[e_,eS]=(0,d.useState)("15m"),[ej,ew]=(0,d.useState)(null),[eN,eC]=(0,d.useState)([]),[ek,eO]=(0,d.useState)([]),[ez,eI]=(0,d.useState)(null),[eM,eE]=(0,d.useState)("limit"),[eP,eT]=(0,d.useState)("isolated"),[eR,eL]=(0,d.useState)("open"),[eB,eU]=(0,d.useState)("10"),[eA,eD]=(0,d.useState)("0.001"),[eF,eV]=(0,d.useState)(0),[eW,eH]=(0,d.useState)("quantity"),[eq,eY]=(0,d.useState)("quantity"),[eQ,eG]=(0,d.useState)(!1),[e$,eK]=(0,d.useState)(""),[eX,eJ]=(0,d.useState)(!1),[eZ,e0]=(0,d.useState)(""),[e1,e2]=(0,d.useState)(""),[e4,e5]=(0,d.useState)(!0),[e8,e3]=(0,d.useState)(null),[e6,e7]=(0,d.useState)(null),[e9,te]=(0,d.useState)(null),[tt,ti]=(0,d.useState)(!1),[tn,tl]=(0,d.useState)(!1),[ta,ts]=(0,d.useState)(null),[tr,to]=(0,d.useState)(null),[td,tc]=(0,d.useState)(!0),tu=(0,d.useRef)(null),tp=(0,d.useRef)(null),th=(0,d.useRef)(null),tm=(0,d.useMemo)(()=>{var e;return null!=(e=eh.find(e=>e.id===eb))?e:null},[eh,eb]),tg=(0,d.useMemo)(()=>{var e;return null!=(e=eg.find(e=>e.symbol===ex))?e:null},[eg,ex]),tv=(null==ta?void 0:ta.marketType)==="spot"&&"down"===ta.signal,tb=(0,d.useMemo)(()=>{let e=Number(eB);return Number.isFinite(e)&&e>0?e:null},[eB]),tf=(0,d.useMemo)(()=>{var e,t;let i=null!=(t=null!=(e=null==ez?void 0:ez.mark)?e:null==ez?void 0:ez.last)?t:null;return null!==i&&Number.isFinite(i)&&i>0?i:null},[ez]),tx=(0,d.useMemo)(()=>{var e,t;let i=null!=(e=null==ej?void 0:ej.availableMargin)?e:null;if(null===i||!Number.isFinite(i)||i<=0||!tb||!tf)return null;let n=i*tb/tf;if(!Number.isFinite(n)||n<=0)return null;let l=null!=(t=null==tg?void 0:tg.stepSize)?t:null;return null!==l&&Number.isFinite(l)&&l>0?Math.floor(n/l)*l:n},[ej,tb,tf,tg]),ty=(0,d.useMemo)(()=>ex.endsWith("USDT")&&ex.slice(0,-4)||ex,[ex]),t_=(0,d.useMemo)(()=>{var e;return null!=(e=_.find(e=>e.value===eW))?e:_[0]},[eW]),tS="quantity"===eW?ty:"USDT",tj=(0,d.useMemo)(()=>{let e=Number(eA);return Number.isFinite(e)&&e>0?e:null},[eA]),tw=(0,d.useMemo)(()=>{if("limit"===eM){let e=Number(e$);return Number.isFinite(e)&&e>0?e:null}return tf},[eM,e$,tf]),tN=(0,d.useMemo)(()=>null===tj?null:"quantity"===eW?tj:tw&&Number.isFinite(tw)&&!(tw<=0)?"cost"===eW?tb&&Number.isFinite(tb)&&!(tb<=0)?tj*tb/tw:null:tj/tw:null,[tb,tw,eW,tj]),tC=(0,d.useMemo)(()=>{if(null===tj)return null;if("cost"===eW)return tj;if("value"===eW)return tb&&Number.isFinite(tb)&&!(tb<=0)?tj/tb:null;if(!tN||!tw)return null;let e=tN*tw;return!Number.isFinite(e)||e<=0?null:tb&&Number.isFinite(tb)&&!(tb<=0)?e/tb:e},[tb,tN,tw,eW,tj]),tk=(0,d.useMemo)(()=>{var e;let t=null!=(e=null==ej?void 0:ej.availableMargin)?e:null;return null===t||!Number.isFinite(t)||t<=0?null:"quantity"===eW?tx:"cost"===eW?t:tb&&Number.isFinite(tb)&&!(tb<=0)?t*tb:null},[tx,tb,eW,ej]),tO=(0,d.useMemo)(()=>{if(!tw||!tb)return{long:null,short:null};let e="isolated"===eP?.004:.005,t=tw*(1-1/tb+e),i=tw*(1+1/tb-e);return{long:Number.isFinite(t)&&t>0?t:null,short:Number.isFinite(i)&&i>0?i:null}},[eP,tb,tw]);function tz(e){var t,i,n,l;let a=Math.max(0,Math.min(100,e));if(eV(a),!tk||tk<=0)return;let s=tk*a/100;if("quantity"!==eW)return!Number.isFinite(s)||s<=0?void eD(""):void eD(s.toFixed(4).replace(/\.?0+$/,""));let r=null!=(t=null==tg?void 0:tg.stepSize)?t:null,o=null!=(i=null==tg?void 0:tg.minQty)?i:null,d=s;if(null!==r&&Number.isFinite(r)&&r>0&&(d=Math.floor(s/r)*r),a>0&&null!==o&&Number.isFinite(o)&&o>0&&(d=Math.max(d,o)),d>0&&Number.isFinite(d)){let e=null!==r&&r>0&&Number.isFinite(r)?Math.min(8,null!=(l=null==(n=String(r).split(".")[1])?void 0:n.length)?l:0):6;eD(d.toFixed(e).replace(/\.?0+$/,""))}}async function tI(e){try{await (0,u.$P)("/api/trading/settings",e)}catch(e){}}async function tM(e,t){e5(!0),e3(null);try{var i,n,l,a,s,r;let[o,d]=await Promise.all([(0,u.Vg)("/exchange-accounts"),(0,u.Vg)("/api/trading/settings")]),c=null!=(n=o.items)?n:[];em(c);let p=eu.get("exchangeAccountId"),h=null!=(r=null!=(s=null!=(a=null!=(l=null!=e?e:null==t?void 0:t.accountId)?l:p)?a:d.exchangeAccountId)?s:null==(i=c[0])?void 0:i.id)?r:"";ef(h),(null==t?void 0:t.timeframe)&&y.includes(t.timeframe)?eS(t.timeframe):d.timeframe&&y.includes(d.timeframe)&&eS(d.timeframe),"isolated"===d.marginMode||"cross"===d.marginMode?eT(d.marginMode):eT("isolated"),(null==t?void 0:t.symbol)?ey(t.symbol.trim().toUpperCase()):d.symbol&&ey(d.symbol)}catch(e){e3(S(e))}finally{e5(!1)}}async function tE(e,t){if(e){e3(null),e7(null);try{var i,n,l,a,s,r;let o=await (0,u.Vg)("/api/symbols?exchangeAccountId=".concat(encodeURIComponent(e))),d=null!=(n=o.items)?n:[];ev(d);let c=(null!=t?t:ex).trim().toUpperCase(),p=null!=(a=null!=(l=o.defaultSymbol)?l:null==(i=d[0])?void 0:i.symbol)?a:"BTCUSDT",h=d.some(e=>e.symbol===c)?c:p;ey(h);let[m,g,v]=await Promise.allSettled([(0,u.Vg)("/api/account/summary?exchangeAccountId=".concat(encodeURIComponent(e))),(0,u.Vg)("/api/positions?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(h))),(0,u.Vg)("/api/orders/open?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(h)))]),b=[];"fulfilled"===m.status?ew(m.value):b.push("account summary (".concat(S(m.reason),")")),"fulfilled"===g.status?eC(null!=(s=g.value.items)?s:[]):(eC([]),b.push("positions (".concat(S(g.reason),")"))),"fulfilled"===v.status?eO(null!=(r=v.value.items)?r:[]):(eO([]),b.push("open orders (".concat(S(v.reason),")"))),b.length>0?e7("Partial data unavailable: ".concat(b.join(", "))):e7(null),await tI({exchangeAccountId:e,symbol:h,timeframe:e_}),e3(null)}catch(e){e3(S(e))}}}async function tP(e,t){var i,n;let[l,a,s]=await Promise.allSettled([(0,u.Vg)("/api/positions?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(t))),(0,u.Vg)("/api/orders/open?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(t))),(0,u.Vg)("/api/account/summary?exchangeAccountId=".concat(encodeURIComponent(e)))]);"fulfilled"===l.status&&eC(null!=(i=l.value.items)?i:[]),"fulfilled"===a.status&&eO(null!=(n=a.value.items)?n:[]),"fulfilled"===s.status&&ew(s.value)}async function tT(){if(!eb)return;let e=Number(eB);if(!Number.isFinite(e)||e<1||e>125)return void te("Leverage must be between 1 and 125.");te(null),tl(!0);try{await (0,u.$P)("/api/account/leverage",{exchangeAccountId:eb,symbol:ex,leverage:Math.trunc(e),marginMode:eP})}catch(e){te(S(e))}finally{tl(!1)}}async function tR(e){var t,i,n;if(!eb)return;let l=Number(eA),a=Number(e$),s=Number(eB),r=Number(eZ),o=Number(e1);if(!Number.isFinite(l)||l<=0)return void te("Quantity must be greater than 0.");if(!tN||!Number.isFinite(tN)||tN<=0)return void te("Unable to derive order quantity for selected unit.");let d=null!=(t=null==tg?void 0:tg.stepSize)?t:null,c=null!=(i=null==tg?void 0:tg.minQty)?i:null,p=null!=(n=null==tg?void 0:tg.maxQty)?n:null,h=tN;if(null!==d&&Number.isFinite(d)&&d>0&&(h=Math.floor(h/d)*d),null!==c&&Number.isFinite(c)&&c>0&&h<c)return void te("Quantity is below minimum (".concat(c,")."));if(null!==p&&Number.isFinite(p)&&p>0&&h>p&&(h=p),"limit"===eM&&(!Number.isFinite(a)||a<=0))return void te("Limit orders require a valid price.");if(!Number.isFinite(s)||s<1||s>125)return void te("Leverage must be between 1 and 125.");if(eX&&eZ.trim().length>0&&(!Number.isFinite(r)||r<=0))return void te("Take profit must be greater than 0.");if(eX&&e1.trim().length>0&&(!Number.isFinite(o)||o<=0))return void te("Stop loss must be greater than 0.");te(null),ti(!0);try{await (0,u.$P)("/api/orders",{exchangeAccountId:eb,symbol:ex,type:eM,side:e,qty:h,price:"limit"===eM?a:void 0,takeProfitPrice:eX&&eZ.trim().length>0?r:void 0,stopLossPrice:eX&&e1.trim().length>0?o:void 0,leverage:Math.trunc(s),marginMode:eP,reduceOnly:"close"===eR}),await tP(eb,ex),"limit"===eM&&eK("")}catch(e){te(S(e))}finally{ti(!1)}}async function tL(e){if(eb){te(null);try{await (0,u.$P)("/api/positions/close",{exchangeAccountId:eb,symbol:ex,side:e}),await tP(eb,ex)}catch(e){te(S(e))}}}async function tB(e){if(eb){te(null);try{await (0,u.$P)("/api/orders/cancel",{exchangeAccountId:eb,orderId:e,symbol:ex}),await tP(eb,ex)}catch(e){te(S(e))}}}async function tU(){if(eb){te(null);try{await (0,u.$P)("/api/orders/cancel-all?exchangeAccountId=".concat(encodeURIComponent(eb),"&symbol=").concat(encodeURIComponent(ex)),{}),await tP(eb,ex)}catch(e){te(S(e))}}}return(0,d.useEffect)(()=>{let e=!1;return async function(){var t;let i=null,n=eu.get("prefill"),l=eu.get("predictionId");if(n){if("1"===n){let e=sessionStorage.getItem(p.xf);if(sessionStorage.removeItem(p.xf),e)try{i=(0,p.jH)(JSON.parse(e))}catch(e){i=null}}else i=(0,p.jH)(function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/"),i=t.padEnd(4*Math.ceil(t.length/4),"="),n=atob(i);return JSON.parse(n)}catch(e){return null}}(n));i||e7("Invalid prefill payload.")}else if(l)try{let e=await (0,u.Vg)("/api/predictions/".concat(encodeURIComponent(l)));if(e.accountId){let t=(0,p.i4)(e);i=t.payload,t.info&&to(t.info)}else e7("Prediction has no exchange account mapping for prefill.")}catch(e){e7("Unable to load prediction prefill (".concat(S(e),")."))}e||(i&&function(e){var t,i,n;if(ts(e),eL("open"),tc(!window.matchMedia("(max-width: 700px)").matches),e.timeframe&&y.includes(e.timeframe)&&eS(e.timeframe),e.symbol&&ey(e.symbol.trim().toUpperCase()),((null==(t=e.suggestedEntry)?void 0:t.type)==="market"||(null==(i=e.suggestedEntry)?void 0:i.type)==="limit")&&eE(e.suggestedEntry.type),(null==(n=e.suggestedEntry)?void 0:n.type)==="limit"&&e.suggestedEntry.price&&eK(String(e.suggestedEntry.price)),e.leverage&&Number.isFinite(e.leverage)&&e.leverage>=1&&e.leverage<=125&&eU(String(e.leverage)),(e.suggestedTakeProfit||e.suggestedStopLoss)&&(eJ(!0),e0(e.suggestedTakeProfit?String(e.suggestedTakeProfit):""),e2(e.suggestedStopLoss?String(e.suggestedStopLoss):"")),e.positionSizeHint&&("percent_balance"===e.positionSizeHint.mode?(eH("cost"),eY("cost"),tz(e.positionSizeHint.value)):(eH("cost"),eY("cost"),eD(String(e.positionSizeHint.value)),eV(0))),"spot"===e.marketType&&"down"===e.signal)return to("Spot short is not supported. Side prefill was skipped.");to(null)}(i),await tM(null!=(t=null==i?void 0:i.accountId)?t:null,i))}(),()=>{e=!0,tu.current&&tu.current.close(),tp.current&&tp.current.close(),th.current&&window.clearInterval(th.current)}},[]),(0,d.useEffect)(()=>{var e;eb&&tE(eb,null!=(e=null==ta?void 0:ta.symbol)?e:void 0)},[eb,null==ta?void 0:ta.symbol]),(0,d.useEffect)(()=>{(null==ta?void 0:ta.positionSizeHint)&&"percent_balance"===ta.positionSizeHint.mode&&tk&&!(tk<=0)&&tz(ta.positionSizeHint.value)},[null==ta?void 0:ta.predictionId,tk]),(0,d.useEffect)(()=>{if(!eb||!ex)return;tu.current&&(tu.current.close(),tu.current=null);let e=new WebSocket("".concat(ep,"/ws/market?exchangeAccountId=").concat(encodeURIComponent(eb),"&symbol=").concat(encodeURIComponent(ex)));return tu.current=e,e.onmessage=e=>{let t=null;try{t=JSON.parse(e.data)}catch(e){return}if(t&&(t.type.includes("ticker")&&t.data&&eI(t.data),"error"===t.type)){var i;e3(null!=(i=t.message)?i:"Market websocket error")}},e.onerror=()=>{e3("Market stream disconnected.")},()=>{e.close(),tu.current===e&&(tu.current=null)}},[eb,ex,ep]),(0,d.useEffect)(()=>{if(!eb)return;tp.current&&(tp.current.close(),tp.current=null);let e=new WebSocket("".concat(ep,"/ws/user?exchangeAccountId=").concat(encodeURIComponent(eb)));return tp.current=e,e.onmessage=e=>{let t=null;try{t=JSON.parse(e.data)}catch(e){return}if(t){if("account"===t.type&&t.data){let e=t.data;ew(t=>t?{...t,equity:e.equity,availableMargin:e.availableMargin,updatedAt:new Date().toISOString()}:t),Array.isArray(e.positions)&&eC(e.positions),Array.isArray(e.openOrders)&&eO(e.openOrders)}("order"===t.type||"position"===t.type||"fill"===t.type)&&tP(eb,ex).catch(()=>{})}},e.onerror=()=>{e3("User stream disconnected.")},()=>{e.close(),tp.current===e&&(tp.current=null)}},[eb,ex,ep]),(0,d.useEffect)(()=>{if(eb&&ex)return th.current&&(window.clearInterval(th.current),th.current=null),th.current=window.setInterval(()=>{tP(eb,ex).catch(()=>{})},8e3),()=>{th.current&&(window.clearInterval(th.current),th.current=null)}},[eb,ex]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"dashboardHeader",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{margin:0},children:"Manual Trading Desk"}),(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)"},children:"TradingView + futures order controls."})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)(o(),{href:"/dashboard",className:"btn",children:"Dashboard"}),(0,s.jsx)(o(),{href:eb?"/bots?exchangeAccountId=".concat(encodeURIComponent(eb)):"/bots",className:"btn",children:"Bots"})]})]}),e8?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#ef4444",marginBottom:12},children:[(0,s.jsx)("strong",{children:"Error:"})," ",e8,(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)("button",{className:"btn",onClick:()=>{eb&&tE(eb,ex)},children:"Retry"})})]}):null,e9?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#ef4444",marginBottom:12},children:[(0,s.jsx)("strong",{children:"Action failed:"})," ",e9]}):null,e6?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#f59e0b",marginBottom:12},children:[(0,s.jsx)("strong",{children:"Warning:"})," ",e6]}):null,ta?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#3b82f6",marginBottom:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:8,flexWrap:"wrap",alignItems:"center"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Prediction Context"}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:4},children:[ta.symbol," \xb7 ",ta.marketType," \xb7 ",ta.timeframe," \xb7 ",function(e){if(!Number.isFinite(e))return"-";let t=Math.max(0,Math.min(100,e<=1?100*e:e));return"".concat(t.toFixed(1),"%")}(ta.confidence)," \xb7"," ",new Date(ta.tsCreated).toLocaleString()]}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:2},children:["Signal: ",ta.signal," \xb7 Side: ",null!=(eo=ta.side)?eo:"manual","number"==typeof ta.expectedMovePct?" \xb7 Move: ".concat(ta.expectedMovePct.toFixed(2),"%"):""]}),ta.leverage?(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:2},children:["Prefill leverage: ",ta.leverage,"x"]}):null]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("button",{className:"btn",type:"button",onClick:()=>tc(e=>!e),children:td?"Hide context":"Show context"}),(0,s.jsx)(o(),{href:"/predictions",className:"btn",children:"Back to Prediction"}),(0,s.jsx)("button",{className:"btn",onClick:function(){ts(null),eE("limit"),eT("isolated"),eL("open"),eU("10"),eH("quantity"),eY("quantity"),eD("0.001"),eV(0),eK(""),eJ(!1),e0(""),e2(""),to(null);let e=new URLSearchParams(eu.toString());e.delete("prefill"),e.delete("predictionId"),!e.get("exchangeAccountId")&&eb&&e.set("exchangeAccountId",eb);let t=e.toString()?"/trade?".concat(e.toString()):"/trade";ec.replace(t)},type:"button",children:"Clear Prefill"})]})]}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:12,color:"var(--muted)"},children:["Prediction ID: ",ta.predictionId]}),tr?(0,s.jsx)("div",{style:{marginTop:8,fontSize:12,color:"#f59e0b"},children:tr}):null,td?(0,s.jsxs)("div",{style:{marginTop:10,display:"grid",gap:10},children:[(null==(e=ta.tags)?void 0:e.length)?(0,s.jsx)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:ta.tags.map(e=>(0,s.jsx)("span",{className:"badge",children:e},e))}):null,ta.explanation?(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{style:{cursor:"pointer",fontSize:12},children:"AI explanation"}),(0,s.jsx)("div",{style:{marginTop:6,fontSize:12},children:ta.explanation})]}):null,(0,s.jsxs)("div",{style:{display:"grid",gap:8,gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))"},children:[(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"RSI (14)"}),(0,s.jsx)("div",{style:{fontWeight:700},children:w(null==(t=ta.indicators)?void 0:t.rsi_14,1)})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"MACD hist"}),(0,s.jsx)("div",{style:{fontWeight:700},children:w(null==(n=ta.indicators)||null==(i=n.macd)?void 0:i.hist,4)}),(0,s.jsxs)("div",{style:{fontSize:11,color:"var(--muted)",marginTop:2},children:["line ",w(null==(a=ta.indicators)||null==(l=a.macd)?void 0:l.line,4)," / signal ",w(null==(h=ta.indicators)||null==(r=h.macd)?void 0:r.signal,4)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"BB width% / pos"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[w(null==(g=ta.indicators)||null==(m=g.bb)?void 0:m.width_pct,2)," / ",w(null==(f=ta.indicators)||null==(v=f.bb)?void 0:v.pos,3)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"VWAP dist%"}),(0,s.jsx)("div",{style:{fontWeight:700},children:w(null==(C=ta.indicators)||null==(N=C.vwap)?void 0:N.dist_pct,2)}),(0,s.jsxs)("div",{style:{fontSize:11,color:"var(--muted)",marginTop:2},children:["mode ",null!=(ed=null==(O=ta.indicators)||null==(k=O.vwap)?void 0:k.mode)?ed:"n/a"]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"ADX / +DI / -DI"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[w(null==(I=ta.indicators)||null==(z=I.adx)?void 0:z.adx_14,1)," / ",w(null==(E=ta.indicators)||null==(M=E.adx)?void 0:M.plus_di_14,1)," / ",w(null==(T=ta.indicators)||null==(P=T.adx)?void 0:P.minus_di_14,1)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"StochRSI %K / %D / value"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[w(null==(L=ta.indicators)||null==(R=L.stochrsi)?void 0:R.k,1)," / ",w(null==(U=ta.indicators)||null==(B=U.stochrsi)?void 0:B.d,1)," / ",w(null==(D=ta.indicators)||null==(A=D.stochrsi)?void 0:A.value,1)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"Volume z / rel / trend%"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[w(null==(V=ta.indicators)||null==(F=V.volume)?void 0:F.vol_z,3)," / ",w(null==(H=ta.indicators)||null==(W=H.volume)?void 0:W.rel_vol,3)," / ",w(null==(Y=ta.indicators)||null==(q=Y.volume)?void 0:q.vol_trend,2)]}),(0,s.jsxs)("div",{style:{fontSize:11,color:"var(--muted)",marginTop:2},children:["EMA ",w(null==(G=ta.indicators)||null==(Q=G.volume)?void 0:Q.vol_ema_fast,2)," / ",w(null==(K=ta.indicators)||null==($=K.volume)?void 0:$.vol_ema_slow,2)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"FVG open bull / bear"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[w(null==(J=ta.indicators)||null==(X=J.fvg)?void 0:X.open_bullish_count,0)," / ",w(null==(ee=ta.indicators)||null==(Z=ee.fvg)?void 0:Z.open_bearish_count,0)]}),(0,s.jsxs)("div",{style:{fontSize:11,color:"var(--muted)",marginTop:2},children:["bull ",w(null==(en=ta.indicators)||null==(ei=en.fvg)||null==(et=ei.nearest_bullish_gap)?void 0:et.dist_pct,2),"% \xb7 bear ",w(null==(es=ta.indicators)||null==(ea=es.fvg)||null==(el=ea.nearest_bearish_gap)?void 0:el.dist_pct,2),"%"]})]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:4},children:"Key drivers"}),(null==(er=ta.keyDrivers)?void 0:er.length)?(0,s.jsx)("ul",{style:{margin:0,paddingLeft:18,fontSize:12},children:ta.keyDrivers.slice(0,5).map(e=>(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:e.name}),": ",String(e.value)]},e.name))}):(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"n/a"})]})]}):null]}):null,e4?(0,s.jsx)("div",{className:"card",style:{padding:16},children:"Loading trading deskâ€¦"}):0===eh.length?(0,s.jsxs)("div",{className:"card",style:{padding:16},children:[(0,s.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"No exchange accounts available"}),(0,s.jsx)("div",{style:{color:"var(--muted)",marginBottom:12},children:"Add a Bitget account first to use manual trading."}),(0,s.jsx)(o(),{href:"/settings",className:"btn btnPrimary",children:"Add Exchange Account"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("section",{className:"card",style:{padding:12,marginBottom:12},children:(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:10},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Exchange account"}),(0,s.jsx)("select",{className:"input",value:eb,onChange:e=>{let t=e.target.value;ef(t),tI({exchangeAccountId:t})},children:eh.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.exchange.toUpperCase()," - ",e.label]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Symbol"}),(0,s.jsx)("select",{className:"input",value:ex,onChange:e=>{let t=e.target.value;ey(t),tP(eb,t),tI({symbol:t})},children:eg.map(e=>(0,s.jsxs)("option",{value:e.symbol,children:[e.symbol," ",e.tradable?"":"(restricted)"]},e.symbol))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Timeframe"}),(0,s.jsx)("select",{className:"input",value:e_,onChange:e=>{let t=e.target.value;eS(t),tI({timeframe:t})},children:y.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Account"}),(0,s.jsxs)("div",{className:"card",style:{padding:10,minHeight:44},children:["Eq: ",j(null==ej?void 0:ej.equity)," | Avail: ",j(null==ej?void 0:ej.availableMargin)]})]})]})}),(0,s.jsxs)("section",{className:"tradeDeskGrid",children:[(0,s.jsxs)("article",{className:"card",style:{padding:10,minHeight:620},children:[(0,s.jsxs)("div",{style:{marginBottom:8,fontWeight:700},children:[ex," ",(null==tg?void 0:tg.status)?"- ".concat(tg.status):""]}),(0,s.jsx)(b,{exchangeAccountId:eb,symbol:ex,timeframe:e_,prefill:ta})]}),(0,s.jsxs)("article",{className:"card",style:{padding:10,minHeight:620},children:[(0,s.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Order Entry"}),(0,s.jsxs)("div",{className:"tradeOrderPanel",children:[(0,s.jsxs)("div",{className:"tradeOrderTopRow",children:[(0,s.jsxs)("div",{className:"tradeOrderModeSwitch",children:[(0,s.jsx)("button",{className:"tradeOrderModeBtn ".concat("isolated"===eP?"tradeOrderModeBtnActive":""),onClick:()=>{eT("isolated"),tI({marginMode:"isolated"})},type:"button",children:"Isolated"}),(0,s.jsx)("button",{className:"tradeOrderModeBtn ".concat("cross"===eP?"tradeOrderModeBtnActive":""),onClick:()=>{eT("cross"),tI({marginMode:"cross"})},type:"button",children:"Cross"})]}),(0,s.jsxs)("div",{className:"tradeOrderLeverageGroup",children:[(0,s.jsx)("input",{className:"tradeOrderLeverageInput",type:"number",min:1,max:125,step:1,value:eB,onChange:e=>eU(e.target.value)}),(0,s.jsx)("button",{className:"tradeOrderApplyBtn",disabled:tn,onClick:()=>void tT(),type:"button",children:tn?"...":"Apply"})]})]}),(0,s.jsxs)("div",{className:"tradeOrderEntryMode",children:[(0,s.jsx)("button",{className:"tradeOrderEntryModeBtn ".concat("open"===eR?"tradeOrderEntryModeBtnActive":""),onClick:()=>eL("open"),type:"button",children:"Open"}),(0,s.jsx)("button",{className:"tradeOrderEntryModeBtn ".concat("close"===eR?"tradeOrderEntryModeBtnActive":""),onClick:()=>eL("close"),type:"button",children:"Close"})]}),(0,s.jsxs)("div",{className:"tradeOrderTypeTabs",children:[(0,s.jsx)("button",{className:"tradeOrderTypeTab ".concat("limit"===eM?"tradeOrderTypeTabActive":""),onClick:()=>eE("limit"),type:"button",children:"Limit"}),(0,s.jsx)("button",{className:"tradeOrderTypeTab ".concat("market"===eM?"tradeOrderTypeTabActive":""),onClick:()=>eE("market"),type:"button",children:"Market"}),(0,s.jsx)("button",{className:"tradeOrderTypeTab tradeOrderTypeTabMuted",type:"button",disabled:!0,children:"Post only"})]}),(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Available"}),(0,s.jsxs)("strong",{children:[j(null==ej?void 0:ej.availableMargin,3)," USDT"]})]}),"limit"===eM?(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:"Price"}),(0,s.jsxs)("div",{className:"tradeOrderInputRow",children:[(0,s.jsx)("input",{className:"tradeOrderInput",value:e$,onChange:e=>eK(e.target.value),placeholder:(null==ez?void 0:ez.last)?String(ez.last):"0.0"}),(0,s.jsx)("button",{className:"tradeOrderMiniBtn",type:"button",onClick:()=>{var e;let t=null!=(e=null==ez?void 0:ez.last)?e:null==ez?void 0:ez.mark;t&&Number.isFinite(t)&&eK(String(t))},children:"BBO"})]})]}):null,(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:t_.title}),(0,s.jsxs)("div",{className:"tradeOrderInputRow",children:[(0,s.jsx)("input",{className:"tradeOrderInput",value:eA,onChange:e=>eD(e.target.value),placeholder:"quantity"===eW?"0.001":"10"}),(0,s.jsx)("button",{type:"button",className:"tradeOrderUnitBadge",onClick:()=>{eY(eW),eG(!0)},children:tS})]})]}),(0,s.jsx)("input",{className:"tradeOrderSlider",type:"range",min:0,max:100,step:25,value:eF,onChange:e=>tz(Number(e.target.value))}),(0,s.jsxs)("div",{className:"tradeOrderDualStats",children:[(0,s.jsxs)("div",{className:"tradeOrderDualRow",children:[(0,s.jsx)("span",{children:"Position size"}),(0,s.jsxs)("strong",{children:[(0,s.jsx)("span",{className:"tradeOrderValueLong",children:j(tN,4)}),(0,s.jsx)("span",{className:"tradeOrderValueSlash",children:" / "}),(0,s.jsx)("span",{className:"tradeOrderValueShort",children:j(tN,4)}),(0,s.jsxs)("span",{className:"tradeOrderValueUnit",children:[" ",ty]})]})]}),(0,s.jsxs)("div",{className:"tradeOrderDualRow",children:[(0,s.jsx)("span",{children:"Cost"}),(0,s.jsxs)("strong",{children:[(0,s.jsx)("span",{className:"tradeOrderValueLong",children:j(tC,4)}),(0,s.jsx)("span",{className:"tradeOrderValueSlash",children:" / "}),(0,s.jsx)("span",{className:"tradeOrderValueShort",children:j(tC,4)}),(0,s.jsx)("span",{className:"tradeOrderValueUnit",children:" USDT"})]})]}),(0,s.jsxs)("div",{className:"tradeOrderDualRow",children:[(0,s.jsx)("span",{children:"Est. liq. price"}),(0,s.jsxs)("strong",{children:[(0,s.jsx)("span",{className:"tradeOrderValueLong",children:j(tO.long,1)}),(0,s.jsx)("span",{className:"tradeOrderValueSlash",children:" / "}),(0,s.jsx)("span",{className:"tradeOrderValueShort",children:j(tO.short,1)})]})]})]}),(0,s.jsxs)("label",{className:"tradeOrderCheckRow",children:[(0,s.jsx)("input",{type:"checkbox",checked:eX,onChange:e=>eJ(e.target.checked)}),(0,s.jsx)("span",{children:"TP/SL"})]}),eX?(0,s.jsxs)("div",{className:"tradeOrderTpSlGrid",children:[(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:"Take Profit"}),(0,s.jsx)("input",{className:"tradeOrderInput",value:eZ,onChange:e=>e0(e.target.value),placeholder:"optional"})]}),(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:"Stop Loss"}),(0,s.jsx)("input",{className:"tradeOrderInput",value:e1,onChange:e=>e2(e.target.value),placeholder:"optional"})]})]}):null,(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Time in force"}),(0,s.jsx)("strong",{children:"limit"===eM?"GTC":"IOC"})]}),ta?(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Prefilled side"}),(0,s.jsx)("strong",{children:ta.side?ta.side.toUpperCase():"Manual selection required"})]}):null,(0,s.jsxs)("div",{className:"tradeOrderActionGrid",children:[(0,s.jsxs)("button",{className:"btn btnStart",style:(null==ta?void 0:ta.side)==="long"?{boxShadow:"0 0 0 2px rgba(16,185,129,.45) inset"}:void 0,disabled:tt,onClick:()=>void tR("long"),type:"button",children:["open"===eR?"Open Long":"Close Short",(null==ta?void 0:ta.side)==="long"?" (Suggested)":""]}),(0,s.jsxs)("button",{className:"btn btnStop",style:(null==ta?void 0:ta.side)==="short"?{boxShadow:"0 0 0 2px rgba(239,68,68,.45) inset"}:void 0,disabled:tt||tv,onClick:()=>void tR("short"),type:"button",children:["open"===eR?"Open Short":"Close Long",(null==ta?void 0:ta.side)==="short"?" (Suggested)":""]})]}),(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Max"}),(0,s.jsx)("strong",{children:tk?"".concat(j(tk,4)," ").concat(tS):"-"})]}),(0,s.jsxs)("button",{className:"btn",onClick:()=>void tU(),type:"button",children:["Cancel All (",ex,")"]}),(0,s.jsx)("div",{className:"tradeOrderDivider"}),(0,s.jsx)("div",{className:"tradeOrderInfoTitle",children:"Account"}),(0,s.jsxs)("div",{className:"tradeOrderInfoGrid",children:[(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Margin"}),(0,s.jsx)("strong",{children:j(null==ej?void 0:ej.availableMargin,3)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Equity"}),(0,s.jsx)("strong",{children:j(null==ej?void 0:ej.equity,3)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Last"}),(0,s.jsx)("strong",{children:j(null==ez?void 0:ez.last,4)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Mark"}),(0,s.jsx)("strong",{children:j(null==ez?void 0:ez.mark,4)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Bid / Ask"}),(0,s.jsxs)("strong",{children:[j(null==ez?void 0:ez.bid,4)," / ",j(null==ez?void 0:ez.ask,4)]})]})]}),(0,s.jsx)("div",{className:"tradeOrderSelectedAccount",children:tm?"".concat(tm.exchange.toUpperCase()," - ").concat(tm.label):"-"})]})]})]}),(0,s.jsxs)("section",{className:"card",style:{padding:12,marginTop:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,flexWrap:"wrap",gap:8},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:"Positions"}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["Symbol filter: ",ex]})]}),(0,s.jsx)("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{textAlign:"left",color:"var(--muted)"},children:[(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Side"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Size"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Entry"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Mark"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"PnL"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Action"})]})}),(0,s.jsx)("tbody",{children:0===eN.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,style:{padding:10,color:"var(--muted)"},children:"No open positions."})}):eN.map((e,t)=>{var i;return(0,s.jsxs)("tr",{style:{borderTop:"1px solid rgba(255,255,255,.06)"},children:[(0,s.jsx)("td",{style:{padding:"8px 6px",color:"long"===e.side?"#34d399":"#f87171"},children:e.side.toUpperCase()}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:j(e.size,6)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:j(e.entryPrice,4)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:j(e.markPrice,4)}),(0,s.jsx)("td",{style:{padding:"8px 6px",color:(null!=(i=e.unrealizedPnl)?i:0)>=0?"#34d399":"#f87171"},children:j(e.unrealizedPnl,2)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:(0,s.jsx)("button",{className:"btn",onClick:()=>void tL(e.side),children:"Close"})})]},"".concat(e.side,"_").concat(t))})})]})})]}),(0,s.jsxs)("section",{className:"card",style:{padding:12,marginTop:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,flexWrap:"wrap",gap:8},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:"Open Orders"}),(0,s.jsx)("button",{className:"btn",onClick:()=>void tU(),children:"Cancel All"})]}),(0,s.jsx)("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{textAlign:"left",color:"var(--muted)"},children:[(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Order ID"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Side"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Type"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Price"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Qty"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Status"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Action"})]})}),(0,s.jsx)("tbody",{children:0===ek.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,style:{padding:10,color:"var(--muted)"},children:"No open orders."})}):ek.map(e=>{var t,i,n;return(0,s.jsxs)("tr",{style:{borderTop:"1px solid rgba(255,255,255,.06)"},children:[(0,s.jsxs)("td",{style:{padding:"8px 6px"},children:[e.orderId.slice(0,12),"..."]}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:null!=(t=e.side)?t:"-"}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:null!=(i=e.type)?i:"-"}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:j(e.price,4)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:j(e.qty,6)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:null!=(n=e.status)?n:"-"}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:(0,s.jsx)("button",{className:"btn",onClick:()=>void tB(e.orderId),children:"Cancel"})})]},e.orderId)})})]})})]})]}),eQ?(0,s.jsx)("div",{className:"tradeModalBackdrop",onClick:()=>eG(!1),children:(0,s.jsxs)("div",{className:"tradeModalCard",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"tradeModalHeader",children:[(0,s.jsx)("h3",{children:"Futures unit setting"}),(0,s.jsx)("button",{type:"button",className:"tradeModalCloseBtn",onClick:()=>eG(!1),"aria-label":"Close",children:"\xd7"})]}),(0,s.jsx)("div",{className:"tradeModalOptions",children:_.map(e=>{let t="BASE"===e.unit?ty:e.unit,i=eq===e.value;return(0,s.jsxs)("button",{type:"button",className:"tradeModalOption ".concat(i?"tradeModalOptionActive":""),onClick:()=>eY(e.value),children:[(0,s.jsxs)("div",{className:"tradeModalOptionTitle",children:[e.title,"-",t]}),(0,s.jsx)("div",{className:"tradeModalOptionDescription",children:e.description})]},e.value)})}),(0,s.jsxs)("div",{className:"tradeModalActions",children:[(0,s.jsx)("button",{type:"button",className:"tradeModalSecondaryBtn",onClick:()=>eG(!1),children:"Cancel"}),(0,s.jsx)("button",{type:"button",className:"tradeModalPrimaryBtn",onClick:()=>{eH(eq),eV(0),eD(""),eG(!1)},children:"Confirm"})]})]})}):null]})}function C(){return(0,s.jsx)(d.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading trade pageâ€¦"}),children:(0,s.jsx)(N,{})})}},5606:(e,t,i)=>{i.d(t,{i4:()=>u,jH:()=>p,xf:()=>l});var n=i(3916);let l="tradeDeskPrefill",a=n.Ik({type:n.k5(["market","limit"]),price:n.ai().positive().optional()}),s=n.Ik({mode:n.k5(["percent_balance","fixed_quote"]),value:n.ai().positive()}),r=n.Ik({name:n.Yj().min(1),value:n.L5()}),o=n.Ik({rsi_14:n.ai().nullable().optional(),macd:n.Ik({line:n.ai().nullable().optional(),signal:n.ai().nullable().optional(),hist:n.ai().nullable().optional()}).nullable().optional(),bb:n.Ik({upper:n.ai().nullable().optional(),mid:n.ai().nullable().optional(),lower:n.ai().nullable().optional(),width_pct:n.ai().nullable().optional(),pos:n.ai().nullable().optional()}).nullable().optional(),vwap:n.Ik({value:n.ai().nullable().optional(),dist_pct:n.ai().nullable().optional(),mode:n.Yj().optional(),sessionStartUtcMs:n.ai().nullable().optional()}).nullable().optional(),adx:n.Ik({adx_14:n.ai().nullable().optional(),plus_di_14:n.ai().nullable().optional(),minus_di_14:n.ai().nullable().optional()}).nullable().optional(),stochrsi:n.Ik({rsi_len:n.ai().int().positive().optional(),stoch_len:n.ai().int().positive().optional(),smooth_k:n.ai().int().positive().optional(),smooth_d:n.ai().int().positive().optional(),k:n.ai().nullable().optional(),d:n.ai().nullable().optional(),value:n.ai().nullable().optional()}).nullable().optional(),volume:n.Ik({lookback:n.ai().int().positive().optional(),vol_z:n.ai().nullable().optional(),rel_vol:n.ai().nullable().optional(),vol_ema_fast:n.ai().nullable().optional(),vol_ema_slow:n.ai().nullable().optional(),vol_trend:n.ai().nullable().optional()}).nullable().optional(),fvg:n.Ik({lookback:n.ai().int().positive().optional(),fill_rule:n.k5(["overlap","mid_touch"]).optional(),open_bullish_count:n.ai().int().nonnegative().optional(),open_bearish_count:n.ai().int().nonnegative().optional(),nearest_bullish_gap:n.Ik({upper:n.ai().nullable().optional(),lower:n.ai().nullable().optional(),mid:n.ai().nullable().optional(),dist_pct:n.ai().nullable().optional(),age_bars:n.ai().nullable().optional()}).nullable().optional(),nearest_bearish_gap:n.Ik({upper:n.ai().nullable().optional(),lower:n.ai().nullable().optional(),mid:n.ai().nullable().optional(),dist_pct:n.ai().nullable().optional(),age_bars:n.ai().nullable().optional()}).nullable().optional(),last_created:n.Ik({type:n.k5(["bullish","bearish"]).nullable().optional(),age_bars:n.ai().nullable().optional()}).nullable().optional(),last_filled:n.Ik({type:n.k5(["bullish","bearish"]).nullable().optional(),age_bars:n.ai().nullable().optional()}).nullable().optional()}).nullable().optional()}).optional(),d=n.Ik({exchange:n.Yj().trim().min(1),accountId:n.Yj().trim().min(1),symbol:n.Yj().trim().min(1),marketType:n.k5(["spot","perp"]),timeframe:n.k5(["5m","15m","1h","4h","1d"]),predictionId:n.Yj().trim().min(1),tsCreated:n.Yj().datetime(),signal:n.k5(["up","down","neutral"]),confidence:n.ai().min(0).max(100),expectedMovePct:n.ai().optional(),leverage:n.ai().int().min(1).max(125).optional(),side:n.k5(["long","short"]).optional(),suggestedEntry:a.optional(),suggestedStopLoss:n.ai().positive().optional(),suggestedTakeProfit:n.ai().positive().optional(),positionSizeHint:s.optional(),tags:n.YO(n.Yj()).max(5).optional(),explanation:n.Yj().max(400).optional(),keyDrivers:n.YO(r).max(5).optional(),indicators:o});function c(e,t){let i=Number(e);if(Number.isFinite(i))return Number(i.toFixed(t))}function u(e){var t,i,n,l,a,s,r,o,u,p,h,m,g;let v=(m=e.signal,g=e.marketType,"up"===m?{side:"long"}:"down"===m?"spot"===g?{info:"Spot short not supported. Please choose a valid spot action manually."}:{side:"short"}:{}),b={exchange:e.exchange,accountId:e.accountId,symbol:e.symbol,marketType:e.marketType,timeframe:e.timeframe,predictionId:e.predictionId,tsCreated:e.tsCreated,signal:e.signal,confidence:Number.isFinite(h=e.confidence)?Math.max(0,Math.min(100,h<=1?100*h:h)):0,expectedMovePct:"number"==typeof e.expectedMovePct&&Number.isFinite(e.expectedMovePct)?Number(e.expectedMovePct.toFixed(2)):void 0,leverage:null!=(n=e.leverage)?n:void 0,side:v.side,suggestedEntry:null!=(l=e.suggestedEntry)?l:void 0,suggestedStopLoss:null!=(a=e.suggestedStopLoss)?a:void 0,suggestedTakeProfit:null!=(s=e.suggestedTakeProfit)?s:void 0,positionSizeHint:null!=(r=e.positionSizeHint)?r:void 0,tags:null!=(o=null==(t=e.tags)?void 0:t.slice(0,5))?o:void 0,explanation:null!=(u=e.explanation)?u:void 0,keyDrivers:null!=(p=null==(i=e.keyDrivers)?void 0:i.slice(0,5))?p:void 0,indicators:function(e){var t,i;if(!e)return;let n=(null==(t=e.fvg)?void 0:t.fill_rule)==="mid_touch"?"mid_touch":(null==(i=e.fvg)?void 0:i.fill_rule)==="overlap"?"overlap":void 0;return{rsi_14:c(e.rsi_14,1),macd:e.macd?{line:c(e.macd.line,4),signal:c(e.macd.signal,4),hist:c(e.macd.hist,4)}:void 0,bb:e.bb?{upper:c(e.bb.upper,4),mid:c(e.bb.mid,4),lower:c(e.bb.lower,4),width_pct:c(e.bb.width_pct,2),pos:c(e.bb.pos,3)}:void 0,vwap:e.vwap?{value:c(e.vwap.value,4),dist_pct:c(e.vwap.dist_pct,2),mode:e.vwap.mode,sessionStartUtcMs:"number"==typeof e.vwap.sessionStartUtcMs&&Number.isFinite(e.vwap.sessionStartUtcMs)?e.vwap.sessionStartUtcMs:void 0}:void 0,adx:e.adx?{adx_14:c(e.adx.adx_14,1),plus_di_14:c(e.adx.plus_di_14,1),minus_di_14:c(e.adx.minus_di_14,1)}:void 0,stochrsi:e.stochrsi?{rsi_len:c(e.stochrsi.rsi_len,0),stoch_len:c(e.stochrsi.stoch_len,0),smooth_k:c(e.stochrsi.smooth_k,0),smooth_d:c(e.stochrsi.smooth_d,0),k:c(e.stochrsi.k,1),d:c(e.stochrsi.d,1),value:c(e.stochrsi.value,1)}:void 0,volume:e.volume?{lookback:c(e.volume.lookback,0),vol_z:c(e.volume.vol_z,3),rel_vol:c(e.volume.rel_vol,3),vol_ema_fast:c(e.volume.vol_ema_fast,4),vol_ema_slow:c(e.volume.vol_ema_slow,4),vol_trend:c(e.volume.vol_trend,2)}:void 0,fvg:e.fvg?{lookback:c(e.fvg.lookback,0),fill_rule:n,open_bullish_count:c(e.fvg.open_bullish_count,0),open_bearish_count:c(e.fvg.open_bearish_count,0),nearest_bullish_gap:e.fvg.nearest_bullish_gap?{upper:c(e.fvg.nearest_bullish_gap.upper,4),lower:c(e.fvg.nearest_bullish_gap.lower,4),mid:c(e.fvg.nearest_bullish_gap.mid,4),dist_pct:c(e.fvg.nearest_bullish_gap.dist_pct,2),age_bars:c(e.fvg.nearest_bullish_gap.age_bars,0)}:void 0,nearest_bearish_gap:e.fvg.nearest_bearish_gap?{upper:c(e.fvg.nearest_bearish_gap.upper,4),lower:c(e.fvg.nearest_bearish_gap.lower,4),mid:c(e.fvg.nearest_bearish_gap.mid,4),dist_pct:c(e.fvg.nearest_bearish_gap.dist_pct,2),age_bars:c(e.fvg.nearest_bearish_gap.age_bars,0)}:void 0,last_created:e.fvg.last_created?{type:"bullish"===e.fvg.last_created.type||"bearish"===e.fvg.last_created.type?e.fvg.last_created.type:void 0,age_bars:c(e.fvg.last_created.age_bars,0)}:void 0,last_filled:e.fvg.last_filled?{type:"bullish"===e.fvg.last_filled.type||"bearish"===e.fvg.last_filled.type?e.fvg.last_filled.type:void 0,age_bars:c(e.fvg.last_filled.age_bars,0)}:void 0}:void 0}}(e.indicators)};return{payload:d.parse(b),info:v.info}}function p(e){let t=d.safeParse(e);return t.success?t.data:null}}}]);