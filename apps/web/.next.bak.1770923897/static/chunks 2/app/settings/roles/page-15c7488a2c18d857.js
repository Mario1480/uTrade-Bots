(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{1832:(e,t,a)=>{Promise.resolve().then(a.bind(a,4664))},2883:(e,t,a)=>{"use strict";a.d(t,{$P:()=>m,Al:()=>h,GC:()=>y,Vg:()=>u,hD:()=>c,mu:()=>p});var n,s,i,l,r=a(7011);null!=(null!=(n=r.env.API_URL)?n:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let o=null!=(l=null!=(i=null!=(s=r.env.NEXT_PUBLIC_API_URL)?s:r.env.API_URL)?i:r.env.API_BASE_URL)?l:"http://localhost:4000";class c extends Error{constructor(e,t,a){super(e),this.status=t,this.payload=a}}async function d(e,t,a){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let s=await fetch("".concat(o).concat(t),{method:e,headers:n,body:a?JSON.stringify(a):void 0,credentials:"include",cache:"no-store"});if(!s.ok){let a=null;try{a=await s.json()}catch(e){}throw new c((null==a?void 0:a.error)||(null==a?void 0:a.message)||"".concat(e," ").concat(t," failed (").concat(s.status,")"),s.status,a)}return s.json()}function u(e){return d("GET",e)}function m(e,t){return d("POST",e,t)}function p(e,t){return d("PUT",e,t)}function h(e){return d("DELETE",e)}function y(e){return d("DELETE",e)}},4664:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var n=a(4568),s=a(9664),i=a.n(s),l=a(7620),r=a(2883);function o(e){let{open:t,onClose:a,onVerified:s}=e,[i,o]=(0,l.useState)(""),[c,d]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[p,h]=(0,l.useState)(!1),[y,g]=(0,l.useState)(!1),[f,v]=(0,l.useState)(""),[b,x]=(0,l.useState)(!0);function k(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):(null==e?void 0:e.message)?String(e.message):String(e)}async function w(){h(!0),d("sending..."),m("");try{await (0,r.$P)("/auth/reauth/request-otp"),d("code sent"),setTimeout(()=>d(""),1500)}catch(e){d(""),m(k(e))}finally{h(!1)}}async function j(){g(!0),d("verifying..."),m("");try{b?await (0,r.$P)("/auth/reauth/verify-otp",{code:i}):await (0,r.$P)("/auth/reauth",{password:f}),await s(),a()}catch(e){d(""),m(k(e))}finally{g(!1)}}return((0,l.useEffect)(()=>{t||(o(""),d(""),m(""),h(!1),g(!1),v(""))},[t]),(0,l.useEffect)(()=>{t&&(0,r.Vg)("/settings/security").then(e=>x(!1!==e.reauthOtpEnabled)).catch(()=>x(!0))},[t]),t)?(0,n.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},children:(0,n.jsxs)("div",{className:"card",style:{padding:16,width:360,maxWidth:"92vw"},children:[(0,n.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Re-auth required"}),(0,n.jsx)("div",{style:{fontSize:13,opacity:.8,marginBottom:12},children:b?"Send a 6-digit code to your email and enter it here.":"Confirm your password to continue."}),(0,n.jsxs)("div",{style:{display:"grid",gap:8},children:[b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn",onClick:w,disabled:p,children:p?"Sending...":"Send code"}),(0,n.jsx)("input",{className:"input",placeholder:"6-digit code",value:i,onChange:e=>o(e.target.value),maxLength:6,inputMode:"numeric"})]}):(0,n.jsx)("input",{className:"input",type:"password",placeholder:"Password",value:f,onChange:e=>v(e.target.value)}),(0,n.jsx)("button",{className:"btn btnPrimary",onClick:j,disabled:y||(b?6!==i.trim().length:f.length<6),children:y?"Verifying...":"Verify"}),(0,n.jsx)("button",{className:"btn",onClick:a,children:"Cancel"}),c?(0,n.jsx)("div",{style:{fontSize:12,opacity:.8},children:c}):null,u?(0,n.jsx)("div",{style:{fontSize:12,color:"var(--danger)"},children:u}):null]})]})}):null}let c=[{key:"bots.view",label:"View bots"},{key:"bots.create",label:"Create bots"},{key:"bots.edit_config",label:"Edit configs"},{key:"bots.start_pause_stop",label:"Start/pause/stop"},{key:"bots.delete",label:"Delete bots"},{key:"trading.manual_limit",label:"Manual limit trades"},{key:"trading.manual_market",label:"Manual market trades"},{key:"trading.price_support",label:"Price support"},{key:"exchange_keys.view_present",label:"View keys configured"},{key:"exchange_keys.edit",label:"Edit exchange keys"},{key:"risk.edit",label:"Edit risk"},{key:"presets.view",label:"View presets"},{key:"presets.create",label:"Create presets"},{key:"presets.apply",label:"Apply presets"},{key:"presets.delete",label:"Delete presets"},{key:"users.manage_members",label:"Manage members"},{key:"users.manage_roles",label:"Manage roles"},{key:"settings.security",label:"Security settings"},{key:"audit.view",label:"View audit log"}];function d(){var e,t;let[a,s]=(0,l.useState)(null),[d,u]=(0,l.useState)([]),[m,p]=(0,l.useState)([]),[h,y]=(0,l.useState)(""),[g,f]=(0,l.useState)(""),[v,b]=(0,l.useState)(!1),[x,k]=(0,l.useState)(""),[w,j]=(0,l.useState)(""),[S,C]=(0,l.useState)(null),[I,_]=(0,l.useState)(""),[N,E]=(0,l.useState)(""),[T,P]=(0,l.useState)(""),[R,z]=(0,l.useState)(!1),[W,B]=(0,l.useState)(null);function A(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):(null==e?void 0:e.message)?String(e.message):String(e)}function V(e){var t;return e instanceof r.hD&&401===e.status&&(null==(t=e.payload)?void 0:t.error)==="REAUTH_REQUIRED"}function D(e){B(()=>e),z(!0)}function L(e,t){return!!V(e)&&(_("Re-auth required."),D(t),!0)}async function U(){W&&(B(null),await W())}async function O(){try{let e=await (0,r.Vg)("/auth/me");s(e);let[t,a]=await Promise.all([(0,r.Vg)("/workspaces/".concat(e.workspaceId,"/members")),(0,r.Vg)("/workspaces/".concat(e.workspaceId,"/roles"))]);p(t);let n=function(e){let t=new Map([["Admin",0],["Operator 1",1],["Operator 2",2],["Viewer",3]]);return[...e].sort((e,a)=>{let n=t.has(e.name)?t.get(e.name):99,s=t.has(a.name)?t.get(a.name):99;return n!==s?n-s:String(e.name).localeCompare(String(a.name))})}(a);u(n),!g&&n.length&&f(n[0].id)}catch(e){_(A(e))}}(0,l.useEffect)(()=>{O()},[]);let M=!!((null==a||null==(e=a.permissions)?void 0:e["users.manage_roles"])||(null==a?void 0:a.isSuperadmin)),$=!!((null==a||null==(t=a.permissions)?void 0:t["users.manage_members"])||(null==a?void 0:a.isSuperadmin));function q(e,t){return!!V(e)&&(j("Re-auth required to manage members."),D(t),!0)}async function G(){if(h&&g&&(null==a?void 0:a.workspaceId)){k("inviting..."),j("");try{await (0,r.$P)("/workspaces/".concat(a.workspaceId,"/members/invite"),{email:h,roleId:g,resetPassword:v}),y(""),b(!1),k("invited"),await O(),setTimeout(()=>k(""),1200)}catch(e){k(""),q(e,G)||j(A(e))}}}async function H(e,t){if(null==a?void 0:a.workspaceId){C(e),j("");try{await (0,r.mu)("/workspaces/".concat(a.workspaceId,"/members/").concat(e),{roleId:t}),await O()}catch(a){q(a,()=>H(e,t))||j(A(a))}finally{C(null)}}}async function F(e){if((null==a?void 0:a.workspaceId)&&confirm("Remove member from workspace?")){C(e),j("");try{await (0,r.GC)("/workspaces/".concat(a.workspaceId,"/members/").concat(e)),await O()}catch(t){q(t,()=>F(e))||j(A(t))}finally{C(null)}}}async function X(e,t,n){_("");try{var s;let i=d.find(t=>t.id===e),l={...null!=(s=null==i?void 0:i.permissions)?s:{},[t]:n};await (0,r.mu)("/workspaces/".concat(a.workspaceId,"/roles/").concat(e),{permissions:l}),u(t=>t.map(t=>t.id===e?{...t,permissions:l}:t))}catch(a){L(a,()=>X(e,t,n))||_(A(a))}}async function Y(e,t){_("");try{await (0,r.mu)("/workspaces/".concat(a.workspaceId,"/roles/").concat(e),{name:t}),u(a=>a.map(a=>a.id===e?{...a,name:t}:a))}catch(a){L(a,()=>Y(e,t))||_(A(a))}}async function J(){if(T){E("creating..."),_("");try{let e=await (0,r.$P)("/workspaces/".concat(a.workspaceId,"/roles"),{name:T,permissions:{}});u(t=>[...t,e]),P(""),E("created"),setTimeout(()=>E(""),1200)}catch(e){E(""),L(e,J)||_(A(e))}}}async function Q(e){if(confirm("Delete this role?")){_("");try{await (0,r.GC)("/workspaces/".concat(a.workspaceId,"/roles/").concat(e)),u(t=>t.filter(t=>t.id!==e))}catch(t){L(t,()=>Q(e))||_(A(t))}}}return(0,n.jsxs)("div",{style:{maxWidth:980},children:[(0,n.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)(i(),{href:"/settings",className:"btn",children:"← Back to settings"}),(0,n.jsx)(i(),{href:"/",className:"btn",children:"← Back to dashboard"})]}),(0,n.jsx)("h2",{style:{marginTop:0},children:"Members & Roles"}),(0,n.jsxs)("div",{className:"card",style:{padding:12,marginBottom:14},children:[(0,n.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Workspace members"}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:"Invite users and assign roles for this workspace."}),(0,n.jsx)("div",{style:{display:"grid",gap:8},children:m.length?m.map(e=>{var t;return(0,n.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,n.jsxs)("div",{style:{minWidth:220},children:[(0,n.jsx)("div",{style:{fontWeight:600},children:e.email}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:e.status})]}),["admin@utrade.vip","admin@uliquid.vip"].includes(String(null!=(t=e.email)?t:"").toLowerCase())?(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"Superadmin"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("select",{className:"input",style:{maxWidth:220},disabled:!$||S===e.id,value:e.roleId,onChange:t=>H(e.id,t.target.value),children:d.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,n.jsx)("button",{className:"btn btnStop",onClick:()=>F(e.id),disabled:!$||S===e.id,children:"Remove"})]})]},e.id)}):(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"No members yet."})}),$?(0,n.jsxs)("div",{style:{marginTop:12,display:"grid",gap:8},children:[(0,n.jsx)("div",{style:{fontWeight:600},children:"Invite member"}),(0,n.jsx)("input",{className:"input",value:h,onChange:e=>y(e.target.value),placeholder:"email@domain.com"}),(0,n.jsx)("select",{className:"input",value:g,onChange:e=>f(e.target.value),children:d.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,n.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center",fontSize:12},children:[(0,n.jsx)("input",{type:"checkbox",checked:v,onChange:e=>b(e.target.checked)}),"Reset password and include a temporary password in the email"]}),(0,n.jsx)("button",{className:"btn btnPrimary",onClick:G,disabled:!h||!g,children:"Invite"})]}):(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:8},children:"You don’t have permission to manage members."}),x?(0,n.jsx)("div",{style:{fontSize:12,opacity:.7,marginTop:8},children:x}):null,w?(0,n.jsx)("div",{style:{fontSize:12,color:"#ff6b6b",marginTop:8},children:w}):null]}),M?null:(0,n.jsx)("div",{className:"card",style:{padding:12,fontSize:12,color:"var(--muted)"},children:"You don’t have permission to manage roles."}),(0,n.jsx)("div",{style:{display:"grid",gap:12},children:d.map(e=>(0,n.jsxs)("details",{className:"card",style:{padding:12},children:[(0,n.jsx)("summary",{style:{cursor:"pointer",fontWeight:700,marginBottom:10},children:e.name}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)("input",{className:"input",style:{maxWidth:220},value:e.name,disabled:!M||e.isSystem,onChange:t=>Y(e.id,t.target.value)}),e.isSystem?(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"System role"}):(0,n.jsx)("button",{className:"btn btnStop",disabled:!M,onClick:()=>Q(e.id),children:"Delete"})]}),(0,n.jsx)("div",{style:{marginTop:10,display:"grid",gap:6},children:c.map(t=>{var a;return(0,n.jsxs)("label",{style:{fontSize:13,display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("input",{type:"checkbox",checked:!!(null==(a=e.permissions)?void 0:a[t.key]),disabled:!M,onChange:a=>X(e.id,t.key,a.target.checked)}),t.label]},t.key)})})]},e.id))}),M?(0,n.jsxs)("div",{className:"card",style:{padding:12,marginTop:14},children:[(0,n.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Create role"}),(0,n.jsx)("input",{className:"input",value:T,onChange:e=>P(e.target.value),placeholder:"Role name"}),(0,n.jsx)("button",{className:"btn btnPrimary",style:{marginTop:8},onClick:J,children:"Create role"}),N?(0,n.jsx)("div",{style:{fontSize:12,opacity:.7,marginTop:6},children:N}):null]}):null,(0,n.jsx)(o,{open:R,onClose:()=>{z(!1),B(null)},onVerified:U}),I?(0,n.jsx)("div",{style:{fontSize:12,color:"#ff6b6b",marginTop:10},children:I}):null]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=1832)),_N_E=e.O()}]);