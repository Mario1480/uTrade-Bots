(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[793],{2839:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var s=n(4568),a=n(9664),l=n.n(a),i=n(7620),r=n(2883);function o(){let[e,t]=(0,i.useState)(""),[n,a]=(0,i.useState)(""),[o,c]=(0,i.useState)(""),[u,d]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),[g,m]=(0,i.useState)(""),[y,f]=(0,i.useState)(!0),[x,v]=(0,i.useState)(!1),[b,j]=(0,i.useState)(null),[S,w]=(0,i.useState)(!0),[E,N]=(0,i.useState)(60),[C,P]=(0,i.useState)(!0),[T,_]=(0,i.useState)(!1);function k(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):(null==e?void 0:e.message)?String(e.message):String(e)}async function L(){f(!0),j(null);try{let e=await (0,r.Vg)("/settings/security");w(!!e.autoLogoutEnabled),N(Number(e.autoLogoutMinutes)||60),P(!1!==e.reauthOtpEnabled),_(!!e.isSuperadmin)}catch(e){j(k(e))}finally{f(!1)}}async function I(){v(!0),j(null);let e=Math.max(1,Math.min(1440,Math.floor(E)));try{let t={autoLogoutEnabled:S,autoLogoutMinutes:e};T&&(t.reauthOtpEnabled=C);let n=await (0,r.mu)("/settings/security",t);w(!!n.autoLogoutEnabled),N(Number(n.autoLogoutMinutes)||e),P(!1!==n.reauthOtpEnabled),_(!!n.isSuperadmin),j("Saved.")}catch(e){j(k(e))}finally{v(!1)}}async function B(){if(p("saving..."),m(""),o!==u){p(""),m("Passwords do not match.");return}try{await (0,r.$P)("/auth/change-password",{currentPassword:n,newPassword:o}),p("updated"),a(""),c(""),d(""),setTimeout(()=>p(""),1200)}catch(e){p(""),m(k(e))}}return(0,i.useEffect)(()=>{L()},[]),(0,s.jsxs)("div",{style:{maxWidth:720},children:[(0,s.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)(l(),{href:"/settings",className:"btn",children:"← Back to settings"}),(0,s.jsx)(l(),{href:"/",className:"btn",children:"← Back to dashboard"})]}),(0,s.jsx)("h2",{style:{marginTop:0},children:"My Account"}),(0,s.jsxs)("div",{className:"card",style:{padding:12,marginTop:14},children:[(0,s.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Change password"}),(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:"Set a new password for your account."}),(0,s.jsxs)("div",{style:{display:"grid",gap:10},children:[(0,s.jsxs)("label",{style:{fontSize:13},children:["Current password",(0,s.jsx)("input",{className:"input",type:"password",value:n,onChange:e=>a(e.target.value)})]}),(0,s.jsxs)("label",{style:{fontSize:13},children:["New password",(0,s.jsx)("input",{className:"input",type:"password",value:o,onChange:e=>c(e.target.value)})]}),(0,s.jsxs)("label",{style:{fontSize:13},children:["Confirm new password",(0,s.jsx)("input",{className:"input",type:"password",value:u,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("button",{className:"btn btnPrimary",onClick:B,disabled:!n||!o,children:"Update password"}),(0,s.jsx)("span",{style:{fontSize:12,opacity:.7},children:h})]}),g?(0,s.jsx)("div",{style:{fontSize:12,color:"#ff6b6b"},children:g}):null]}),(0,s.jsxs)("div",{className:"card",style:{padding:12,marginTop:14},children:[(0,s.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Security"}),(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:"Session and re-authentication settings for your account."}),(0,s.jsxs)("div",{style:{display:"grid",gap:10,marginBottom:10,maxWidth:320},children:[(0,s.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:S,onChange:e=>w(e.target.checked),disabled:y||x}),(0,s.jsx)("span",{children:"Enable auto-logout"})]}),(0,s.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Idle minutes"}),(0,s.jsx)("input",{className:"input",type:"number",min:1,max:1440,value:Number.isFinite(E)?E:60,onChange:e=>N(Number(e.target.value)),disabled:!S||y||x})]}),T?(0,s.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:C,onChange:e=>P(e.target.checked),disabled:y||x}),(0,s.jsx)("span",{children:"Require OTP re-auth for sensitive actions"})]}):null]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("button",{className:"btn btnPrimary",onClick:I,disabled:y||x,children:x?"Saving...":"Save settings"}),(0,s.jsx)("button",{className:"btn",onClick:L,disabled:y||x,children:y?"Loading...":"Reload"})]}),b?(0,s.jsx)("div",{style:{marginTop:10,color:"var(--muted)"},children:b}):null]})]}),e?(0,s.jsx)("div",{style:{fontSize:12,color:"#ff6b6b",marginTop:8},children:e}):null]})}},2883:(e,t,n)=>{"use strict";n.d(t,{$P:()=>h,Al:()=>g,GC:()=>m,Vg:()=>d,hD:()=>c,mu:()=>p});var s,a,l,i,r=n(7011);null!=(null!=(s=r.env.API_URL)?s:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let o=null!=(i=null!=(l=null!=(a=r.env.NEXT_PUBLIC_API_URL)?a:r.env.API_URL)?l:r.env.API_BASE_URL)?i:"http://localhost:4000";class c extends Error{constructor(e,t,n){super(e),this.status=t,this.payload=n}}async function u(e,t,n){let s={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(s["x-csrf-token"]=e)}let a=await fetch("".concat(o).concat(t),{method:e,headers:s,body:n?JSON.stringify(n):void 0,credentials:"include",cache:"no-store"});if(!a.ok){let n=null;try{n=await a.json()}catch(e){}throw new c((null==n?void 0:n.error)||(null==n?void 0:n.message)||"".concat(e," ").concat(t," failed (").concat(a.status,")"),a.status,n)}return a.json()}function d(e){return u("GET",e)}function h(e,t){return u("POST",e,t)}function p(e,t){return u("PUT",e,t)}function g(e){return u("DELETE",e)}function m(e){return u("DELETE",e)}},6707:(e,t,n)=>{Promise.resolve().then(n.bind(n,2839))}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=6707)),_N_E=e.O()}]);