"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[184],{1237:(e,t,i)=>{function n(e){var t=e.width,i=e.height;if(t<0)throw Error("Negative width is not allowed for Size");if(i<0)throw Error("Negative height is not allowed for Size");return{width:t,height:i}}function l(e,t){return e.width===t.width&&e.height===t.height}i.d(t,{Dv:()=>a,zE:()=>l,Ej:()=>n,vb:()=>c});var r=function(){function e(e){var t=this;this._resolutionListener=function(){return t._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=e,this._installResolutionListener()}return e.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(e.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e){var t=this,i={next:e};return this._observers.push(i),{unsubscribe:function(){t._observers=t._observers.filter(function(e){return e!==i})}}},e.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw Error("Resolution listener is already installed");var e=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(e,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},e.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},e.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},e.prototype._onResolutionChanged=function(){var e=this;this._observers.forEach(function(t){return t.next(e._window.devicePixelRatio)}),this._reinstallResolutionListener()},e}(),s=function(){function e(e,t,i){var l;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=e,this._canvasElementClientSize=n({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=t?t:function(e){return e},this._allowResizeObserver=null==(l=null==i?void 0:i.allowResizeObserver)||l,this._chooseAndInitObserver()}return e.prototype.dispose=function(){var e,t;if(null===this._canvasElement)throw Error("Object is disposed");null==(e=this._canvasElementResizeObserver)||e.disconnect(),this._canvasElementResizeObserver=null,null==(t=this._devicePixelRatioObservable)||t.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(e.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bitmapSize",{get:function(){return n({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),e.prototype.resizeCanvasElement=function(e){this._canvasElementClientSize=n(e),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},e.prototype.subscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners.push(e)},e.prototype.unsubscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(t){return t!==e})},Object.defineProperty(e.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),e.prototype.subscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners.push(e)},e.prototype.unsubscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(t){return t!==e})},e.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var e=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(e),this._emitSuggestedBitmapSizeChanged(e,this._suggestedBitmapSize)}},e.prototype._resizeBitmap=function(e){var t=this.bitmapSize;l(t,e)||(this.canvasElement.width=e.width,this.canvasElement.height=e.height,this._emitBitmapSizeChanged(t,e))},e.prototype._emitBitmapSizeChanged=function(e,t){var i=this;this._bitmapSizeChangedListeners.forEach(function(n){return n.call(i,e,t)})},e.prototype._suggestNewBitmapSize=function(e){var t=this._suggestedBitmapSize,i=n(this._transformBitmapSize(e,this._canvasElementClientSize)),r=l(this.bitmapSize,i)?null:i;(null!==t||null!==r)&&(null!==t&&null!==r&&l(t,r)||(this._suggestedBitmapSize=r,this._emitSuggestedBitmapSizeChanged(t,r)))},e.prototype._emitSuggestedBitmapSizeChanged=function(e,t){var i=this;this._suggestedBitmapSizeChangedListeners.forEach(function(n){return n.call(i,e,t)})},e.prototype._chooseAndInitObserver=function(){var e=this;if(!this._allowResizeObserver)return void this._initDevicePixelRatioObservable();new Promise(function(e){var t=new ResizeObserver(function(i){e(i.every(function(e){return"devicePixelContentBoxSize"in e})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1}).then(function(t){return t?e._initResizeObserver():e._initDevicePixelRatioObservable()})},e.prototype._initDevicePixelRatioObservable=function(){var e=this;if(null!==this._canvasElement){var t=o(this._canvasElement);if(null===t)throw Error("No window is associated with the canvas");this._devicePixelRatioObservable=new r(t),this._devicePixelRatioObservable.subscribe(function(){return e._invalidateBitmapSize()}),this._invalidateBitmapSize()}},e.prototype._invalidateBitmapSize=function(){if(null!==this._canvasElement){var e,t,i=o(this._canvasElement);if(null!==i){var l,r,s=null!=(t=null==(e=this._devicePixelRatioObservable)?void 0:e.value)?t:i.devicePixelRatio,a=this._canvasElement.getClientRects(),d=void 0!==a[0]?(l=a[0],r=s,n({width:Math.round(l.left*r+l.width*r)-Math.round(l.left*r),height:Math.round(l.top*r+l.height*r)-Math.round(l.top*r)})):n({width:this._canvasElementClientSize.width*s,height:this._canvasElementClientSize.height*s});this._suggestNewBitmapSize(d)}}},e.prototype._initResizeObserver=function(){var e=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver(function(t){var i=t.find(function(t){return t.target===e._canvasElement});if(i&&i.devicePixelContentBoxSize&&i.devicePixelContentBoxSize[0]){var l=i.devicePixelContentBoxSize[0],r=n({width:l.inlineSize,height:l.blockSize});e._suggestNewBitmapSize(r)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},e}();function a(e,t){if("device-pixel-content-box"===t.type)return new s(e,t.transform,t.options);throw Error("Unsupported binding target")}function o(e){return e.ownerDocument.defaultView}var d=function(){function e(e,t,i){if(0===t.width||0===t.height)throw TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=t,0===i.width||0===i.height)throw TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=e}return e.prototype.useMediaCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),e({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},e.prototype.useBitmapCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),e({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(e.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),e}();function c(e,t){var i=e.canvasElementClientSize;if(0===i.width||0===i.height)return null;var n=e.bitmapSize;if(0===n.width||0===n.height)return null;var l=e.canvasElement.getContext("2d",t);return null===l?null:new d(l,i,n)}},2883:(e,t,i)=>{i.d(t,{$P:()=>p,Al:()=>m,GC:()=>g,Vg:()=>u,hD:()=>d,mu:()=>h});var n,l,r,s,a=i(7011);null!=(null!=(n=a.env.API_URL)?n:a.env.API_BASE_URL)||a.env.NEXT_PUBLIC_API_URL;let o=null!=(s=null!=(r=null!=(l=a.env.NEXT_PUBLIC_API_URL)?l:a.env.API_URL)?r:a.env.API_BASE_URL)?s:"http://localhost:4000";class d extends Error{constructor(e,t,i){super(e),this.status=t,this.payload=i}}async function c(e,t,i){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let l=await fetch("".concat(o).concat(t),{method:e,headers:n,body:i?JSON.stringify(i):void 0,credentials:"include",cache:"no-store"});if(!l.ok){let i=null;try{i=await l.json()}catch(e){}throw new d((null==i?void 0:i.error)||(null==i?void 0:i.message)||"".concat(e," ").concat(t," failed (").concat(l.status,")"),l.status,i)}return l.json()}function u(e){return c("GET",e)}function p(e,t){return c("POST",e,t)}function h(e,t){return c("PUT",e,t)}function m(e){return c("DELETE",e)}function g(e){return c("DELETE",e)}},4834:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var n,l,r,s=i(4568),a=i(9664),o=i.n(a),d=i(7620),c=i(7541),u=i(2883),p=i(5606),h=i(7471);function m(e){let{exchangeAccountId:t,symbol:i,timeframe:n,prefill:l}=e,r=(0,d.useRef)(null),a=(0,d.useRef)(null),o=(0,d.useRef)(null),c=(0,d.useRef)(null),p=(0,d.useRef)([]),[m,g]=(0,d.useState)("loading"),[v,x]=(0,d.useState)("Loading candles..."),[f,b]=(0,d.useState)(null),[y,j]=(0,d.useState)(!1),[S,w]=(0,d.useState)(!1),_=(0,d.useMemo)(()=>"1m"===n||"5m"===n||"15m"===n||"1h"===n||"4h"===n||"1d"===n?n:"15m",[n]);return(0,d.useEffect)(()=>{if(!r.current)return;let e=(0,h.R9)(r.current,{autoSize:!0,height:520,layout:{background:{type:h.mE.Solid,color:"#07101f"},textColor:"#c7d2e2"},grid:{vertLines:{color:"rgba(148,163,184,.08)"},horzLines:{color:"rgba(148,163,184,.08)"}},rightPriceScale:{borderColor:"rgba(148,163,184,.25)"},timeScale:{borderColor:"rgba(148,163,184,.25)",timeVisible:!0,secondsVisible:!1,rightOffset:8},crosshair:{vertLine:{color:"rgba(255,255,255,.22)",width:1},horzLine:{color:"rgba(255,255,255,.22)",width:1}}}),t=e.addSeries(h.HD,{upColor:"#22c55e",downColor:"#ef4444",borderVisible:!1,wickUpColor:"#22c55e",wickDownColor:"#ef4444"});return c.current=(0,h.hR)(t,[]),a.current=e,o.current=t,()=>{for(let e of p.current)t.removePriceLine(e);p.current=[],c.current=null,o.current=null,a.current=null,e.remove()}},[]),(0,d.useEffect)(()=>{if(!t||!i||!o.current)return;let e=!0,n=null,l=async()=>{var n,l,r,s,d;try{let c=await (0,u.Vg)("/api/market/candles?exchangeAccountId=".concat(encodeURIComponent(t),"&symbol=").concat(encodeURIComponent(i),"&timeframe=").concat(encodeURIComponent(_),"&limit=").concat(200));if(!e)return;let p=function(e){let t=[];for(let i of e)i.ts&&Number.isFinite(i.ts)&&t.push({time:Math.floor(i.ts/1e3),open:i.open,high:i.high,low:i.low,close:i.close});return t}(c.items);null==(n=o.current)||n.setData(p),null==(l=a.current)||l.timeScale().fitContent(),null==(r=a.current)||r.timeScale().applyOptions({rightOffset:8});let h=p.length>0&&null!=(d=null==(s=p[p.length-1])?void 0:s.close)?d:null;b(null!=h?h:null),g("ready"),x(p.length>0?"".concat(p.length," candles loaded"):"No candles available")}catch(t){if(!e)return;g("error"),x(t instanceof u.hD?"".concat(t.message," (HTTP ").concat(t.status,")"):t&&"object"==typeof t&&"message"in t?String(t.message):String(t))}};return g("loading"),x("Loading candles..."),l(),n=setInterval(()=>{l()},15e3),()=>{e=!1,n&&clearInterval(n)}},[t,i,_]),(0,d.useEffect)(()=>{if(!t||!i||!c.current)return;let e=!0,n=null,l=async()=>{try{var n;let l=await (0,u.Vg)("/api/predictions?limit=200&mode=history");if(!e||!c.current)return;let r=(null!=(n=l.items)?n:[]).filter(e=>{var n;return(null==(n=e.symbol)?void 0:n.toUpperCase())===i.toUpperCase()&&e.timeframe===_&&"neutral"!==e.signal&&("up"===e.signal&&y||"down"===e.signal&&S)&&(!e.accountId||e.accountId===t)}),s=[];for(let e of r){let t=new Date(e.tsCreated).getTime();if(!Number.isFinite(t))continue;let i=Math.floor(t/1e3);if("up"===e.signal){s.push({time:i,position:"belowBar",shape:"arrowUp",color:"#22c55e",text:"UP ".concat(Number.isFinite(e.confidence)?"".concat(e.confidence.toFixed(0),"%"):"")});continue}if("down"===e.signal){s.push({time:i,position:"aboveBar",shape:"arrowDown",color:"#ef4444",text:"DOWN ".concat(Number.isFinite(e.confidence)?"".concat(e.confidence.toFixed(0),"%"):"")});continue}s.push({time:i,position:"inBar",shape:"circle",color:"#94a3b8",text:"NEUTRAL"})}c.current.setMarkers(s)}catch(t){if(!e||!c.current)return;c.current.setMarkers([])}};return l(),n=setInterval(()=>{l()},3e4),()=>{var t;e=!1,n&&clearInterval(n),null==(t=c.current)||t.setMarkers([])}},[t,i,_,y,S]),(0,d.useEffect)(()=>{var e;let t=o.current;if(!t)return;for(let e of p.current)t.removePriceLine(e);if(p.current=[],!l)return;let i=[],n=(null==(e=l.suggestedEntry)?void 0:e.type)==="limit"&&"number"==typeof l.suggestedEntry.price?l.suggestedEntry.price:f;"number"==typeof n&&Number.isFinite(n)&&i.push(t.createPriceLine({price:n,color:"#38bdf8",lineWidth:1,lineStyle:h.Sc.Solid,title:"Entry"})),"number"==typeof l.suggestedTakeProfit&&Number.isFinite(l.suggestedTakeProfit)&&i.push(t.createPriceLine({price:l.suggestedTakeProfit,color:"#22c55e",lineWidth:1,lineStyle:h.Sc.Dashed,title:"TP"})),"number"==typeof l.suggestedStopLoss&&Number.isFinite(l.suggestedStopLoss)&&i.push(t.createPriceLine({price:l.suggestedStopLoss,color:"#ef4444",lineWidth:1,lineStyle:h.Sc.Dashed,title:"SL"})),p.current=i},[l,f]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{ref:r,style:{width:"100%",height:520}}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:12,color:"var(--muted)",display:"flex",justifyContent:"space-between",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("span",{children:"Chart engine: lightweight-charts"}),(0,s.jsx)("span",{children:"error"===m?"Chart error: ".concat(v):v})]}),(0,s.jsxs)("div",{style:{marginTop:8,display:"flex",gap:14,flexWrap:"wrap",fontSize:12},children:[(0,s.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(0,s.jsx)("input",{type:"checkbox",checked:y,onChange:e=>j(e.target.checked)}),"Show Up Signals"]}),(0,s.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[(0,s.jsx)("input",{type:"checkbox",checked:S,onChange:e=>w(e.target.checked)}),"Show Down Signals"]})]})]})}var g=i(7011);let v=null!=(r=null!=(l=null!=(n=g.env.NEXT_PUBLIC_API_URL)?n:g.env.API_URL)?l:g.env.API_BASE_URL)?r:"http://localhost:4000",x=["1m","5m","15m","1h","4h","1d"],f=[{value:"quantity",title:"Quantity",description:"Quantity of the futures position, measured in base asset.",unit:"BASE"},{value:"cost",title:"Cost",description:"Margin amount used for the trade.",unit:"USDT"},{value:"value",title:"Value",description:"Notional value of the position.",unit:"USDT"}];function b(e){if(e instanceof TypeError){var t;let i=String(null!=(t=e.message)?t:"");if(i.includes("NetworkError")||i.includes("Failed to fetch"))return"API connection failed (".concat(v,"). Check if apps/api is running on port 4000.")}return e instanceof u.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||Number.isNaN(e)?"-":Number(e).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}function j(e,t){return null!=e&&Number.isFinite(e)?Number(e).toFixed(t):"n/a"}function S(){var e,t,i,n,l,r,a,h,g,S,w,_,N,C,z,O,I,k,P,E,M,R,T,B,L;let A=(0,c.useRouter)(),U=(0,c.useSearchParams)(),F=(0,d.useMemo)(()=>v.startsWith("https://")?"wss://".concat(v.slice(8)):v.startsWith("http://")?"ws://".concat(v.slice(7)):v,[]),[D,V]=(0,d.useState)([]),[W,H]=(0,d.useState)([]),[q,Q]=(0,d.useState)(""),[Y,G]=(0,d.useState)("BTCUSDT"),[$,X]=(0,d.useState)("15m"),[J,K]=(0,d.useState)(null),[Z,ee]=(0,d.useState)([]),[et,ei]=(0,d.useState)([]),[en,el]=(0,d.useState)(null),[er,es]=(0,d.useState)("limit"),[ea,eo]=(0,d.useState)("isolated"),[ed,ec]=(0,d.useState)("open"),[eu,ep]=(0,d.useState)("10"),[eh,em]=(0,d.useState)("0.001"),[eg,ev]=(0,d.useState)(0),[ex,ef]=(0,d.useState)("quantity"),[eb,ey]=(0,d.useState)("quantity"),[ej,eS]=(0,d.useState)(!1),[ew,e_]=(0,d.useState)(""),[eN,eC]=(0,d.useState)(!1),[ez,eO]=(0,d.useState)(""),[eI,ek]=(0,d.useState)(""),[eP,eE]=(0,d.useState)(!0),[eM,eR]=(0,d.useState)(null),[eT,eB]=(0,d.useState)(null),[eL,eA]=(0,d.useState)(null),[eU,eF]=(0,d.useState)(!1),[eD,eV]=(0,d.useState)(!1),[eW,eH]=(0,d.useState)(null),[eq,eQ]=(0,d.useState)(null),[eY,eG]=(0,d.useState)(!0),e$=(0,d.useRef)(null),eX=(0,d.useRef)(null),eJ=(0,d.useRef)(null),eK=(0,d.useMemo)(()=>{var e;return null!=(e=D.find(e=>e.id===q))?e:null},[D,q]),eZ=(0,d.useMemo)(()=>{var e;return null!=(e=W.find(e=>e.symbol===Y))?e:null},[W,Y]),e0=(null==eW?void 0:eW.marketType)==="spot"&&"down"===eW.signal,e1=(0,d.useMemo)(()=>{let e=Number(eu);return Number.isFinite(e)&&e>0?e:null},[eu]),e4=(0,d.useMemo)(()=>{var e,t;let i=null!=(t=null!=(e=null==en?void 0:en.mark)?e:null==en?void 0:en.last)?t:null;return null!==i&&Number.isFinite(i)&&i>0?i:null},[en]),e2=(0,d.useMemo)(()=>{var e,t;let i=null!=(e=null==J?void 0:J.availableMargin)?e:null;if(null===i||!Number.isFinite(i)||i<=0||!e1||!e4)return null;let n=i*e1/e4;if(!Number.isFinite(n)||n<=0)return null;let l=null!=(t=null==eZ?void 0:eZ.stepSize)?t:null;return null!==l&&Number.isFinite(l)&&l>0?Math.floor(n/l)*l:n},[J,e1,e4,eZ]),e8=(0,d.useMemo)(()=>Y.endsWith("USDT")&&Y.slice(0,-4)||Y,[Y]),e5=(0,d.useMemo)(()=>{var e;return null!=(e=f.find(e=>e.value===ex))?e:f[0]},[ex]),e6="quantity"===ex?e8:"USDT",e3=(0,d.useMemo)(()=>{let e=Number(eh);return Number.isFinite(e)&&e>0?e:null},[eh]),e7=(0,d.useMemo)(()=>{if("limit"===er){let e=Number(ew);return Number.isFinite(e)&&e>0?e:null}return e4},[er,ew,e4]),e9=(0,d.useMemo)(()=>null===e3?null:"quantity"===ex?e3:e7&&Number.isFinite(e7)&&!(e7<=0)?"cost"===ex?e1&&Number.isFinite(e1)&&!(e1<=0)?e3*e1/e7:null:e3/e7:null,[e1,e7,ex,e3]),te=(0,d.useMemo)(()=>{if(null===e3)return null;if("cost"===ex)return e3;if("value"===ex)return e1&&Number.isFinite(e1)&&!(e1<=0)?e3/e1:null;if(!e9||!e7)return null;let e=e9*e7;return!Number.isFinite(e)||e<=0?null:e1&&Number.isFinite(e1)&&!(e1<=0)?e/e1:e},[e1,e9,e7,ex,e3]),tt=(0,d.useMemo)(()=>{var e;let t=null!=(e=null==J?void 0:J.availableMargin)?e:null;return null===t||!Number.isFinite(t)||t<=0?null:"quantity"===ex?e2:"cost"===ex?t:e1&&Number.isFinite(e1)&&!(e1<=0)?t*e1:null},[e2,e1,ex,J]),ti=(0,d.useMemo)(()=>{if(!e7||!e1)return{long:null,short:null};let e="isolated"===ea?.004:.005,t=e7*(1-1/e1+e),i=e7*(1+1/e1-e);return{long:Number.isFinite(t)&&t>0?t:null,short:Number.isFinite(i)&&i>0?i:null}},[ea,e1,e7]);function tn(e){var t,i,n,l;let r=Math.max(0,Math.min(100,e));if(ev(r),!tt||tt<=0)return;let s=tt*r/100;if("quantity"!==ex)return!Number.isFinite(s)||s<=0?void em(""):void em(s.toFixed(4).replace(/\.?0+$/,""));let a=null!=(t=null==eZ?void 0:eZ.stepSize)?t:null,o=null!=(i=null==eZ?void 0:eZ.minQty)?i:null,d=s;if(null!==a&&Number.isFinite(a)&&a>0&&(d=Math.floor(s/a)*a),r>0&&null!==o&&Number.isFinite(o)&&o>0&&(d=Math.max(d,o)),d>0&&Number.isFinite(d)){let e=null!==a&&a>0&&Number.isFinite(a)?Math.min(8,null!=(l=null==(n=String(a).split(".")[1])?void 0:n.length)?l:0):6;em(d.toFixed(e).replace(/\.?0+$/,""))}}async function tl(e){try{await (0,u.$P)("/api/trading/settings",e)}catch(e){}}async function tr(e,t){eE(!0),eR(null);try{var i,n,l,r,s,a;let[o,d]=await Promise.all([(0,u.Vg)("/exchange-accounts"),(0,u.Vg)("/api/trading/settings")]),c=null!=(n=o.items)?n:[];V(c);let p=U.get("exchangeAccountId"),h=null!=(a=null!=(s=null!=(r=null!=(l=null!=e?e:null==t?void 0:t.accountId)?l:p)?r:d.exchangeAccountId)?s:null==(i=c[0])?void 0:i.id)?a:"";Q(h),(null==t?void 0:t.timeframe)&&x.includes(t.timeframe)?X(t.timeframe):d.timeframe&&x.includes(d.timeframe)&&X(d.timeframe),"isolated"===d.marginMode||"cross"===d.marginMode?eo(d.marginMode):eo("isolated"),(null==t?void 0:t.symbol)?G(t.symbol.trim().toUpperCase()):d.symbol&&G(d.symbol)}catch(e){eR(b(e))}finally{eE(!1)}}async function ts(e,t){if(e){eR(null),eB(null);try{var i,n,l,r,s,a;let o=await (0,u.Vg)("/api/symbols?exchangeAccountId=".concat(encodeURIComponent(e))),d=null!=(n=o.items)?n:[];H(d);let c=(null!=t?t:Y).trim().toUpperCase(),p=null!=(r=null!=(l=o.defaultSymbol)?l:null==(i=d[0])?void 0:i.symbol)?r:"BTCUSDT",h=d.some(e=>e.symbol===c)?c:p;G(h);let[m,g,v]=await Promise.allSettled([(0,u.Vg)("/api/account/summary?exchangeAccountId=".concat(encodeURIComponent(e))),(0,u.Vg)("/api/positions?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(h))),(0,u.Vg)("/api/orders/open?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(h)))]),x=[];"fulfilled"===m.status?K(m.value):x.push("account summary (".concat(b(m.reason),")")),"fulfilled"===g.status?ee(null!=(s=g.value.items)?s:[]):(ee([]),x.push("positions (".concat(b(g.reason),")"))),"fulfilled"===v.status?ei(null!=(a=v.value.items)?a:[]):(ei([]),x.push("open orders (".concat(b(v.reason),")"))),x.length>0?eB("Partial data unavailable: ".concat(x.join(", "))):eB(null),await tl({exchangeAccountId:e,symbol:h,timeframe:$}),eR(null)}catch(e){eR(b(e))}}}async function ta(e,t){var i,n;let[l,r,s]=await Promise.allSettled([(0,u.Vg)("/api/positions?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(t))),(0,u.Vg)("/api/orders/open?exchangeAccountId=".concat(encodeURIComponent(e),"&symbol=").concat(encodeURIComponent(t))),(0,u.Vg)("/api/account/summary?exchangeAccountId=".concat(encodeURIComponent(e)))]);"fulfilled"===l.status&&ee(null!=(i=l.value.items)?i:[]),"fulfilled"===r.status&&ei(null!=(n=r.value.items)?n:[]),"fulfilled"===s.status&&K(s.value)}async function to(){if(!q)return;let e=Number(eu);if(!Number.isFinite(e)||e<1||e>125)return void eA("Leverage must be between 1 and 125.");eA(null),eV(!0);try{await (0,u.$P)("/api/account/leverage",{exchangeAccountId:q,symbol:Y,leverage:Math.trunc(e),marginMode:ea})}catch(e){eA(b(e))}finally{eV(!1)}}async function td(e){var t,i,n;if(!q)return;let l=Number(eh),r=Number(ew),s=Number(eu),a=Number(ez),o=Number(eI);if(!Number.isFinite(l)||l<=0)return void eA("Quantity must be greater than 0.");if(!e9||!Number.isFinite(e9)||e9<=0)return void eA("Unable to derive order quantity for selected unit.");let d=null!=(t=null==eZ?void 0:eZ.stepSize)?t:null,c=null!=(i=null==eZ?void 0:eZ.minQty)?i:null,p=null!=(n=null==eZ?void 0:eZ.maxQty)?n:null,h=e9;if(null!==d&&Number.isFinite(d)&&d>0&&(h=Math.floor(h/d)*d),null!==c&&Number.isFinite(c)&&c>0&&h<c)return void eA("Quantity is below minimum (".concat(c,")."));if(null!==p&&Number.isFinite(p)&&p>0&&h>p&&(h=p),"limit"===er&&(!Number.isFinite(r)||r<=0))return void eA("Limit orders require a valid price.");if(!Number.isFinite(s)||s<1||s>125)return void eA("Leverage must be between 1 and 125.");if(eN&&ez.trim().length>0&&(!Number.isFinite(a)||a<=0))return void eA("Take profit must be greater than 0.");if(eN&&eI.trim().length>0&&(!Number.isFinite(o)||o<=0))return void eA("Stop loss must be greater than 0.");eA(null),eF(!0);try{await (0,u.$P)("/api/orders",{exchangeAccountId:q,symbol:Y,type:er,side:e,qty:h,price:"limit"===er?r:void 0,takeProfitPrice:eN&&ez.trim().length>0?a:void 0,stopLossPrice:eN&&eI.trim().length>0?o:void 0,leverage:Math.trunc(s),marginMode:ea,reduceOnly:"close"===ed}),await ta(q,Y),"limit"===er&&e_("")}catch(e){eA(b(e))}finally{eF(!1)}}async function tc(e){if(q){eA(null);try{await (0,u.$P)("/api/positions/close",{exchangeAccountId:q,symbol:Y,side:e}),await ta(q,Y)}catch(e){eA(b(e))}}}async function tu(e){if(q){eA(null);try{await (0,u.$P)("/api/orders/cancel",{exchangeAccountId:q,orderId:e,symbol:Y}),await ta(q,Y)}catch(e){eA(b(e))}}}async function tp(){if(q){eA(null);try{await (0,u.$P)("/api/orders/cancel-all?exchangeAccountId=".concat(encodeURIComponent(q),"&symbol=").concat(encodeURIComponent(Y)),{}),await ta(q,Y)}catch(e){eA(b(e))}}}return(0,d.useEffect)(()=>{let e=!1;return async function(){var t;let i=null,n=U.get("prefill"),l=U.get("predictionId");if(n){if("1"===n){let e=sessionStorage.getItem(p.xf);if(sessionStorage.removeItem(p.xf),e)try{i=(0,p.jH)(JSON.parse(e))}catch(e){i=null}}else i=(0,p.jH)(function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/"),i=t.padEnd(4*Math.ceil(t.length/4),"="),n=atob(i);return JSON.parse(n)}catch(e){return null}}(n));i||eB("Invalid prefill payload.")}else if(l)try{let e=await (0,u.Vg)("/api/predictions/".concat(encodeURIComponent(l)));if(e.accountId){let t=(0,p.i4)(e);i=t.payload,t.info&&eQ(t.info)}else eB("Prediction has no exchange account mapping for prefill.")}catch(e){eB("Unable to load prediction prefill (".concat(b(e),")."))}e||(i&&function(e){var t,i,n;if(eH(e),ec("open"),eG(!window.matchMedia("(max-width: 700px)").matches),e.timeframe&&x.includes(e.timeframe)&&X(e.timeframe),e.symbol&&G(e.symbol.trim().toUpperCase()),((null==(t=e.suggestedEntry)?void 0:t.type)==="market"||(null==(i=e.suggestedEntry)?void 0:i.type)==="limit")&&es(e.suggestedEntry.type),(null==(n=e.suggestedEntry)?void 0:n.type)==="limit"&&e.suggestedEntry.price&&e_(String(e.suggestedEntry.price)),e.leverage&&Number.isFinite(e.leverage)&&e.leverage>=1&&e.leverage<=125&&ep(String(e.leverage)),(e.suggestedTakeProfit||e.suggestedStopLoss)&&(eC(!0),eO(e.suggestedTakeProfit?String(e.suggestedTakeProfit):""),ek(e.suggestedStopLoss?String(e.suggestedStopLoss):"")),e.positionSizeHint&&("percent_balance"===e.positionSizeHint.mode?(ef("cost"),ey("cost"),tn(e.positionSizeHint.value)):(ef("cost"),ey("cost"),em(String(e.positionSizeHint.value)),ev(0))),"spot"===e.marketType&&"down"===e.signal)return eQ("Spot short is not supported. Side prefill was skipped.");eQ(null)}(i),await tr(null!=(t=null==i?void 0:i.accountId)?t:null,i))}(),()=>{e=!0,e$.current&&e$.current.close(),eX.current&&eX.current.close(),eJ.current&&window.clearInterval(eJ.current)}},[]),(0,d.useEffect)(()=>{var e;q&&ts(q,null!=(e=null==eW?void 0:eW.symbol)?e:void 0)},[q,null==eW?void 0:eW.symbol]),(0,d.useEffect)(()=>{(null==eW?void 0:eW.positionSizeHint)&&"percent_balance"===eW.positionSizeHint.mode&&tt&&!(tt<=0)&&tn(eW.positionSizeHint.value)},[null==eW?void 0:eW.predictionId,tt]),(0,d.useEffect)(()=>{if(!q||!Y)return;e$.current&&(e$.current.close(),e$.current=null);let e=new WebSocket("".concat(F,"/ws/market?exchangeAccountId=").concat(encodeURIComponent(q),"&symbol=").concat(encodeURIComponent(Y)));return e$.current=e,e.onmessage=e=>{let t=null;try{t=JSON.parse(e.data)}catch(e){return}if(t&&(t.type.includes("ticker")&&t.data&&el(t.data),"error"===t.type)){var i;eR(null!=(i=t.message)?i:"Market websocket error")}},e.onerror=()=>{eR("Market stream disconnected.")},()=>{e.close(),e$.current===e&&(e$.current=null)}},[q,Y,F]),(0,d.useEffect)(()=>{if(!q)return;eX.current&&(eX.current.close(),eX.current=null);let e=new WebSocket("".concat(F,"/ws/user?exchangeAccountId=").concat(encodeURIComponent(q)));return eX.current=e,e.onmessage=e=>{let t=null;try{t=JSON.parse(e.data)}catch(e){return}if(t){if("account"===t.type&&t.data){let e=t.data;K(t=>t?{...t,equity:e.equity,availableMargin:e.availableMargin,updatedAt:new Date().toISOString()}:t),Array.isArray(e.positions)&&ee(e.positions),Array.isArray(e.openOrders)&&ei(e.openOrders)}("order"===t.type||"position"===t.type||"fill"===t.type)&&ta(q,Y).catch(()=>{})}},e.onerror=()=>{eR("User stream disconnected.")},()=>{e.close(),eX.current===e&&(eX.current=null)}},[q,Y,F]),(0,d.useEffect)(()=>{if(q&&Y)return eJ.current&&(window.clearInterval(eJ.current),eJ.current=null),eJ.current=window.setInterval(()=>{ta(q,Y).catch(()=>{})},8e3),()=>{eJ.current&&(window.clearInterval(eJ.current),eJ.current=null)}},[q,Y]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"dashboardHeader",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{margin:0},children:"Manual Trading Desk"}),(0,s.jsx)("div",{style:{fontSize:13,color:"var(--muted)"},children:"TradingView + futures order controls."})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)(o(),{href:"/dashboard",className:"btn",children:"Dashboard"}),(0,s.jsx)(o(),{href:q?"/bots?exchangeAccountId=".concat(encodeURIComponent(q)):"/bots",className:"btn",children:"Bots"})]})]}),eM?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#ef4444",marginBottom:12},children:[(0,s.jsx)("strong",{children:"Error:"})," ",eM,(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)("button",{className:"btn",onClick:()=>{q&&ts(q,Y)},children:"Retry"})})]}):null,eL?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#ef4444",marginBottom:12},children:[(0,s.jsx)("strong",{children:"Action failed:"})," ",eL]}):null,eT?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#f59e0b",marginBottom:12},children:[(0,s.jsx)("strong",{children:"Warning:"})," ",eT]}):null,eW?(0,s.jsxs)("div",{className:"card",style:{padding:12,borderColor:"#3b82f6",marginBottom:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:8,flexWrap:"wrap",alignItems:"center"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Prediction Context"}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:4},children:[eW.symbol," \xb7 ",eW.marketType," \xb7 ",eW.timeframe," \xb7 ",function(e){if(!Number.isFinite(e))return"-";let t=Math.max(0,Math.min(100,e<=1?100*e:e));return"".concat(t.toFixed(1),"%")}(eW.confidence)," \xb7"," ",new Date(eW.tsCreated).toLocaleString()]}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:2},children:["Signal: ",eW.signal," \xb7 Side: ",null!=(B=eW.side)?B:"manual","number"==typeof eW.expectedMovePct?" \xb7 Move: ".concat(eW.expectedMovePct.toFixed(2),"%"):""]}),eW.leverage?(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginTop:2},children:["Prefill leverage: ",eW.leverage,"x"]}):null]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("button",{className:"btn",type:"button",onClick:()=>eG(e=>!e),children:eY?"Hide context":"Show context"}),(0,s.jsx)(o(),{href:"/predictions",className:"btn",children:"Back to Prediction"}),(0,s.jsx)("button",{className:"btn",onClick:function(){eH(null),es("limit"),eo("isolated"),ec("open"),ep("10"),ef("quantity"),ey("quantity"),em("0.001"),ev(0),e_(""),eC(!1),eO(""),ek(""),eQ(null);let e=new URLSearchParams(U.toString());e.delete("prefill"),e.delete("predictionId"),!e.get("exchangeAccountId")&&q&&e.set("exchangeAccountId",q);let t=e.toString()?"/trade?".concat(e.toString()):"/trade";A.replace(t)},type:"button",children:"Clear Prefill"})]})]}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:12,color:"var(--muted)"},children:["Prediction ID: ",eW.predictionId]}),eq?(0,s.jsx)("div",{style:{marginTop:8,fontSize:12,color:"#f59e0b"},children:eq}):null,eY?(0,s.jsxs)("div",{style:{marginTop:10,display:"grid",gap:10},children:[(null==(e=eW.tags)?void 0:e.length)?(0,s.jsx)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:eW.tags.map(e=>(0,s.jsx)("span",{className:"badge",children:e},e))}):null,eW.explanation?(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{style:{cursor:"pointer",fontSize:12},children:"AI explanation"}),(0,s.jsx)("div",{style:{marginTop:6,fontSize:12},children:eW.explanation})]}):null,(0,s.jsxs)("div",{style:{display:"grid",gap:8,gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))"},children:[(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"RSI (14)"}),(0,s.jsx)("div",{style:{fontWeight:700},children:j(null==(t=eW.indicators)?void 0:t.rsi_14,1)})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"MACD hist"}),(0,s.jsx)("div",{style:{fontWeight:700},children:j(null==(n=eW.indicators)||null==(i=n.macd)?void 0:i.hist,4)}),(0,s.jsxs)("div",{style:{fontSize:11,color:"var(--muted)",marginTop:2},children:["line ",j(null==(r=eW.indicators)||null==(l=r.macd)?void 0:l.line,4)," / signal ",j(null==(h=eW.indicators)||null==(a=h.macd)?void 0:a.signal,4)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"BB width% / pos"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[j(null==(S=eW.indicators)||null==(g=S.bb)?void 0:g.width_pct,2)," / ",j(null==(_=eW.indicators)||null==(w=_.bb)?void 0:w.pos,3)]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"VWAP dist%"}),(0,s.jsx)("div",{style:{fontWeight:700},children:j(null==(C=eW.indicators)||null==(N=C.vwap)?void 0:N.dist_pct,2)}),(0,s.jsxs)("div",{style:{fontSize:11,color:"var(--muted)",marginTop:2},children:["mode ",null!=(L=null==(O=eW.indicators)||null==(z=O.vwap)?void 0:z.mode)?L:"n/a"]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:"ADX / +DI / -DI"}),(0,s.jsxs)("div",{style:{fontWeight:700},children:[j(null==(k=eW.indicators)||null==(I=k.adx)?void 0:I.adx_14,1)," / ",j(null==(E=eW.indicators)||null==(P=E.adx)?void 0:P.plus_di_14,1)," / ",j(null==(R=eW.indicators)||null==(M=R.adx)?void 0:M.minus_di_14,1)]})]})]}),(0,s.jsxs)("div",{className:"card",style:{margin:0,padding:8},children:[(0,s.jsx)("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:4},children:"Key drivers"}),(null==(T=eW.keyDrivers)?void 0:T.length)?(0,s.jsx)("ul",{style:{margin:0,paddingLeft:18,fontSize:12},children:eW.keyDrivers.slice(0,5).map(e=>(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:e.name}),": ",String(e.value)]},e.name))}):(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"n/a"})]})]}):null]}):null,eP?(0,s.jsx)("div",{className:"card",style:{padding:16},children:"Loading trading deskâ€¦"}):0===D.length?(0,s.jsxs)("div",{className:"card",style:{padding:16},children:[(0,s.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"No exchange accounts available"}),(0,s.jsx)("div",{style:{color:"var(--muted)",marginBottom:12},children:"Add a Bitget account first to use manual trading."}),(0,s.jsx)(o(),{href:"/settings",className:"btn btnPrimary",children:"Add Exchange Account"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("section",{className:"card",style:{padding:12,marginBottom:12},children:(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:10},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Exchange account"}),(0,s.jsx)("select",{className:"input",value:q,onChange:e=>{let t=e.target.value;Q(t),tl({exchangeAccountId:t})},children:D.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.exchange.toUpperCase()," - ",e.label]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Symbol"}),(0,s.jsx)("select",{className:"input",value:Y,onChange:e=>{let t=e.target.value;G(t),ta(q,t),tl({symbol:t})},children:W.map(e=>(0,s.jsxs)("option",{value:e.symbol,children:[e.symbol," ",e.tradable?"":"(restricted)"]},e.symbol))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Timeframe"}),(0,s.jsx)("select",{className:"input",value:$,onChange:e=>{let t=e.target.value;X(t),tl({timeframe:t})},children:x.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:4},children:"Account"}),(0,s.jsxs)("div",{className:"card",style:{padding:10,minHeight:44},children:["Eq: ",y(null==J?void 0:J.equity)," | Avail: ",y(null==J?void 0:J.availableMargin)]})]})]})}),(0,s.jsxs)("section",{className:"tradeDeskGrid",children:[(0,s.jsxs)("article",{className:"card",style:{padding:10,minHeight:620},children:[(0,s.jsxs)("div",{style:{marginBottom:8,fontWeight:700},children:[Y," ",(null==eZ?void 0:eZ.status)?"- ".concat(eZ.status):""]}),(0,s.jsx)(m,{exchangeAccountId:q,symbol:Y,timeframe:$,prefill:eW})]}),(0,s.jsxs)("article",{className:"card",style:{padding:10,minHeight:620},children:[(0,s.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Order Entry"}),(0,s.jsxs)("div",{className:"tradeOrderPanel",children:[(0,s.jsxs)("div",{className:"tradeOrderTopRow",children:[(0,s.jsxs)("div",{className:"tradeOrderModeSwitch",children:[(0,s.jsx)("button",{className:"tradeOrderModeBtn ".concat("isolated"===ea?"tradeOrderModeBtnActive":""),onClick:()=>{eo("isolated"),tl({marginMode:"isolated"})},type:"button",children:"Isolated"}),(0,s.jsx)("button",{className:"tradeOrderModeBtn ".concat("cross"===ea?"tradeOrderModeBtnActive":""),onClick:()=>{eo("cross"),tl({marginMode:"cross"})},type:"button",children:"Cross"})]}),(0,s.jsxs)("div",{className:"tradeOrderLeverageGroup",children:[(0,s.jsx)("input",{className:"tradeOrderLeverageInput",type:"number",min:1,max:125,step:1,value:eu,onChange:e=>ep(e.target.value)}),(0,s.jsx)("button",{className:"tradeOrderApplyBtn",disabled:eD,onClick:()=>void to(),type:"button",children:eD?"...":"Apply"})]})]}),(0,s.jsxs)("div",{className:"tradeOrderEntryMode",children:[(0,s.jsx)("button",{className:"tradeOrderEntryModeBtn ".concat("open"===ed?"tradeOrderEntryModeBtnActive":""),onClick:()=>ec("open"),type:"button",children:"Open"}),(0,s.jsx)("button",{className:"tradeOrderEntryModeBtn ".concat("close"===ed?"tradeOrderEntryModeBtnActive":""),onClick:()=>ec("close"),type:"button",children:"Close"})]}),(0,s.jsxs)("div",{className:"tradeOrderTypeTabs",children:[(0,s.jsx)("button",{className:"tradeOrderTypeTab ".concat("limit"===er?"tradeOrderTypeTabActive":""),onClick:()=>es("limit"),type:"button",children:"Limit"}),(0,s.jsx)("button",{className:"tradeOrderTypeTab ".concat("market"===er?"tradeOrderTypeTabActive":""),onClick:()=>es("market"),type:"button",children:"Market"}),(0,s.jsx)("button",{className:"tradeOrderTypeTab tradeOrderTypeTabMuted",type:"button",disabled:!0,children:"Post only"})]}),(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Available"}),(0,s.jsxs)("strong",{children:[y(null==J?void 0:J.availableMargin,3)," USDT"]})]}),"limit"===er?(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:"Price"}),(0,s.jsxs)("div",{className:"tradeOrderInputRow",children:[(0,s.jsx)("input",{className:"tradeOrderInput",value:ew,onChange:e=>e_(e.target.value),placeholder:(null==en?void 0:en.last)?String(en.last):"0.0"}),(0,s.jsx)("button",{className:"tradeOrderMiniBtn",type:"button",onClick:()=>{var e;let t=null!=(e=null==en?void 0:en.last)?e:null==en?void 0:en.mark;t&&Number.isFinite(t)&&e_(String(t))},children:"BBO"})]})]}):null,(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:e5.title}),(0,s.jsxs)("div",{className:"tradeOrderInputRow",children:[(0,s.jsx)("input",{className:"tradeOrderInput",value:eh,onChange:e=>em(e.target.value),placeholder:"quantity"===ex?"0.001":"10"}),(0,s.jsx)("button",{type:"button",className:"tradeOrderUnitBadge",onClick:()=>{ey(ex),eS(!0)},children:e6})]})]}),(0,s.jsx)("input",{className:"tradeOrderSlider",type:"range",min:0,max:100,step:25,value:eg,onChange:e=>tn(Number(e.target.value))}),(0,s.jsxs)("div",{className:"tradeOrderDualStats",children:[(0,s.jsxs)("div",{className:"tradeOrderDualRow",children:[(0,s.jsx)("span",{children:"Position size"}),(0,s.jsxs)("strong",{children:[(0,s.jsx)("span",{className:"tradeOrderValueLong",children:y(e9,4)}),(0,s.jsx)("span",{className:"tradeOrderValueSlash",children:" / "}),(0,s.jsx)("span",{className:"tradeOrderValueShort",children:y(e9,4)}),(0,s.jsxs)("span",{className:"tradeOrderValueUnit",children:[" ",e8]})]})]}),(0,s.jsxs)("div",{className:"tradeOrderDualRow",children:[(0,s.jsx)("span",{children:"Cost"}),(0,s.jsxs)("strong",{children:[(0,s.jsx)("span",{className:"tradeOrderValueLong",children:y(te,4)}),(0,s.jsx)("span",{className:"tradeOrderValueSlash",children:" / "}),(0,s.jsx)("span",{className:"tradeOrderValueShort",children:y(te,4)}),(0,s.jsx)("span",{className:"tradeOrderValueUnit",children:" USDT"})]})]}),(0,s.jsxs)("div",{className:"tradeOrderDualRow",children:[(0,s.jsx)("span",{children:"Est. liq. price"}),(0,s.jsxs)("strong",{children:[(0,s.jsx)("span",{className:"tradeOrderValueLong",children:y(ti.long,1)}),(0,s.jsx)("span",{className:"tradeOrderValueSlash",children:" / "}),(0,s.jsx)("span",{className:"tradeOrderValueShort",children:y(ti.short,1)})]})]})]}),(0,s.jsxs)("label",{className:"tradeOrderCheckRow",children:[(0,s.jsx)("input",{type:"checkbox",checked:eN,onChange:e=>eC(e.target.checked)}),(0,s.jsx)("span",{children:"TP/SL"})]}),eN?(0,s.jsxs)("div",{className:"tradeOrderTpSlGrid",children:[(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:"Take Profit"}),(0,s.jsx)("input",{className:"tradeOrderInput",value:ez,onChange:e=>eO(e.target.value),placeholder:"optional"})]}),(0,s.jsxs)("label",{className:"tradeOrderField",children:[(0,s.jsx)("span",{children:"Stop Loss"}),(0,s.jsx)("input",{className:"tradeOrderInput",value:eI,onChange:e=>ek(e.target.value),placeholder:"optional"})]})]}):null,(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Time in force"}),(0,s.jsx)("strong",{children:"limit"===er?"GTC":"IOC"})]}),eW?(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Prefilled side"}),(0,s.jsx)("strong",{children:eW.side?eW.side.toUpperCase():"Manual selection required"})]}):null,(0,s.jsxs)("div",{className:"tradeOrderActionGrid",children:[(0,s.jsxs)("button",{className:"btn btnStart",style:(null==eW?void 0:eW.side)==="long"?{boxShadow:"0 0 0 2px rgba(16,185,129,.45) inset"}:void 0,disabled:eU,onClick:()=>void td("long"),type:"button",children:["open"===ed?"Open Long":"Close Short",(null==eW?void 0:eW.side)==="long"?" (Suggested)":""]}),(0,s.jsxs)("button",{className:"btn btnStop",style:(null==eW?void 0:eW.side)==="short"?{boxShadow:"0 0 0 2px rgba(239,68,68,.45) inset"}:void 0,disabled:eU||e0,onClick:()=>void td("short"),type:"button",children:["open"===ed?"Open Short":"Close Long",(null==eW?void 0:eW.side)==="short"?" (Suggested)":""]})]}),(0,s.jsxs)("div",{className:"tradeOrderMetaRow",children:[(0,s.jsx)("span",{children:"Max"}),(0,s.jsx)("strong",{children:tt?"".concat(y(tt,4)," ").concat(e6):"-"})]}),(0,s.jsxs)("button",{className:"btn",onClick:()=>void tp(),type:"button",children:["Cancel All (",Y,")"]}),(0,s.jsx)("div",{className:"tradeOrderDivider"}),(0,s.jsx)("div",{className:"tradeOrderInfoTitle",children:"Account"}),(0,s.jsxs)("div",{className:"tradeOrderInfoGrid",children:[(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Margin"}),(0,s.jsx)("strong",{children:y(null==J?void 0:J.availableMargin,3)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Equity"}),(0,s.jsx)("strong",{children:y(null==J?void 0:J.equity,3)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Last"}),(0,s.jsx)("strong",{children:y(null==en?void 0:en.last,4)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Mark"}),(0,s.jsx)("strong",{children:y(null==en?void 0:en.mark,4)})]}),(0,s.jsxs)("div",{className:"tradeOrderInfoRow",children:[(0,s.jsx)("span",{children:"Bid / Ask"}),(0,s.jsxs)("strong",{children:[y(null==en?void 0:en.bid,4)," / ",y(null==en?void 0:en.ask,4)]})]})]}),(0,s.jsx)("div",{className:"tradeOrderSelectedAccount",children:eK?"".concat(eK.exchange.toUpperCase()," - ").concat(eK.label):"-"})]})]})]}),(0,s.jsxs)("section",{className:"card",style:{padding:12,marginTop:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,flexWrap:"wrap",gap:8},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:"Positions"}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["Symbol filter: ",Y]})]}),(0,s.jsx)("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{textAlign:"left",color:"var(--muted)"},children:[(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Side"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Size"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Entry"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Mark"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"PnL"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Action"})]})}),(0,s.jsx)("tbody",{children:0===Z.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,style:{padding:10,color:"var(--muted)"},children:"No open positions."})}):Z.map((e,t)=>{var i;return(0,s.jsxs)("tr",{style:{borderTop:"1px solid rgba(255,255,255,.06)"},children:[(0,s.jsx)("td",{style:{padding:"8px 6px",color:"long"===e.side?"#34d399":"#f87171"},children:e.side.toUpperCase()}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:y(e.size,6)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:y(e.entryPrice,4)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:y(e.markPrice,4)}),(0,s.jsx)("td",{style:{padding:"8px 6px",color:(null!=(i=e.unrealizedPnl)?i:0)>=0?"#34d399":"#f87171"},children:y(e.unrealizedPnl,2)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:(0,s.jsx)("button",{className:"btn",onClick:()=>void tc(e.side),children:"Close"})})]},"".concat(e.side,"_").concat(t))})})]})})]}),(0,s.jsxs)("section",{className:"card",style:{padding:12,marginTop:12},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10,flexWrap:"wrap",gap:8},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:"Open Orders"}),(0,s.jsx)("button",{className:"btn",onClick:()=>void tp(),children:"Cancel All"})]}),(0,s.jsx)("div",{style:{overflowX:"auto"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{textAlign:"left",color:"var(--muted)"},children:[(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Order ID"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Side"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Type"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Price"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Qty"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Status"}),(0,s.jsx)("th",{style:{padding:"8px 6px"},children:"Action"})]})}),(0,s.jsx)("tbody",{children:0===et.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,style:{padding:10,color:"var(--muted)"},children:"No open orders."})}):et.map(e=>{var t,i,n;return(0,s.jsxs)("tr",{style:{borderTop:"1px solid rgba(255,255,255,.06)"},children:[(0,s.jsxs)("td",{style:{padding:"8px 6px"},children:[e.orderId.slice(0,12),"..."]}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:null!=(t=e.side)?t:"-"}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:null!=(i=e.type)?i:"-"}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:y(e.price,4)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:y(e.qty,6)}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:null!=(n=e.status)?n:"-"}),(0,s.jsx)("td",{style:{padding:"8px 6px"},children:(0,s.jsx)("button",{className:"btn",onClick:()=>void tu(e.orderId),children:"Cancel"})})]},e.orderId)})})]})})]})]}),ej?(0,s.jsx)("div",{className:"tradeModalBackdrop",onClick:()=>eS(!1),children:(0,s.jsxs)("div",{className:"tradeModalCard",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"tradeModalHeader",children:[(0,s.jsx)("h3",{children:"Futures unit setting"}),(0,s.jsx)("button",{type:"button",className:"tradeModalCloseBtn",onClick:()=>eS(!1),"aria-label":"Close",children:"\xd7"})]}),(0,s.jsx)("div",{className:"tradeModalOptions",children:f.map(e=>{let t="BASE"===e.unit?e8:e.unit,i=eb===e.value;return(0,s.jsxs)("button",{type:"button",className:"tradeModalOption ".concat(i?"tradeModalOptionActive":""),onClick:()=>ey(e.value),children:[(0,s.jsxs)("div",{className:"tradeModalOptionTitle",children:[e.title,"-",t]}),(0,s.jsx)("div",{className:"tradeModalOptionDescription",children:e.description})]},e.value)})}),(0,s.jsxs)("div",{className:"tradeModalActions",children:[(0,s.jsx)("button",{type:"button",className:"tradeModalSecondaryBtn",onClick:()=>eS(!1),children:"Cancel"}),(0,s.jsx)("button",{type:"button",className:"tradeModalPrimaryBtn",onClick:()=>{ef(eb),ev(0),em(""),eS(!1)},children:"Confirm"})]})]})}):null]})}function w(){return(0,s.jsx)(d.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading trade pageâ€¦"}),children:(0,s.jsx)(S,{})})}},5606:(e,t,i)=>{i.d(t,{i4:()=>u,jH:()=>p,xf:()=>l});var n=i(3916);let l="tradeDeskPrefill",r=n.Ik({type:n.k5(["market","limit"]),price:n.ai().positive().optional()}),s=n.Ik({mode:n.k5(["percent_balance","fixed_quote"]),value:n.ai().positive()}),a=n.Ik({name:n.Yj().min(1),value:n.L5()}),o=n.Ik({rsi_14:n.ai().nullable().optional(),macd:n.Ik({line:n.ai().nullable().optional(),signal:n.ai().nullable().optional(),hist:n.ai().nullable().optional()}).nullable().optional(),bb:n.Ik({upper:n.ai().nullable().optional(),mid:n.ai().nullable().optional(),lower:n.ai().nullable().optional(),width_pct:n.ai().nullable().optional(),pos:n.ai().nullable().optional()}).nullable().optional(),vwap:n.Ik({value:n.ai().nullable().optional(),dist_pct:n.ai().nullable().optional(),mode:n.Yj().optional(),sessionStartUtcMs:n.ai().nullable().optional()}).nullable().optional(),adx:n.Ik({adx_14:n.ai().nullable().optional(),plus_di_14:n.ai().nullable().optional(),minus_di_14:n.ai().nullable().optional()}).nullable().optional()}).optional(),d=n.Ik({exchange:n.Yj().trim().min(1),accountId:n.Yj().trim().min(1),symbol:n.Yj().trim().min(1),marketType:n.k5(["spot","perp"]),timeframe:n.k5(["5m","15m","1h","4h","1d"]),predictionId:n.Yj().trim().min(1),tsCreated:n.Yj().datetime(),signal:n.k5(["up","down","neutral"]),confidence:n.ai().min(0).max(100),expectedMovePct:n.ai().optional(),leverage:n.ai().int().min(1).max(125).optional(),side:n.k5(["long","short"]).optional(),suggestedEntry:r.optional(),suggestedStopLoss:n.ai().positive().optional(),suggestedTakeProfit:n.ai().positive().optional(),positionSizeHint:s.optional(),tags:n.YO(n.Yj()).max(5).optional(),explanation:n.Yj().max(400).optional(),keyDrivers:n.YO(a).max(5).optional(),indicators:o});function c(e,t){let i=Number(e);if(Number.isFinite(i))return Number(i.toFixed(t))}function u(e){var t,i,n,l,r,s,a,o,u,p,h,m,g;let v=(m=e.signal,g=e.marketType,"up"===m?{side:"long"}:"down"===m?"spot"===g?{info:"Spot short not supported. Please choose a valid spot action manually."}:{side:"short"}:{}),x={exchange:e.exchange,accountId:e.accountId,symbol:e.symbol,marketType:e.marketType,timeframe:e.timeframe,predictionId:e.predictionId,tsCreated:e.tsCreated,signal:e.signal,confidence:Number.isFinite(h=e.confidence)?Math.max(0,Math.min(100,h<=1?100*h:h)):0,expectedMovePct:"number"==typeof e.expectedMovePct&&Number.isFinite(e.expectedMovePct)?Number(e.expectedMovePct.toFixed(2)):void 0,leverage:null!=(n=e.leverage)?n:void 0,side:v.side,suggestedEntry:null!=(l=e.suggestedEntry)?l:void 0,suggestedStopLoss:null!=(r=e.suggestedStopLoss)?r:void 0,suggestedTakeProfit:null!=(s=e.suggestedTakeProfit)?s:void 0,positionSizeHint:null!=(a=e.positionSizeHint)?a:void 0,tags:null!=(o=null==(t=e.tags)?void 0:t.slice(0,5))?o:void 0,explanation:null!=(u=e.explanation)?u:void 0,keyDrivers:null!=(p=null==(i=e.keyDrivers)?void 0:i.slice(0,5))?p:void 0,indicators:function(e){if(e)return{rsi_14:c(e.rsi_14,1),macd:e.macd?{line:c(e.macd.line,4),signal:c(e.macd.signal,4),hist:c(e.macd.hist,4)}:void 0,bb:e.bb?{upper:c(e.bb.upper,4),mid:c(e.bb.mid,4),lower:c(e.bb.lower,4),width_pct:c(e.bb.width_pct,2),pos:c(e.bb.pos,3)}:void 0,vwap:e.vwap?{value:c(e.vwap.value,4),dist_pct:c(e.vwap.dist_pct,2),mode:e.vwap.mode,sessionStartUtcMs:"number"==typeof e.vwap.sessionStartUtcMs&&Number.isFinite(e.vwap.sessionStartUtcMs)?e.vwap.sessionStartUtcMs:void 0}:void 0,adx:e.adx?{adx_14:c(e.adx.adx_14,1),plus_di_14:c(e.adx.plus_di_14,1),minus_di_14:c(e.adx.minus_di_14,1)}:void 0}}(e.indicators)};return{payload:d.parse(x),info:v.info}}function p(e){let t=d.safeParse(e);return t.success?t.data:null}}}]);