(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[793],{2839:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var n=s(4568),a=s(9664),i=s.n(a),l=s(7620),r=s(2883);function o(){let[e,t]=(0,l.useState)(""),[s,a]=(0,l.useState)(""),[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[m,g]=(0,l.useState)(""),[y,f]=(0,l.useState)(""),[x,v]=(0,l.useState)(""),[j,b]=(0,l.useState)(""),[S,w]=(0,l.useState)(""),[N,C]=(0,l.useState)(""),[P,E]=(0,l.useState)(""),[k,T]=(0,l.useState)(null),[L,_]=(0,l.useState)(!0),[z,I]=(0,l.useState)(!1),[R,A]=(0,l.useState)(null),[B,U]=(0,l.useState)(!0),[O,M]=(0,l.useState)(60),[W,D]=(0,l.useState)(!0),[H,$]=(0,l.useState)(!1);function q(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):(null==e?void 0:e.message)?String(e.message):String(e)}async function G(){_(!0),A(null);try{var e;let[t,s]=await Promise.all([(0,r.Vg)("/settings/security"),(0,r.Vg)("/auth/me")]);U(!!t.autoLogoutEnabled),M(Number(t.autoLogoutMinutes)||60),D(!1!==t.reauthOtpEnabled),$(!!t.isSuperadmin);let n="string"==typeof(null==s?void 0:s.email)?s.email:"string"==typeof(null==s||null==(e=s.user)?void 0:e.email)?s.user.email:"";n&&f(n)}catch(e){A(q(e))}finally{_(!1)}}async function V(){I(!0),A(null);let e=Math.max(1,Math.min(1440,Math.floor(O)));try{let t={autoLogoutEnabled:B,autoLogoutMinutes:e};H&&(t.reauthOtpEnabled=W);let s=await (0,r.mu)("/settings/security",t);U(!!s.autoLogoutEnabled),M(Number(s.autoLogoutMinutes)||e),D(!1!==s.reauthOtpEnabled),$(!!s.isSuperadmin),A("Saved.")}catch(e){A(q(e))}finally{I(!1)}}async function F(){if(p("saving..."),g(""),o!==d){p(""),g("Passwords do not match.");return}try{await (0,r.$P)("/auth/change-password",{currentPassword:s,newPassword:o}),p("updated"),a(""),c(""),u(""),setTimeout(()=>p(""),1200)}catch(e){p(""),g(q(e))}}async function X(){C("sending code..."),E(""),T(null);try{let e=await (0,r.$P)("/auth/password-reset/request",{email:y});C("If the account exists, a reset code was sent".concat((null==e?void 0:e.expiresInMinutes)?" (valid ".concat(e.expiresInMinutes," min)"):"",".")),(null==e?void 0:e.devCode)&&T(e.devCode)}catch(e){C(""),E(q(e))}}async function J(){if(C("updating password..."),E(""),j!==S){C(""),E("New password and confirmation do not match.");return}try{await (0,r.$P)("/auth/password-reset/confirm",{email:y,code:x,newPassword:j}),C("Password updated. Please sign in again if your session expires."),v(""),b(""),w(""),a(""),c(""),u("")}catch(e){C(""),E(q(e))}}return(0,l.useEffect)(()=>{G()},[]),(0,n.jsxs)("div",{className:"settingsWrap",style:{maxWidth:760},children:[(0,n.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)(i(),{href:"/settings",className:"btn",children:"← Back to settings"}),(0,n.jsx)(i(),{href:"/",className:"btn",children:"← Back to dashboard"})]}),(0,n.jsx)("h2",{style:{marginTop:0},children:"My Account"}),(0,n.jsxs)("div",{className:"card settingsSection",style:{marginTop:14},children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("div",{style:{fontWeight:700},children:"Password"})}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:"Create a new password for your account. For security, your current password is required."}),(0,n.jsxs)("div",{style:{display:"grid",gap:10},children:[(0,n.jsxs)("label",{style:{fontSize:13},children:["Current password",(0,n.jsx)("input",{className:"input",type:"password",value:s,onChange:e=>a(e.target.value)})]}),(0,n.jsxs)("label",{style:{fontSize:13},children:["New password",(0,n.jsx)("input",{className:"input",type:"password",value:o,onChange:e=>c(e.target.value)})]}),(0,n.jsxs)("label",{style:{fontSize:13},children:["Confirm new password",(0,n.jsx)("input",{className:"input",type:"password",value:d,onChange:e=>u(e.target.value)})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("button",{className:"btn btnPrimary",onClick:F,disabled:!s||!o,children:"Create new password"}),(0,n.jsx)("span",{style:{fontSize:12,opacity:.7},children:h})]}),m?(0,n.jsx)("div",{style:{fontSize:12,color:"#ff6b6b"},children:m}):null]})]}),(0,n.jsxs)("div",{className:"card settingsSection",style:{marginTop:14},children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("div",{style:{fontWeight:700},children:"Security"})}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:"Session and re-authentication settings for your account."}),(0,n.jsxs)("div",{style:{display:"grid",gap:10,marginBottom:10,maxWidth:360},children:[(0,n.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("input",{type:"checkbox",checked:B,onChange:e=>U(e.target.checked),disabled:L||z}),(0,n.jsx)("span",{children:"Enable auto-logout"})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Idle minutes"}),(0,n.jsx)("input",{className:"input",type:"number",min:1,max:1440,value:Number.isFinite(O)?O:60,onChange:e=>M(Number(e.target.value)),disabled:!B||L||z})]}),H?(0,n.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("input",{type:"checkbox",checked:W,onChange:e=>D(e.target.checked),disabled:L||z}),(0,n.jsx)("span",{children:"Require OTP re-auth for sensitive actions"})]}):null]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)("button",{className:"btn btnPrimary",onClick:V,disabled:L||z,children:z?"Saving...":"Save settings"}),(0,n.jsx)("button",{className:"btn",onClick:G,disabled:L||z,children:L?"Loading...":"Reload"})]}),R?(0,n.jsx)("div",{style:{marginTop:10,color:"var(--muted)"},children:R}):null]}),(0,n.jsxs)("div",{className:"card settingsSection",style:{marginTop:14},children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("div",{style:{fontWeight:700},children:"Reset via Email Code"})}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:"Use this if you forgot your current password."}),(0,n.jsxs)("div",{style:{display:"grid",gap:10,maxWidth:420},children:[(0,n.jsxs)("label",{style:{fontSize:13},children:["Account email",(0,n.jsx)("input",{className:"input",type:"email",value:y,onChange:e=>f(e.target.value),placeholder:"you@example.com"})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{className:"btn",onClick:()=>void X(),disabled:!y,children:"Send reset code"})}),(0,n.jsxs)("label",{style:{fontSize:13},children:["Reset code (6 digits)",(0,n.jsx)("input",{className:"input",value:x,onChange:e=>v(e.target.value),maxLength:6,placeholder:"123456"})]}),(0,n.jsxs)("label",{style:{fontSize:13},children:["New password",(0,n.jsx)("input",{className:"input",type:"password",value:j,onChange:e=>b(e.target.value),minLength:8})]}),(0,n.jsxs)("label",{style:{fontSize:13},children:["Confirm new password",(0,n.jsx)("input",{className:"input",type:"password",value:S,onChange:e=>w(e.target.value),minLength:8})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{className:"btn btnPrimary",onClick:()=>void J(),disabled:!y||6!==x.length||j.length<8,children:"Reset password"})}),N?(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:N}):null,k?(0,n.jsxs)("div",{style:{fontSize:12,color:"#facc15"},children:["Dev reset code: ",(0,n.jsx)("b",{children:k})]}):null,P?(0,n.jsx)("div",{style:{fontSize:12,color:"#ff6b6b"},children:P}):null]})]}),e?(0,n.jsx)("div",{style:{fontSize:12,color:"#ff6b6b",marginTop:8},children:e}):null]})}},2883:(e,t,s)=>{"use strict";s.d(t,{$P:()=>h,Al:()=>m,GC:()=>g,Vg:()=>u,hD:()=>c,mu:()=>p});var n,a,i,l,r=s(7011);null!=(null!=(n=r.env.API_URL)?n:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let o=null!=(l=null!=(i=null!=(a=r.env.NEXT_PUBLIC_API_URL)?a:r.env.API_URL)?i:r.env.API_BASE_URL)?l:"http://localhost:4000";class c extends Error{constructor(e,t,s){super(e),this.status=t,this.payload=s}}async function d(e,t,s){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let a=await fetch("".concat(o).concat(t),{method:e,headers:n,body:s?JSON.stringify(s):void 0,credentials:"include",cache:"no-store"});if(!a.ok){let s=null;try{s=await a.json()}catch(e){}throw new c((null==s?void 0:s.error)||(null==s?void 0:s.message)||"".concat(e," ").concat(t," failed (").concat(a.status,")"),a.status,s)}return a.json()}function u(e){return d("GET",e)}function h(e,t){return d("POST",e,t)}function p(e,t){return d("PUT",e,t)}function m(e){return d("DELETE",e)}function g(e){return d("DELETE",e)}},6707:(e,t,s)=>{Promise.resolve().then(s.bind(s,2839))}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=6707)),_N_E=e.O()}]);