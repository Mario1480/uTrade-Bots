(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{2883:(e,t,s)=>{"use strict";s.d(t,{$P:()=>p,Al:()=>h,GC:()=>g,Vg:()=>d,hD:()=>o,mu:()=>m});var n,a,l,i,r=s(7011);null!=(null!=(n=r.env.API_URL)?n:r.env.API_BASE_URL)||r.env.NEXT_PUBLIC_API_URL;let c=null!=(i=null!=(l=null!=(a=r.env.NEXT_PUBLIC_API_URL)?a:r.env.API_URL)?l:r.env.API_BASE_URL)?i:"http://localhost:4000";class o extends Error{constructor(e,t,s){super(e),this.status=t,this.payload=s}}async function u(e,t,s){let n={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let t=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return t?decodeURIComponent(t[2]):null}("mm_csrf");e&&(n["x-csrf-token"]=e)}let a=await fetch("".concat(c).concat(t),{method:e,headers:n,body:s?JSON.stringify(s):void 0,credentials:"include",cache:"no-store"});if(!a.ok){let s=null;try{s=await a.json()}catch(e){}throw new o((null==s?void 0:s.error)||(null==s?void 0:s.message)||"".concat(e," ").concat(t," failed (").concat(a.status,")"),a.status,s)}return a.json()}function d(e){return u("GET",e)}function p(e,t){return u("POST",e,t)}function m(e,t){return u("PUT",e,t)}function h(e){return u("DELETE",e)}function g(e){return u("DELETE",e)}},5665:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var n=s(4568),a=s(9664),l=s.n(a),i=s(7620),r=s(2883);function c(e){return e instanceof r.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function o(){let[e,t]=(0,i.useState)(!0),[s,a]=(0,i.useState)(!1),[o,u]=(0,i.useState)(null),[d,p]=(0,i.useState)(null),[m,h]=(0,i.useState)(""),[g,y]=(0,i.useState)("465"),[f,v]=(0,i.useState)(""),[x,j]=(0,i.useState)(""),[S,P]=(0,i.useState)(!0),[b,N]=(0,i.useState)(""),[T,w]=(0,i.useState)(!1),[E,_]=(0,i.useState)("");async function C(){t(!0),u(null);try{var e,s,n,l;let t=await (0,r.Vg)("/auth/me");if(!(null==t?void 0:t.isSuperadmin)){a(!1),u("Superadmin access required.");return}a(!0);let i=await (0,r.Vg)("/admin/settings/smtp");h(null!=(e=i.host)?e:""),y(String(null!=(s=i.port)?s:465)),v(null!=(n=i.user)?n:""),j(null!=(l=i.from)?l:""),P(!!i.secure),w(!!i.hasPassword),N("")}catch(e){u(c(e))}finally{t(!1)}}async function k(){u(null),p(null);try{let e={host:m,port:Number(g),user:f,from:x,secure:S};b.trim()&&(e.password=b.trim());let t=await (0,r.mu)("/admin/settings/smtp",e);w(!!t.hasPassword),N(""),p("SMTP settings saved.")}catch(e){u(c(e))}}async function U(){u(null),p(null);try{await (0,r.$P)("/admin/settings/smtp/test",{to:E.trim()}),p("SMTP test email sent.")}catch(e){u(c(e))}}return(0,i.useEffect)(()=>{C()},[]),(0,n.jsxs)("div",{className:"settingsWrap",children:[(0,n.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)(l(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,n.jsx)(l(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,n.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 SMTP"}),e?(0,n.jsx)("div",{children:"Loading..."}):null,o?(0,n.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:o}):null,d?(0,n.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:d}):null,s?(0,n.jsxs)("section",{className:"card settingsSection",children:[(0,n.jsx)("div",{className:"settingsSectionHeader",children:(0,n.jsx)("h3",{style:{margin:0},children:"SMTP Settings"})}),(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Password stored: ",T?"yes":"no"]}),(0,n.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Host"}),(0,n.jsx)("input",{className:"input",value:m,onChange:e=>h(e.target.value)})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Port"}),(0,n.jsx)("input",{className:"input",type:"number",value:g,onChange:e=>y(e.target.value)})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"User"}),(0,n.jsx)("input",{className:"input",value:f,onChange:e=>v(e.target.value)})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"From"}),(0,n.jsx)("input",{className:"input",value:x,onChange:e=>j(e.target.value)})]}),(0,n.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("input",{type:"checkbox",checked:S,onChange:e=>P(e.target.checked)}),(0,n.jsx)("span",{children:"Use secure connection"})]}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Password (leave empty to keep)"}),(0,n.jsx)("input",{className:"input",type:"password",value:b,onChange:e=>N(e.target.value)})]}),(0,n.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:(0,n.jsx)("button",{className:"btn btnPrimary",onClick:()=>void k(),children:"Save SMTP"})}),(0,n.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,n.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"Test recipient"}),(0,n.jsx)("input",{className:"input",value:E,onChange:e=>_(e.target.value)})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{className:"btn",onClick:()=>void U(),disabled:!E.trim(),children:"Send SMTP test"})})]})]}):null]})}},9829:(e,t,s)=>{Promise.resolve().then(s.bind(s,5665))}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=9829)),_N_E=e.O()}]);