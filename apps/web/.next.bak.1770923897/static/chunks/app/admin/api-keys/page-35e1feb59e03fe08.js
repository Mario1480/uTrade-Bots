(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{2883:(e,n,t)=>{"use strict";t.d(n,{$P:()=>m,Al:()=>y,GC:()=>h,Vg:()=>d,hD:()=>c,mu:()=>p});var s,a,l,i,o=t(7011);null!=(null!=(s=o.env.API_URL)?s:o.env.API_BASE_URL)||o.env.NEXT_PUBLIC_API_URL;let r=null!=(i=null!=(l=null!=(a=o.env.NEXT_PUBLIC_API_URL)?a:o.env.API_URL)?l:o.env.API_BASE_URL)?i:"http://localhost:4000";class c extends Error{constructor(e,n,t){super(e),this.status=n,this.payload=t}}async function u(e,n,t){let s={"Content-Type":"application/json"};if(!["GET","HEAD","OPTIONS"].includes(e)){let e=function(e){if("undefined"==typeof document)return null;let n=document.cookie.match(new RegExp("(^|; )".concat(e,"=([^;]*)")));return n?decodeURIComponent(n[2]):null}("mm_csrf");e&&(s["x-csrf-token"]=e)}let a=await fetch("".concat(r).concat(n),{method:e,headers:s,body:t?JSON.stringify(t):void 0,credentials:"include",cache:"no-store"});if(!a.ok){let t=null;try{t=await a.json()}catch(e){}throw new c((null==t?void 0:t.error)||(null==t?void 0:t.message)||"".concat(e," ").concat(n," failed (").concat(a.status,")"),a.status,t)}return a.json()}function d(e){return u("GET",e)}function m(e,n){return u("POST",e,n)}function p(e,n){return u("PUT",e,n)}function y(e){return u("DELETE",e)}function h(e){return u("DELETE",e)}},7216:(e,n,t)=>{Promise.resolve().then(t.bind(t,9358))},9358:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>c});var s=t(4568),a=t(9664),l=t.n(a),i=t(7620),o=t(2883);function r(e){return e instanceof o.hD?"".concat(e.message," (HTTP ").concat(e.status,")"):e&&"object"==typeof e&&"message"in e?String(e.message):String(e)}function c(){var e,n;let[t,a]=(0,i.useState)(!0),[c,u]=(0,i.useState)(!1),[d,m]=(0,i.useState)(null),[p,y]=(0,i.useState)(null),[h,g]=(0,i.useState)(""),[v,f]=(0,i.useState)(null),[A,k]=(0,i.useState)(!1),[S,x]=(0,i.useState)(null),[j,b]=(0,i.useState)(!1),[I,w]=(0,i.useState)(!1),[O,P]=(0,i.useState)(null);async function _(){w(!0);try{let e=await (0,o.Vg)("/admin/settings/api-keys/status");P(e)}catch(e){P({ok:!1,status:"error",source:"none",checkedAt:new Date().toISOString(),message:r(e)})}finally{w(!1)}}async function E(){a(!0),m(null);try{var e,n;let t=await (0,o.Vg)("/auth/me");if(!(null==t?void 0:t.isSuperadmin)){u(!1),m("Superadmin access required.");return}u(!0);let s=await (0,o.Vg)("/admin/settings/api-keys");f(null!=(e=s.openaiApiKeyMasked)?e:null),k(!!s.hasOpenAiApiKey),x(null!=(n=s.updatedAt)?n:null),b(!!s.envOverride),g(""),await _()}catch(e){m(r(e))}finally{a(!1)}}async function N(){let e=h.trim();if(!e)return void m("Please enter an OpenAI API key.");m(null),y(null);try{var n,t;let s=await (0,o.mu)("/admin/settings/api-keys",{openaiApiKey:e,clearOpenaiApiKey:!1});g(""),f(null!=(n=s.openaiApiKeyMasked)?n:null),k(!!s.hasOpenAiApiKey),x(null!=(t=s.updatedAt)?t:null),y("OpenAI API key saved."),await _()}catch(e){m(r(e))}}async function B(){if(window.confirm("Remove the stored OpenAI API key?")){m(null),y(null);try{var e,n;let t=await (0,o.mu)("/admin/settings/api-keys",{clearOpenaiApiKey:!0});g(""),f(null!=(e=t.openaiApiKeyMasked)?e:null),k(!!t.hasOpenAiApiKey),x(null!=(n=t.updatedAt)?n:null),y("OpenAI API key removed."),await _()}catch(e){m(r(e))}}}return(0,i.useEffect)(()=>{E()},[]),(0,s.jsxs)("div",{className:"settingsWrap",children:[(0,s.jsxs)("div",{style:{marginBottom:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)(l(),{href:"/admin",className:"btn",children:"← Back to admin"}),(0,s.jsx)(l(),{href:"/settings",className:"btn",children:"← Back to settings"})]}),(0,s.jsx)("h2",{style:{marginTop:0},children:"Admin \xb7 API Keys"}),t?(0,s.jsx)("div",{children:"Loading..."}):null,d?(0,s.jsx)("div",{className:"card settingsSection",style:{borderColor:"#ef4444",marginBottom:12},children:d}):null,p?(0,s.jsx)("div",{className:"card settingsSection",style:{borderColor:"#22c55e",marginBottom:12},children:p}):null,c?(0,s.jsxs)("section",{className:"card settingsSection",children:[(0,s.jsx)("div",{className:"settingsSectionHeader",children:(0,s.jsx)("h3",{style:{margin:0},children:"OpenAI Key (Global)"})}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Stored key: ",A?"yes":"no",v?" \xb7 ".concat(v):""]}),(0,s.jsxs)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:8},children:["Last updated: ",S?new Date(S).toLocaleString():"never"]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:10},children:[(0,s.jsxs)("span",{className:"badge ".concat((null==O?void 0:O.status)==="ok"?"badgeOk":(null==O?void 0:O.status)==="missing_key"?"badgeWarn":"badgeDanger"),title:null!=(e=null==O?void 0:O.message)?e:"Status not checked yet.",children:["OpenAI status:"," ",I?"checking...":(null==O?void 0:O.status)==="ok"?"OK":(null==O?void 0:O.status)==="missing_key"?"missing key":"error"]}),(0,s.jsxs)("span",{style:{fontSize:12,color:"var(--muted)"},children:["Source: ",null!=(n=null==O?void 0:O.source)?n:j?"env":A?"db":"none","number"==typeof(null==O?void 0:O.latencyMs)?" \xb7 ".concat(O.latencyMs,"ms"):"",(null==O?void 0:O.checkedAt)?" \xb7 checked ".concat(new Date(O.checkedAt).toLocaleString()):""]}),(0,s.jsx)("button",{className:"btn",type:"button",onClick:()=>void _(),disabled:I,children:I?"Checking...":"Refresh status"})]}),(null==O?void 0:O.message)?(0,s.jsx)("div",{style:{fontSize:12,color:"var(--muted)",marginBottom:10},children:O.message}):null,j?(0,s.jsx)("div",{style:{fontSize:12,color:"#f59e0b",marginBottom:10},children:"ENV `AI_API_KEY` is still set. Remove it from `.env.prod` if you want DB-only key handling."}):null,(0,s.jsxs)("label",{style:{display:"grid",gap:6,marginBottom:10},children:[(0,s.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:"New OpenAI API key"}),(0,s.jsx)("input",{className:"input",type:"password",placeholder:"sk-proj-...",value:h,onChange:e=>g(e.target.value)})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("button",{className:"btn btnPrimary",onClick:()=>void N(),children:"Save OpenAI key"}),(0,s.jsx)("button",{className:"btn btnStop",onClick:()=>void B(),disabled:!A,children:"Remove stored key"})]})]}):null]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=7216)),_N_E=e.O()}]);